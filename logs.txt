INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000002D70DD1EAC0>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000002D70DD1EAC0>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000002D70DC19640>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-13' coro=<Event.wait() running at C:\Python312\Lib\asyncio\locks.py:212> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_wait.<locals>._on_completion() at C:\Python312\Lib\asyncio\tasks.py:534]>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-12' coro=<Dispatcher._polling() running at C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py:345> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_wait.<locals>._on_completion() at C:\Python312\Lib\asyncio\tasks.py:534]>
INFO:aiogram.dispatcher:Polling stopped for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.dispatcher:Polling stopped
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x00000180AD3CEE80>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x00000180AD3CEE80>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x00000180AB4C14F0>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-13' coro=<Event.wait() running at C:\Python312\Lib\asyncio\locks.py:212> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_wait.<locals>._on_completion() at C:\Python312\Lib\asyncio\tasks.py:534]>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-12' coro=<Dispatcher._polling() running at C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py:345> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_wait.<locals>._on_completion() at C:\Python312\Lib\asyncio\tasks.py:534]>
INFO:aiogram.dispatcher:Polling stopped for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.dispatcher:Polling stopped
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441730 is handled. Duration 391 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441731 is not handled. Duration 0 ms by bot id=7064840472
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000021C7199EC00>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000021C7199EC00>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441732 is not handled. Duration 0 ms by bot id=7064840472
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001B0CC40EFC0>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001B0CC40EFC0>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441733 is not handled. Duration 16 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778441733 by bot id=7064840472
AttributeError: module 'keyboards.inline.inline_kb_menu' has no attribute 'categories_markup'
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\keyboard_menu.py", line 20, in show_catalog
    reply_markup=await inline_kb_menu.categories_markup())
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: module 'keyboards.inline.inline_kb_menu' has no attribute 'categories_markup'. Did you mean: 'admin_categories_markup'?
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000002165C8FB100>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000002165C8FB100>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441734 is not handled. Duration 16 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778441734 by bot id=7064840472
TypeError: tovar_list_markup() missing 1 required positional argument: 'category_id'
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\keyboard_menu.py", line 20, in show_catalog
    reply_markup=await inline_kb_menu.tovar_list_markup())
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: tovar_list_markup() missing 1 required positional argument: 'category_id'
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7064840472)
INFO:aiogram.dispatcher:Connection established (tryings = 1, bot id = 7064840472)
INFO:aiogram.event:Update id=778441735 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778441735 by bot id=7064840472
TypeError: tovar_list_markup() missing 1 required positional argument: 'category_id'
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\keyboard_menu.py", line 20, in show_catalog
    reply_markup=await inline_kb_menu.tovar_list_markup())
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: tovar_list_markup() missing 1 required positional argument: 'category_id'
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 1.371080 seconds and try again... (tryings = 1, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 1.569930 seconds and try again... (tryings = 2, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 2.279663 seconds and try again... (tryings = 3, bot id = 7064840472)
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000002766FC46980>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000002766FC46980>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 1.309256 seconds and try again... (tryings = 1, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 1.707975 seconds and try again... (tryings = 2, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 2.113816 seconds and try again... (tryings = 3, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 2.709854 seconds and try again... (tryings = 4, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 3.268734 seconds and try again... (tryings = 5, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.184173 seconds and try again... (tryings = 6, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.942148 seconds and try again... (tryings = 7, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.025869 seconds and try again... (tryings = 8, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.192238 seconds and try again... (tryings = 9, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.031444 seconds and try again... (tryings = 10, bot id = 7064840472)
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000015C12027240>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000015C12027240>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000015C12401DC0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x0000015C124204D0>, 329021.265)]']
connector: <aiohttp.connector.TCPConnector object at 0x0000015C124020C0>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-13' coro=<Event.wait() running at C:\Python312\Lib\asyncio\locks.py:212> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_wait.<locals>._on_completion() at C:\Python312\Lib\asyncio\tasks.py:534]>
INFO:aiogram.dispatcher:Polling stopped
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-12' coro=<Dispatcher._polling() running at C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py:345> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Polling stopped for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441737 is handled. Duration 266 ms by bot id=7064840472
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 1.216587 seconds and try again... (tryings = 1, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 1.456768 seconds and try again... (tryings = 2, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 1.820907 seconds and try again... (tryings = 3, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 2.259373 seconds and try again... (tryings = 4, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 3.040405 seconds and try again... (tryings = 5, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 3.967873 seconds and try again... (tryings = 6, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.131906 seconds and try again... (tryings = 7, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.949077 seconds and try again... (tryings = 8, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.938305 seconds and try again... (tryings = 9, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.838625 seconds and try again... (tryings = 10, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.931632 seconds and try again... (tryings = 11, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.790546 seconds and try again... (tryings = 12, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.162828 seconds and try again... (tryings = 13, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.073138 seconds and try again... (tryings = 14, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.934236 seconds and try again... (tryings = 15, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.078282 seconds and try again... (tryings = 16, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.764834 seconds and try again... (tryings = 17, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.130250 seconds and try again... (tryings = 18, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.891086 seconds and try again... (tryings = 19, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.087227 seconds and try again... (tryings = 20, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.149282 seconds and try again... (tryings = 21, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.855837 seconds and try again... (tryings = 22, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.024998 seconds and try again... (tryings = 23, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.114470 seconds and try again... (tryings = 24, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.941025 seconds and try again... (tryings = 25, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.882024 seconds and try again... (tryings = 26, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.865838 seconds and try again... (tryings = 27, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.063438 seconds and try again... (tryings = 28, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.072611 seconds and try again... (tryings = 29, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.099352 seconds and try again... (tryings = 30, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.126484 seconds and try again... (tryings = 31, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.024389 seconds and try again... (tryings = 32, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.947750 seconds and try again... (tryings = 33, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.996494 seconds and try again... (tryings = 34, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.047269 seconds and try again... (tryings = 35, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.959433 seconds and try again... (tryings = 36, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.111476 seconds and try again... (tryings = 37, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.987655 seconds and try again... (tryings = 38, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.802688 seconds and try again... (tryings = 39, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.949388 seconds and try again... (tryings = 40, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.968438 seconds and try again... (tryings = 41, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.171866 seconds and try again... (tryings = 42, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.107975 seconds and try again... (tryings = 43, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.998340 seconds and try again... (tryings = 44, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.890714 seconds and try again... (tryings = 45, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.116288 seconds and try again... (tryings = 46, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.175645 seconds and try again... (tryings = 47, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.955263 seconds and try again... (tryings = 48, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.206937 seconds and try again... (tryings = 49, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.114827 seconds and try again... (tryings = 50, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.141815 seconds and try again... (tryings = 51, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.986999 seconds and try again... (tryings = 52, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.023731 seconds and try again... (tryings = 53, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.866658 seconds and try again... (tryings = 54, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.964895 seconds and try again... (tryings = 55, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.923605 seconds and try again... (tryings = 56, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.009648 seconds and try again... (tryings = 57, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.925001 seconds and try again... (tryings = 58, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.843143 seconds and try again... (tryings = 59, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.969889 seconds and try again... (tryings = 60, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.060442 seconds and try again... (tryings = 61, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.027400 seconds and try again... (tryings = 62, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.860314 seconds and try again... (tryings = 63, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.961193 seconds and try again... (tryings = 64, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.888134 seconds and try again... (tryings = 65, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.053011 seconds and try again... (tryings = 66, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.150029 seconds and try again... (tryings = 67, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.081830 seconds and try again... (tryings = 68, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.066608 seconds and try again... (tryings = 69, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.055886 seconds and try again... (tryings = 70, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.942927 seconds and try again... (tryings = 71, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.913167 seconds and try again... (tryings = 72, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.039669 seconds and try again... (tryings = 73, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.969404 seconds and try again... (tryings = 74, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.089028 seconds and try again... (tryings = 75, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.925870 seconds and try again... (tryings = 76, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.086168 seconds and try again... (tryings = 77, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.130905 seconds and try again... (tryings = 78, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.926313 seconds and try again... (tryings = 79, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.964372 seconds and try again... (tryings = 80, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.962764 seconds and try again... (tryings = 81, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.045352 seconds and try again... (tryings = 82, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.906285 seconds and try again... (tryings = 83, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.103488 seconds and try again... (tryings = 84, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.050607 seconds and try again... (tryings = 85, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.880120 seconds and try again... (tryings = 86, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.930309 seconds and try again... (tryings = 87, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.052125 seconds and try again... (tryings = 88, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.069210 seconds and try again... (tryings = 89, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.028470 seconds and try again... (tryings = 90, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.972954 seconds and try again... (tryings = 91, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.956643 seconds and try again... (tryings = 92, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.186184 seconds and try again... (tryings = 93, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.073225 seconds and try again... (tryings = 94, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.781139 seconds and try again... (tryings = 95, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.170431 seconds and try again... (tryings = 96, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.164026 seconds and try again... (tryings = 97, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.154744 seconds and try again... (tryings = 98, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.021086 seconds and try again... (tryings = 99, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.255897 seconds and try again... (tryings = 100, bot id = 7064840472)
INFO:aiogram.dispatcher:Connection established (tryings = 101, bot id = 7064840472)
INFO:aiogram.event:Update id=778441738 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 1.353172 seconds and try again... (tryings = 1, bot id = 7064840472)
INFO:aiogram.dispatcher:Connection established (tryings = 2, bot id = 7064840472)
INFO:aiogram.event:Update id=778441739 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 1.226574 seconds and try again... (tryings = 1, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 1.411345 seconds and try again... (tryings = 2, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 2.018502 seconds and try again... (tryings = 3, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 2.506985 seconds and try again... (tryings = 4, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 3.338150 seconds and try again... (tryings = 5, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.231656 seconds and try again... (tryings = 6, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.842995 seconds and try again... (tryings = 7, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.864828 seconds and try again... (tryings = 8, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.943686 seconds and try again... (tryings = 9, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.910358 seconds and try again... (tryings = 10, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.930780 seconds and try again... (tryings = 11, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.017043 seconds and try again... (tryings = 12, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.918373 seconds and try again... (tryings = 13, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.908260 seconds and try again... (tryings = 14, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.956165 seconds and try again... (tryings = 15, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.053509 seconds and try again... (tryings = 16, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.978282 seconds and try again... (tryings = 17, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.889973 seconds and try again... (tryings = 18, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.927187 seconds and try again... (tryings = 19, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.036391 seconds and try again... (tryings = 20, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.029078 seconds and try again... (tryings = 21, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.807454 seconds and try again... (tryings = 22, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.143384 seconds and try again... (tryings = 23, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.970876 seconds and try again... (tryings = 24, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.948189 seconds and try again... (tryings = 25, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.889147 seconds and try again... (tryings = 26, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.887660 seconds and try again... (tryings = 27, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.134592 seconds and try again... (tryings = 28, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.911206 seconds and try again... (tryings = 29, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.879660 seconds and try again... (tryings = 30, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.912774 seconds and try again... (tryings = 31, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.899659 seconds and try again... (tryings = 32, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.138148 seconds and try again... (tryings = 33, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.180788 seconds and try again... (tryings = 34, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.037441 seconds and try again... (tryings = 35, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.870694 seconds and try again... (tryings = 36, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.949790 seconds and try again... (tryings = 37, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.886781 seconds and try again... (tryings = 38, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.054611 seconds and try again... (tryings = 39, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.124492 seconds and try again... (tryings = 40, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.963317 seconds and try again... (tryings = 41, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.018043 seconds and try again... (tryings = 42, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.046470 seconds and try again... (tryings = 43, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.942722 seconds and try again... (tryings = 44, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.875415 seconds and try again... (tryings = 45, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.150551 seconds and try again... (tryings = 46, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.021818 seconds and try again... (tryings = 47, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.066409 seconds and try again... (tryings = 48, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.993714 seconds and try again... (tryings = 49, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.968343 seconds and try again... (tryings = 50, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.012550 seconds and try again... (tryings = 51, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.026899 seconds and try again... (tryings = 52, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.975128 seconds and try again... (tryings = 53, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.912363 seconds and try again... (tryings = 54, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.214821 seconds and try again... (tryings = 55, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.044804 seconds and try again... (tryings = 56, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.919538 seconds and try again... (tryings = 57, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.998571 seconds and try again... (tryings = 58, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.024657 seconds and try again... (tryings = 59, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.984291 seconds and try again... (tryings = 60, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.187075 seconds and try again... (tryings = 61, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.918799 seconds and try again... (tryings = 62, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.895244 seconds and try again... (tryings = 63, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.999737 seconds and try again... (tryings = 64, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.961911 seconds and try again... (tryings = 65, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.004859 seconds and try again... (tryings = 66, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.984551 seconds and try again... (tryings = 67, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.001103 seconds and try again... (tryings = 68, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.929179 seconds and try again... (tryings = 69, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.909200 seconds and try again... (tryings = 70, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.960298 seconds and try again... (tryings = 71, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.994810 seconds and try again... (tryings = 72, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.897838 seconds and try again... (tryings = 73, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.061796 seconds and try again... (tryings = 74, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.916466 seconds and try again... (tryings = 75, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.982681 seconds and try again... (tryings = 76, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.055261 seconds and try again... (tryings = 77, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.901612 seconds and try again... (tryings = 78, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.942479 seconds and try again... (tryings = 79, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.104905 seconds and try again... (tryings = 80, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.029051 seconds and try again... (tryings = 81, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.908993 seconds and try again... (tryings = 82, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.046511 seconds and try again... (tryings = 83, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.012492 seconds and try again... (tryings = 84, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.024595 seconds and try again... (tryings = 85, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.743483 seconds and try again... (tryings = 86, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.047445 seconds and try again... (tryings = 87, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.876026 seconds and try again... (tryings = 88, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.099890 seconds and try again... (tryings = 89, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.093001 seconds and try again... (tryings = 90, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.129112 seconds and try again... (tryings = 91, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.933719 seconds and try again... (tryings = 92, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.129389 seconds and try again... (tryings = 93, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.073911 seconds and try again... (tryings = 94, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.088116 seconds and try again... (tryings = 95, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.951953 seconds and try again... (tryings = 96, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.985085 seconds and try again... (tryings = 97, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.969908 seconds and try again... (tryings = 98, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.096962 seconds and try again... (tryings = 99, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.164453 seconds and try again... (tryings = 100, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.995350 seconds and try again... (tryings = 101, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.044547 seconds and try again... (tryings = 102, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.932306 seconds and try again... (tryings = 103, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.196148 seconds and try again... (tryings = 104, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.062042 seconds and try again... (tryings = 105, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.789410 seconds and try again... (tryings = 106, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.905899 seconds and try again... (tryings = 107, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.985125 seconds and try again... (tryings = 108, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.973247 seconds and try again... (tryings = 109, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.062154 seconds and try again... (tryings = 110, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.013036 seconds and try again... (tryings = 111, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.943226 seconds and try again... (tryings = 112, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.082474 seconds and try again... (tryings = 113, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.238845 seconds and try again... (tryings = 114, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.038704 seconds and try again... (tryings = 115, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.055792 seconds and try again... (tryings = 116, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.860811 seconds and try again... (tryings = 117, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.934163 seconds and try again... (tryings = 118, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.937638 seconds and try again... (tryings = 119, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.973045 seconds and try again... (tryings = 120, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.079609 seconds and try again... (tryings = 121, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.950753 seconds and try again... (tryings = 122, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.860978 seconds and try again... (tryings = 123, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.041954 seconds and try again... (tryings = 124, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.931234 seconds and try again... (tryings = 125, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.118681 seconds and try again... (tryings = 126, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.063830 seconds and try again... (tryings = 127, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.999467 seconds and try again... (tryings = 128, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.779641 seconds and try again... (tryings = 129, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.006479 seconds and try again... (tryings = 130, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.945732 seconds and try again... (tryings = 131, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.042736 seconds and try again... (tryings = 132, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.948062 seconds and try again... (tryings = 133, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.906832 seconds and try again... (tryings = 134, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.961551 seconds and try again... (tryings = 135, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.066639 seconds and try again... (tryings = 136, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.946656 seconds and try again... (tryings = 137, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 5.070202 seconds and try again... (tryings = 138, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.956382 seconds and try again... (tryings = 139, bot id = 7064840472)
INFO:aiogram.dispatcher:Connection established (tryings = 140, bot id = 7064840472)
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001757F132980>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001757F132980>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441740 is not handled. Duration 219 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778441740 by bot id=7064840472
TelegramBadRequest: Telegram server says - Bad Request: wrong remote file identifier specified: Wrong character in the string
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\commands.py", line 43, in handle_meoji
    await bot.send_sticker(message.chat.id, emoji_id)
  File "C:\Python312\Lib\site-packages\aiogram\client\bot.py", line 3124, in send_sticker
    return await self(call, request_timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\client\bot.py", line 485, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\client\session\aiohttp.py", line 189, in make_request
    response = self.check_response(
               ^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: wrong remote file identifier specified: Wrong character in the string
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000020157832AC0>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000020157832AC0>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441741 is not handled. Duration 235 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778441741 by bot id=7064840472
TelegramBadRequest: Telegram server says - Bad Request: wrong remote file identifier specified: Wrong character in the string
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\commands.py", line 43, in handle_meoji
    await bot.send_sticker(message.chat.id, emoji_id)
  File "C:\Python312\Lib\site-packages\aiogram\client\bot.py", line 3124, in send_sticker
    return await self(call, request_timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\client\bot.py", line 485, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\client\session\aiohttp.py", line 189, in make_request
    response = self.check_response(
               ^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: wrong remote file identifier specified: Wrong character in the string
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000014929043100>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000014929043100>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441742 is not handled. Duration 203 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778441742 by bot id=7064840472
TelegramBadRequest: Telegram server says - Bad Request: wrong remote file identifier specified: Wrong character in the string
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\commands.py", line 33, in handle_meoji
    await bot.send_sticker(message.chat.id, emoji_id)
  File "C:\Python312\Lib\site-packages\aiogram\client\bot.py", line 3124, in send_sticker
    return await self(call, request_timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\client\bot.py", line 485, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\client\session\aiohttp.py", line 189, in make_request
    response = self.check_response(
               ^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: wrong remote file identifier specified: Wrong character in the string
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000024B776F3380>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000024B776F3380>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441743 is handled. Duration 407 ms by bot id=7064840472
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000020D11513240>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000020D11513240>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441744 is handled. Duration 375 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441745 is not handled. Duration 0 ms by bot id=7064840472
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000028B161C6480>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000028B161C6480>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441746 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778441746 by bot id=7064840472
AttributeError: module 'keyboards.inline.inline_kb_menu' has no attribute 'categories_markup'
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 48, in categories_menu
    markup = await inline_kb_menu.categories_markup()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: module 'keyboards.inline.inline_kb_menu' has no attribute 'categories_markup'. Did you mean: 'admin_categories_markup'?
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x00000259FBB3F100>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x00000259FBB3F100>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441747 is handled. Duration 313 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441748 is not handled. Duration 0 ms by bot id=7064840472
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000016639E1F100>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000016639E1F100>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441749 is not handled. Duration 0 ms by bot id=7064840472
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000012CC5DBB100>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000012CC5DBB100>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441750 is handled. Duration 717 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441751 is handled. Duration 202 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441752 is not handled. Duration 16 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778441752 by bot id=7064840472
IndexError: list index out of range
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 58, in tovar_info_menu
    count = int(call.data.split('_')[4])
                ~~~~~~~~~~~~~~~~~~~~^^^
IndexError: list index out of range
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x00000244355DF380>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x00000244355DF380>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441753 is handled. Duration 952 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441754 is handled. Duration 186 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441755 is not handled. Duration 47 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778441755 by bot id=7064840472
UndefinedColumnError:  "state"  
HINT:  ,     "products.status".
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 59, in tovar_info_menu
    count = await get_count(amount)
            ^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\utils\db_api\db_asyncpg.py", line 32, in get_count
    return await connection.fetch(f'SELECT COUNT(*) From "products" WHERE "amount"={amount} AND "state"="Free"')
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 691, in fetch
    return await self._execute(
           ^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1794, in _execute
    result, _ = await self.__execute(
                ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1892, in __execute
    result, stmt = await self._do_execute(
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1925, in _do_execute
    stmt = await self._get_statement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 433, in _get_statement
    statement = await self._protocol.prepare(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\protocol\protocol.pyx", line 166, in prepare
asyncpg.exceptions.UndefinedColumnError:  "state"  
HINT:  ,     "products.status".
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000002002FB0B4C0>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000002002FB0B4C0>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441756 is not handled. Duration 14 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778441756 by bot id=7064840472
UndefinedColumnError:  "Free"  
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 59, in tovar_info_menu
    count = await get_count(amount)
            ^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\utils\db_api\db_asyncpg.py", line 32, in get_count
    return await connection.fetch(f'SELECT COUNT(*) From "products" WHERE "amount"={amount} AND "status"="Free"')
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 691, in fetch
    return await self._execute(
           ^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1794, in _execute
    result, _ = await self.__execute(
                ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1892, in __execute
    result, stmt = await self._do_execute(
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1925, in _do_execute
    stmt = await self._get_statement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 433, in _get_statement
    statement = await self._protocol.prepare(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\protocol\protocol.pyx", line 166, in prepare
asyncpg.exceptions.UndefinedColumnError:  "Free"  
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001DBD8FE7380>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001DBD8FE7380>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441757 is not handled. Duration 32 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778441757 by bot id=7064840472
UnboundLocalError: cannot access local variable 'msg_text' where it is not associated with a value
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 76, in tovar_info_menu
    msg_text = await tovar_info_text(amount=amount, price=price, count=count)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\admin.py", line 19, in tovar_info_text
    msg_text += f'\n\n<b>{amount}uc</b>' \
    ^^^^^^^^
UnboundLocalError: cannot access local variable 'msg_text' where it is not associated with a value
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001B83FBE6FC0>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001B83FBE6FC0>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 1.307829 seconds and try again... (tryings = 1, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 1.705029 seconds and try again... (tryings = 2, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 2.255795 seconds and try again... (tryings = 3, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 2.915340 seconds and try again... (tryings = 4, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 3.500335 seconds and try again... (tryings = 5, bot id = 7064840472)
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 4.662198 seconds and try again... (tryings = 6, bot id = 7064840472)
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001E8EEC40180>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001E8EEC40180>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001E8EE6477A0>
ERROR:asyncio:Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001E8EEC35BB0>, 347506.578)]']
connector: <aiohttp.connector.TCPConnector object at 0x000001E8EEC1E030>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-13' coro=<Event.wait() running at C:\Python312\Lib\asyncio\locks.py:212> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_wait.<locals>._on_completion() at C:\Python312\Lib\asyncio\tasks.py:534]>
INFO:aiogram.dispatcher:Polling stopped
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-12' coro=<Dispatcher._polling() running at C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py:345> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Polling stopped for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441759 is not handled. Duration 16 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778441759 by bot id=7064840472
TypeError: unsupported operand type(s) for -: 'list' and 'int'
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 77, in tovar_info_menu
    markup = await inline_kb_menu.tovar_info_markup(user_id=call.from_user.id, amount=amount, count=count)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\keyboards\inline\inline_kb_menu.py", line 176, in tovar_info_markup
    btns.append([InlineKeyboardButton(text=f'\u2796', callback_data=f'tovar-info_{amount}{1 if count-1 <= 1 else count - 1}'),
                                                                                           ~~~~~^~
TypeError: unsupported operand type(s) for -: 'list' and 'int'
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001E461578540>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001E461578540>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441760 is not handled. Duration 16 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778441760 by bot id=7064840472
TypeError: unsupported operand type(s) for -: 'list' and 'int'
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 78, in tovar_info_menu
    markup = await inline_kb_menu.tovar_info_markup(user_id=call.from_user.id, amount=amount, count=count)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\keyboards\inline\inline_kb_menu.py", line 176, in tovar_info_markup
    btns.append([InlineKeyboardButton(text=f'\u2796', callback_data=f'tovar-info_{amount}{1 if count-1 <= 1 else count - 1}'),
                                                                                           ~~~~~^~
TypeError: unsupported operand type(s) for -: 'list' and 'int'
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000023356D2C540>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000023356D2C540>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441761 is not handled. Duration 15 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778441761 by bot id=7064840472
TypeError: unsupported operand type(s) for -: 'list' and 'int'
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 78, in tovar_info_menu
    markup = await inline_kb_menu.tovar_info_markup(user_id=call.from_user.id, amount=amount, count=count)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\keyboards\inline\inline_kb_menu.py", line 176, in tovar_info_markup
    btns.append([InlineKeyboardButton(text=f'\u2796', callback_data=f'tovar-info_{amount}{1 if count-1 <= 1 else count - 1}'),
                                                                                           ~~~~~^~
TypeError: unsupported operand type(s) for -: 'list' and 'int'
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000018A1D9F8680>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000018A1D9F8680>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441762 is not handled. Duration 15 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778441762 by bot id=7064840472
TypeError: unsupported operand type(s) for -: 'list' and 'int'
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 78, in tovar_info_menu
    markup = await inline_kb_menu.tovar_info_markup(user_id=call.from_user.id, amount=amount, count=count)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\keyboards\inline\inline_kb_menu.py", line 176, in tovar_info_markup
    btns.append([InlineKeyboardButton(text=f'\u2796', callback_data=f'tovar-info_{amount}{1 if count-1 <= 1 else count - 1}'),
                                                                                           ~~~~~^~
TypeError: unsupported operand type(s) for -: 'list' and 'int'
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000020320DDC400>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000020320DDC400>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441763 is not handled. Duration 16 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778441763 by bot id=7064840472
TypeError: 'coroutine' object is not subscriptable
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 59, in tovar_info_menu
    count = await get_count(amount)
            ^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\utils\db_api\db_asyncpg.py", line 32, in get_count
    return await connection.fetch(f"""SELECT COUNT(*) From "products" WHERE "amount"={amount} AND "status"='Free'""")[0]
                 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^
TypeError: 'coroutine' object is not subscriptable
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000022DAFDF87C0>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000022DAFDF87C0>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441764 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778441764 by bot id=7064840472
TypeError: unsupported operand type(s) for -: 'asyncpg.Record' and 'int'
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 78, in tovar_info_menu
    markup = await inline_kb_menu.tovar_info_markup(user_id=call.from_user.id, amount=amount, count=count)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\keyboards\inline\inline_kb_menu.py", line 176, in tovar_info_markup
    btns.append([InlineKeyboardButton(text=f'\u2796', callback_data=f'tovar-info_{amount}{1 if count-1 <= 1 else count - 1}'),
                                                                                           ~~~~~^~
TypeError: unsupported operand type(s) for -: 'asyncpg.Record' and 'int'
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001DE3B8F87C0>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001DE3B8F87C0>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441765 is not handled. Duration 16 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778441765 by bot id=7064840472
UnboundLocalError: cannot access local variable 'navigation_row' where it is not associated with a value
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 78, in tovar_info_menu
    markup = await inline_kb_menu.tovar_info_markup(user_id=call.from_user.id, amount=amount, count=count)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\keyboards\inline\inline_kb_menu.py", line 187, in tovar_info_markup
    navigation_row = [btn for btn in navigation_row if btn is not None]
                                     ^^^^^^^^^^^^^^
UnboundLocalError: cannot access local variable 'navigation_row' where it is not associated with a value
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000023A67B58400>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000023A67B58400>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441766 is handled. Duration 359 ms by bot id=7064840472
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001A1255DC040>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001A1255DC040>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441767 is not handled. Duration 0 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441768 is handled. Duration 296 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441769 is handled. Duration 250 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441770 is handled. Duration 344 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441771 is handled. Duration 922 ms by bot id=7064840472
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x00000282840E87C0>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x00000282840E87C0>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441772 is handled. Duration 375 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441773 is handled. Duration 0 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441774 is handled. Duration 0 ms by bot id=7064840472
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x00000264FB358040>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x00000264FB358040>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441775 is handled. Duration 0 ms by bot id=7064840472
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001D86DBB8040>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001D86DBB8040>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441777 is handled. Duration 16 ms by bot id=7064840472
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x00000270FC67C400>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x00000270FC67C400>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441778 is handled. Duration 0 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441779 is handled. Duration 0 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441780 is not handled. Duration 16 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778441780 by bot id=7064840472
IndexError: list index out of range
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 57, in tovar_counter
    data = int(call.data.split('_')[2])
               ~~~~~~~~~~~~~~~~~~~~^^^
IndexError: list index out of range
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001DD48428040>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001DD48428040>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441781 is handled. Duration 266 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441782 is not handled. Duration 375 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778441782 by bot id=7064840472
TelegramBadRequest: Telegram server says - Bad Request: can't parse inline keyboard button: Text buttons are unallowed in the inline keyboard
Traceback (most recent call last):
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 93, in tovar_info_menu
    await call.message.answer(text=msg_text, reply_markup=markup, parse_mode='HTML')
  File "C:\Python312\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\client\bot.py", line 485, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\client\session\aiohttp.py", line 189, in make_request
    response = self.check_response(
               ^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: can't parse inline keyboard button: Text buttons are unallowed in the inline keyboard

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\admin.py", line 48, in try_edit_call
    msg = await callback.message.edit_text(text=text, parse_mode='HTML', reply_markup=markup)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\client\bot.py", line 485, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\client\session\aiohttp.py", line 189, in make_request
    response = self.check_response(
               ^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: can't parse inline keyboard button: Text buttons are unallowed in the inline keyboard

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 95, in tovar_info_menu
    await try_edit_call(callback=call, text=msg_text, markup=markup)
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\admin.py", line 51, in try_edit_call
    msg = await callback.message.answer(text=text, parse_mode='HTML', reply_markup=markup)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\client\bot.py", line 485, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\client\session\aiohttp.py", line 189, in make_request
    response = self.check_response(
               ^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: can't parse inline keyboard button: Text buttons are unallowed in the inline keyboard
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x00000222929BC040>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x00000222929BC040>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441783 is handled. Duration 0 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441784 is handled. Duration 265 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441785 is handled. Duration 266 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441786 is handled. Duration 0 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441787 is handled. Duration 0 ms by bot id=7064840472
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000002E3162E8040>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000002E3162E8040>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441788 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778441788 by bot id=7064840472
ValidationError: 2 validation errors for EditMessageReplyMarkup
inline_message_id
  Input should be a valid string [type=string_type, input_value=434, input_type=int]
    For further information visit https://errors.pydantic.dev/2.8/v/string_type
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=<coroutine object tovar_i...p at 0x000001D4252A5D80>, input_type=coroutine]
    For further information visit https://errors.pydantic.dev/2.8/v/model_type
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 59, in tovar_counter
    call.message.edit_reply_markup(inline_message_id=call.message.message_id,
  File "C:\Python312\Lib\site-packages\aiogram\types\message.py", line 3734, in edit_reply_markup
    return EditMessageReplyMarkup(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\pydantic\main.py", line 193, in __init__
    self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 2 validation errors for EditMessageReplyMarkup
inline_message_id
  Input should be a valid string [type=string_type, input_value=434, input_type=int]
    For further information visit https://errors.pydantic.dev/2.8/v/string_type
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=<coroutine object tovar_i...p at 0x000001D4252A5D80>, input_type=coroutine]
    For further information visit https://errors.pydantic.dev/2.8/v/model_type
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001D425318540>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001D425318540>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441789 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778441789 by bot id=7064840472
ValidationError: 1 validation error for EditMessageReplyMarkup
inline_message_id
  Input should be a valid string [type=string_type, input_value=434, input_type=int]
    For further information visit https://errors.pydantic.dev/2.8/v/string_type
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 59, in tovar_counter
    call.message.edit_reply_markup(inline_message_id=call.message.message_id,
  File "C:\Python312\Lib\site-packages\aiogram\types\message.py", line 3734, in edit_reply_markup
    return EditMessageReplyMarkup(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\pydantic\main.py", line 193, in __init__
    self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for EditMessageReplyMarkup
inline_message_id
  Input should be a valid string [type=string_type, input_value=434, input_type=int]
    For further information visit https://errors.pydantic.dev/2.8/v/string_type
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000028367B7C680>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000028367B7C680>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441790 is handled. Duration 0 ms by bot id=7064840472
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000020EE9F0CA40>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000020EE9F0CA40>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441791 is not handled. Duration 16 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778441791 by bot id=7064840472
TypeError: aiogram.methods.edit_message_reply_markup.EditMessageReplyMarkup() got multiple values for keyword argument 'message_id'
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 58, in tovar_counter
    call.message.edit_reply_markup(message_id=call.message.message_id,
  File "C:\Python312\Lib\site-packages\aiogram\types\message.py", line 3734, in edit_reply_markup
    return EditMessageReplyMarkup(
           ^^^^^^^^^^^^^^^^^^^^^^^
TypeError: aiogram.methods.edit_message_reply_markup.EditMessageReplyMarkup() got multiple values for keyword argument 'message_id'
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000025EBCA487C0>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000025EBCA487C0>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441792 is handled. Duration 0 ms by bot id=7064840472
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x00000224758587C0>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x00000224758587C0>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441793 is handled. Duration 250 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441794 is handled. Duration 186 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441795 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778441795 by bot id=7064840472
ValueError: invalid literal for int() with base 10: 'plus'
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 57, in tovar_counter
    data = int(data)
           ^^^^^^^^^
ValueError: invalid literal for int() with base 10: 'plus'
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x00000244656BC040>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x00000244656BC040>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441796 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778441796 by bot id=7064840472
ValueError: not enough values to unpack (expected 4, got 3)
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 56, in tovar_counter
    _, amount, data, action = call.data.split('_')
    ^^^^^^^^^^^^^^^^^^^^^^^
ValueError: not enough values to unpack (expected 4, got 3)
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000020089B9C040>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000020089B9C040>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441797 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778441797 by bot id=7064840472
ValueError: not enough values to unpack (expected 4, got 3)
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 56, in tovar_counter
    _, amount, data, action = call.data.split('_')
    ^^^^^^^^^^^^^^^^^^^^^^^
ValueError: not enough values to unpack (expected 4, got 3)
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001E6F1F3C040>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001E6F1F3C040>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441798 is not handled. Duration 15 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778441798 by bot id=7064840472
ValueError: invalid literal for int() with base 10: 'plus'
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 58, in tovar_counter
    data = int(data)
           ^^^^^^^^^
ValueError: invalid literal for int() with base 10: 'plus'
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001A133DF8180>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001A133DF8180>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441799 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778441799 by bot id=7064840472
ValueError: invalid literal for int() with base 10: 'plus'
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 58, in tovar_counter
    data = int(data)
           ^^^^^^^^^
ValueError: invalid literal for int() with base 10: 'plus'
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000002B3ECB00040>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000002B3ECB00040>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441800 is handled. Duration 281 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441801 is handled. Duration 172 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441802 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778441802 by bot id=7064840472
ValueError: too many values to unpack (expected 3)
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 56, in tovar_counter
    _, amount, data = call.data.split('_')
    ^^^^^^^^^^^^^^^
ValueError: too many values to unpack (expected 3)
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000019A6F3A87C0>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000019A6F3A87C0>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441803 is not handled. Duration 16 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778441803 by bot id=7064840472
ValueError: too many values to unpack (expected 3)
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 57, in tovar_counter
    _, amount, data = call.data.split('_')
    ^^^^^^^^^^^^^^^
ValueError: too many values to unpack (expected 3)
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000020C96CC8180>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000020C96CC8180>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441804 is handled. Duration 2718 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441805 is not handled. Duration 78 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778441805 by bot id=7064840472
TelegramBadRequest: Telegram server says - Bad Request: message is not modified: specified new message content and reply markup are exactly the same as a current content and reply markup of the message
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 70, in tovar_counter
    await call.message.edit_reply_markup(reply_markup=new_markup)
  File "C:\Python312\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\client\bot.py", line 485, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\client\session\aiohttp.py", line 189, in make_request
    response = self.check_response(
               ^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: message is not modified: specified new message content and reply markup are exactly the same as a current content and reply markup of the message
INFO:aiogram.event:Update id=778441806 is handled. Duration 327 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441807 is handled. Duration 171 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441808 is not handled. Duration 77 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778441808 by bot id=7064840472
TelegramBadRequest: Telegram server says - Bad Request: message is not modified: specified new message content and reply markup are exactly the same as a current content and reply markup of the message
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 70, in tovar_counter
    await call.message.edit_reply_markup(reply_markup=new_markup)
  File "C:\Python312\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\client\bot.py", line 485, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\client\session\aiohttp.py", line 189, in make_request
    response = self.check_response(
               ^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: message is not modified: specified new message content and reply markup are exactly the same as a current content and reply markup of the message
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001767370C2C0>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001767370C2C0>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441809 is handled. Duration 266 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441810 is handled. Duration 187 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441811 is handled. Duration 202 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441812 is not handled. Duration 93 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778441812 by bot id=7064840472
TelegramBadRequest: Telegram server says - Bad Request: message is not modified: specified new message content and reply markup are exactly the same as a current content and reply markup of the message
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 70, in tovar_counter
    await call.message.edit_reply_markup(reply_markup=new_markup)
  File "C:\Python312\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\client\bot.py", line 485, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\client\session\aiohttp.py", line 189, in make_request
    response = self.check_response(
               ^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: message is not modified: specified new message content and reply markup are exactly the same as a current content and reply markup of the message
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000017F50BA87C0>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000017F50BA87C0>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441813 is handled. Duration 280 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441814 is handled. Duration 172 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441815 is handled. Duration 233 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441816 is not handled. Duration 93 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778441816 by bot id=7064840472
TelegramBadRequest: Telegram server says - Bad Request: message is not modified: specified new message content and reply markup are exactly the same as a current content and reply markup of the message
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 74, in tovar_counter
    await call.message.edit_reply_markup(reply_markup=new_markup)
  File "C:\Python312\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\client\bot.py", line 485, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\client\session\aiohttp.py", line 189, in make_request
    response = self.check_response(
               ^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: message is not modified: specified new message content and reply markup are exactly the same as a current content and reply markup of the message
INFO:aiogram.event:Update id=778441817 is not handled. Duration 125 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778441817 by bot id=7064840472
TelegramBadRequest: Telegram server says - Bad Request: message is not modified: specified new message content and reply markup are exactly the same as a current content and reply markup of the message
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 74, in tovar_counter
    await call.message.edit_reply_markup(reply_markup=new_markup)
  File "C:\Python312\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\client\bot.py", line 485, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\client\session\aiohttp.py", line 189, in make_request
    response = self.check_response(
               ^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: message is not modified: specified new message content and reply markup are exactly the same as a current content and reply markup of the message
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000024BEF1587C0>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000024BEF1587C0>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441818 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778441818 by bot id=7064840472
TypeError: can only concatenate str (not "int") to str
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 62, in tovar_counter
    new_count = data + 1
                ~~~~~^~~
TypeError: can only concatenate str (not "int") to str
INFO:aiogram.event:Update id=778441819 is not handled. Duration 16 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778441819 by bot id=7064840472
TypeError: can only concatenate str (not "int") to str
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 62, in tovar_counter
    new_count = data + 1
                ~~~~~^~~
TypeError: can only concatenate str (not "int") to str
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000002619D9B8680>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000002619D9B8680>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441820 is handled. Duration 375 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441821 is handled. Duration 155 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441822 is handled. Duration 188 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441823 is handled. Duration 266 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441824 is handled. Duration 405 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441825 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778441825 by bot id=7064840472
IndexError: list index out of range
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 17, in basketAdd_
    await tovar_add_to_basket(user_id=int(call.from_user.id), product_id=int(call.data.split('_')[3]),
                                                                             ~~~~~~~~~~~~~~~~~~~~^^^
IndexError: list index out of range
INFO:aiogram.event:Update id=778441826 is handled. Duration 172 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441827 is handled. Duration 358 ms by bot id=7064840472
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000020E10EDC540>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000020E10EDC540>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441828 is handled. Duration 0 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441829 is handled. Duration 0 ms by bot id=7064840472
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000002144282C7C0>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000002144282C7C0>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441830 is handled. Duration 0 ms by bot id=7064840472
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001B303B18A40>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001B303B18A40>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441831 is handled. Duration 16 ms by bot id=7064840472
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000027EED618900>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000027EED618900>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441832 is handled. Duration 16 ms by bot id=7064840472
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000027FF42A8A40>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000027FF42A8A40>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441833 is handled. Duration 14 ms by bot id=7064840472
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000002395DDB8680>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000002395DDB8680>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441834 is handled. Duration 250 ms by bot id=7064840472
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000022F0C6BCA40>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000022F0C6BCA40>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441835 is handled. Duration 343 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441836 is not handled. Duration 140 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778441836 by bot id=7064840472
TelegramBadRequest: Telegram server says - Bad Request: message is not modified: specified new message content and reply markup are exactly the same as a current content and reply markup of the message
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 79, in tovar_counter
    await call.message.edit_reply_markup(reply_markup=new_markup)
  File "C:\Python312\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\client\bot.py", line 485, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\client\session\aiohttp.py", line 189, in make_request
    response = self.check_response(
               ^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: message is not modified: specified new message content and reply markup are exactly the same as a current content and reply markup of the message
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000002232C70C7C0>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000002232C70C7C0>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441837 is not handled. Duration 327 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778441837 by bot id=7064840472
TelegramBadRequest: Telegram server says - Bad Request: message is not modified: specified new message content and reply markup are exactly the same as a current content and reply markup of the message
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 81, in tovar_counter
    await call.message.edit_reply_markup(reply_markup=new_markup)
  File "C:\Python312\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\client\bot.py", line 485, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\client\session\aiohttp.py", line 189, in make_request
    response = self.check_response(
               ^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: message is not modified: specified new message content and reply markup are exactly the same as a current content and reply markup of the message
INFO:aiogram.event:Update id=778441838 is handled. Duration 281 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441839 is not handled. Duration 16 ms by bot id=7064840472
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x00000183315FCA40>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x00000183315FCA40>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441840 is handled. Duration 469 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441841 is handled. Duration 170 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441842 is handled. Duration 202 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441843 is handled. Duration 217 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441844 is handled. Duration 375 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441845 is handled. Duration 234 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441846 is not handled. Duration 0 ms by bot id=7064840472
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001FF7DB787C0>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001FF7DB787C0>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001D1836AC040>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001D1836AC040>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001D1885FF650>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-13' coro=<Event.wait() running at C:\Python312\Lib\asyncio\locks.py:212> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_wait.<locals>._on_completion() at C:\Python312\Lib\asyncio\tasks.py:534]>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-12' coro=<Dispatcher._polling() running at C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py:345> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_wait.<locals>._on_completion() at C:\Python312\Lib\asyncio\tasks.py:534]>
INFO:aiogram.dispatcher:Polling stopped for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.dispatcher:Polling stopped
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441847 is handled. Duration 327 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441848 is handled. Duration 108 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441849 is handled. Duration 296 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441850 is handled. Duration 234 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441851 is handled. Duration 219 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441852 is handled. Duration 250 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441853 is handled. Duration 561 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441854 is handled. Duration 280 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441855 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778441855 by bot id=7064840472
IndexError: list index out of range
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 17, in basketAdd_
    await tovar_add_to_basket(user_id=int(call.from_user.id), product_id=int(call.data.split('_')[3]),
                                                                             ~~~~~~~~~~~~~~~~~~~~^^^
IndexError: list index out of range
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000018B17EA8180>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000018B17EA8180>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441856 is handled. Duration 250 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441857 is handled. Duration 500 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441858 is handled. Duration 266 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441859 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7064840472)
INFO:aiogram.dispatcher:Connection established (tryings = 1, bot id = 7064840472)
INFO:aiogram.event:Update id=778441860 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
WARNING:aiogram.dispatcher:Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7064840472)
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001F00FA68A40>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001F00FA68A40>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441861 is not handled. Duration 15 ms by bot id=7064840472
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000015A6CDB8A40>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000015A6CDB8A40>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441862 is not handled. Duration 264 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778441862 by bot id=7064840472
AttributeError: 'Dispatcher' object has no attribute 'bot'
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 18, in basket_menu
    await send_basket(chat_id=call.message.chat.id, user_id=call.from_user.id)
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 49, in send_basket
    await dp.bot.send_message(chat_id=chat_id, text=string, reply_markup=markup, parse_mode="HTML")
          ^^^^^^
AttributeError: 'Dispatcher' object has no attribute 'bot'
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000020C57B78180>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000020C57B78180>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441863 is handled. Duration 405 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441864 is handled. Duration 297 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441865 is not handled. Duration 16 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441866 is handled. Duration 297 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441867 is handled. Duration 186 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441868 is handled. Duration 202 ms by bot id=7064840472
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000021605E5C180>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000021605E5C180>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441869 is handled. Duration 375 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441870 is handled. Duration 359 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441871 is handled. Duration 188 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441872 is handled. Duration 203 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441873 is handled. Duration 266 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441874 is handled. Duration 358 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441875 is handled. Duration 202 ms by bot id=7064840472
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000002B02D218900>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000002B02D218900>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441876 is handled. Duration 265 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441877 is handled. Duration 233 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441878 is handled. Duration 250 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441879 is handled. Duration 327 ms by bot id=7064840472
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000020EDE7A8A40>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000020EDE7A8A40>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441880 is handled. Duration 266 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441881 is handled. Duration 343 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441882 is handled. Duration 281 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441883 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778441883 by bot id=7064840472
TypeError: get_promos() missing 1 required positional argument: 'count'
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 23, in basketAdd_
    ids = await get_promos(int(call.data.split('_')[1]))
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: get_promos() missing 1 required positional argument: 'count'
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000027F11464040>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000027F11464040>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441884 is handled. Duration 531 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441885 is not handled. Duration 296 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778441885 by bot id=7064840472
KeyError: 'category'
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 18, in basket_menu
    await send_basket(chat_id=call.message.chat.id, user_id=call.from_user.id)
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 35, in send_basket
    markup = await inline_kb_menu.basket_markup(basket=basket, bonus=bonus)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\keyboards\inline\inline_kb_menu.py", line 31, in basket_markup
    btns.append([InlineKeyboardButton(text=f'{tovar["tovar"]}', callback_data=f'tovar-info_1_{tovar["category"]}_{tovar["id"]}_1'),
                                                                                              ~~~~~^^^^^^^^^^^^
KeyError: 'category'
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000019153C48400>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000019153C48400>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441886 is handled. Duration 280 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441887 is handled. Duration 219 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441888 is handled. Duration 327 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441889 is handled. Duration 328 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441890 is not handled. Duration 141 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778441890 by bot id=7064840472
TypeError: object of type 'int' has no len()
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 18, in basket_menu
    await send_basket(chat_id=call.message.chat.id, user_id=call.from_user.id)
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 35, in send_basket
    markup = await inline_kb_menu.basket_markup(basket=basket, bonus=bonus)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\keyboards\inline\inline_kb_menu.py", line 29, in basket_markup
    if len(basket) > 0:
       ^^^^^^^^^^^
TypeError: object of type 'int' has no len()
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x00000172294A8400>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x00000172294A8400>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441891 is handled. Duration 983 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441892 is handled. Duration 203 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441893 is handled. Duration 218 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441894 is handled. Duration 250 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441895 is handled. Duration 204 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441896 is handled. Duration 188 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441897 is handled. Duration 407 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441898 is not handled. Duration 79 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778441898 by bot id=7064840472
TypeError: tuple indices must be integers or slices, not str
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 18, in basket_menu
    await send_basket(chat_id=call.message.chat.id, user_id=call.from_user.id)
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 36, in send_basket
    markup = await inline_kb_menu.basket_markup(basket=basket, bonus=bonus)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\keyboards\inline\inline_kb_menu.py", line 31, in basket_markup
    btns.append([InlineKeyboardButton(text=f'{tovar["tovar"]}', callback_data=f'tovar-info_1_{tovar["category"]}_{tovar["id"]}_1'),
                                              ~~~~~^^^^^^^^^
TypeError: tuple indices must be integers or slices, not str
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x00000288E0478540>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x00000288E0478540>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441899 is handled. Duration 297 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441900 is handled. Duration 342 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441901 is handled. Duration 311 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441902 is handled. Duration 297 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441903 is not handled. Duration 77 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778441903 by bot id=7064840472
KeyError: 'id'
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 18, in basket_menu
    await send_basket(chat_id=call.message.chat.id, user_id=call.from_user.id)
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 34, in send_basket
    basket = [(record["id"], record["price"], record["amount"]) for record in basket]
               ~~~~~~^^^^^^
KeyError: 'id'
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000014733F882C0>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000014733F882C0>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441904 is handled. Duration 264 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441905 is handled. Duration 266 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441906 is handled. Duration 233 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441907 is handled. Duration 359 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441908 is not handled. Duration 156 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778441908 by bot id=7064840472
KeyError: 'id'
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 18, in basket_menu
    await send_basket(chat_id=call.message.chat.id, user_id=call.from_user.id)
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 34, in send_basket
    basket = [(record["id"], record["price"], record["amount"]) for record in basket]
               ~~~~~~^^^^^^
KeyError: 'id'
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000023F1EA94900>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000023F1EA94900>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441909 is handled. Duration 343 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441910 is handled. Duration 187 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441911 is handled. Duration 250 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441912 is handled. Duration 280 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441913 is not handled. Duration 141 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778441913 by bot id=7064840472
TypeError: tuple indices must be integers or slices, not str
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 18, in basket_menu
    await send_basket(chat_id=call.message.chat.id, user_id=call.from_user.id)
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 36, in send_basket
    markup = await inline_kb_menu.basket_markup(basket=basket, bonus=bonus)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\keyboards\inline\inline_kb_menu.py", line 31, in basket_markup
    btns.append([InlineKeyboardButton(text=f'{tovar["tovar"]}', callback_data=f'tovar-info_1_{tovar["category"]}_{tovar["id"]}_1'),
                                              ~~~~~^^^^^^^^^
TypeError: tuple indices must be integers or slices, not str
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001D097C3C2C0>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001D097C3C2C0>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441914 is handled. Duration 311 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441915 is handled. Duration 186 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441916 is handled. Duration 344 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441917 is handled. Duration 327 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441918 is not handled. Duration 203 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778441918 by bot id=7064840472
IndexError: tuple index out of range
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 18, in basket_menu
    await send_basket(chat_id=call.message.chat.id, user_id=call.from_user.id)
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 36, in send_basket
    markup = await inline_kb_menu.basket_markup(basket=basket, bonus=bonus)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\keyboards\inline\inline_kb_menu.py", line 33, in basket_markup
    InlineKeyboardButton(text=f'{tovar[len(basket)]}.', callback_data=f'setCoun'),
                                 ~~~~~^^^^^^^^^^^^^
IndexError: tuple index out of range
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000002B199A48040>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000002B199A48040>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441919 is handled. Duration 281 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441920 is handled. Duration 187 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441921 is handled. Duration 204 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441922 is handled. Duration 281 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441923 is not handled. Duration 108 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778441923 by bot id=7064840472
TypeError: tuple indices must be integers or slices, not str
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 18, in basket_menu
    await send_basket(chat_id=call.message.chat.id, user_id=call.from_user.id)
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 46, in send_basket
    summ += tovar["price"] * len(basket)
            ~~~~~^^^^^^^^^
TypeError: tuple indices must be integers or slices, not str
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000027EABE08040>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000027EABE08040>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441924 is handled. Duration 311 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441925 is handled. Duration 218 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441926 is handled. Duration 250 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441927 is handled. Duration 266 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441928 is handled. Duration 282 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441929 is handled. Duration 407 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441930 is handled. Duration 545 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441931 is not handled. Duration 45 ms by bot id=7064840472
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000015CD91F8540>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000015CD91F8540>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000022FF1B28540>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000022FF1B28540>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000022FF1B05B20>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-13' coro=<Event.wait() running at C:\Python312\Lib\asyncio\locks.py:212> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_wait.<locals>._on_completion() at C:\Python312\Lib\asyncio\tasks.py:534]>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-12' coro=<Dispatcher._polling() running at C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py:345> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_wait.<locals>._on_completion() at C:\Python312\Lib\asyncio\tasks.py:534]>
INFO:aiogram.dispatcher:Polling stopped for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.dispatcher:Polling stopped
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441932 is handled. Duration 297 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441933 is handled. Duration 187 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441934 is handled. Duration 454 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441935 is handled. Duration 469 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441936 is handled. Duration 250 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441937 is not handled. Duration 0 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441938 is not handled. Duration 14 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441939 is not handled. Duration 0 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441940 is not handled. Duration 0 ms by bot id=7064840472
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000002A9A0388540>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000002A9A0388540>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441941 is handled. Duration 264 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441942 is handled. Duration 218 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441943 is handled. Duration 109 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441944 is handled. Duration 592 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441945 is handled. Duration 282 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441946 is handled. Duration 297 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441947 is handled. Duration 218 ms by bot id=7064840472
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x00000196E3058A40>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x00000196E3058A40>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441948 is handled. Duration 343 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441949 is handled. Duration 186 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441950 is handled. Duration 233 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441951 is handled. Duration 297 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441952 is handled. Duration 203 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441953 is not handled. Duration 0 ms by bot id=7064840472
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000021BCA768040>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000021BCA768040>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000018992EECA40>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000018992EECA40>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000018992EC93A0>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-13' coro=<Event.wait() running at C:\Python312\Lib\asyncio\locks.py:212> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_wait.<locals>._on_completion() at C:\Python312\Lib\asyncio\tasks.py:534]>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-12' coro=<Dispatcher._polling() running at C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py:345> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_wait.<locals>._on_completion() at C:\Python312\Lib\asyncio\tasks.py:534]>
INFO:aiogram.dispatcher:Polling stopped for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.dispatcher:Polling stopped
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441954 is handled. Duration 281 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441955 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778441955 by bot id=7064840472
TypeError: tovar_info_markup() got an unexpected keyword argument 'user_id'
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 149, in tovar_info_menu
    markup = await inline_kb_menu.tovar_info_markup(user_id=call.from_user.id, amount=amount)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: tovar_info_markup() got an unexpected keyword argument 'user_id'
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001A237898B80>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001A237898B80>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441956 is handled. Duration 311 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441957 is not handled. Duration 32 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778441957 by bot id=7064840472
TypeError: tovar_info_markup() got an unexpected keyword argument 'user_id'
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 149, in tovar_info_menu
    markup = await inline_kb_menu.tovar_info_markup(user_id=call.from_user.id, amount=amount)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: tovar_info_markup() got an unexpected keyword argument 'user_id'
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001A3C0A8C900>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001A3C0A8C900>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441958 is handled. Duration 266 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441959 is handled. Duration 890 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441960 is not handled. Duration 0 ms by bot id=7064840472
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x00000205D200CB80>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x00000205D200CB80>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441961 is handled. Duration 406 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441962 is handled. Duration 328 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441963 is not handled. Duration 16 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778441963 by bot id=7064840472
ValueError: invalid literal for int() with base 10: '   :'
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 165, in handle_count
    if int(data["count"]) > count:
       ^^^^^^^^^^^^^^^^^^
ValueError: invalid literal for int() with base 10: '   :'
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x00000279FDF0CB80>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x00000279FDF0CB80>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000002644E648B80>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000002644E648B80>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000002644E624C20>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-13' coro=<Event.wait() running at C:\Python312\Lib\asyncio\locks.py:212> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_wait.<locals>._on_completion() at C:\Python312\Lib\asyncio\tasks.py:534]>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-12' coro=<Dispatcher._polling() running at C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py:345> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_wait.<locals>._on_completion() at C:\Python312\Lib\asyncio\tasks.py:534]>
INFO:aiogram.dispatcher:Polling stopped for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.dispatcher:Polling stopped
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000020A1C6782C0>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000020A1C6782C0>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000020A1C659580>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-13' coro=<Event.wait() running at C:\Python312\Lib\asyncio\locks.py:212> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_wait.<locals>._on_completion() at C:\Python312\Lib\asyncio\tasks.py:534]>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-12' coro=<Dispatcher._polling() running at C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py:345> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_wait.<locals>._on_completion() at C:\Python312\Lib\asyncio\tasks.py:534]>
INFO:aiogram.dispatcher:Polling stopped for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.dispatcher:Polling stopped
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441964 is handled. Duration 282 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441965 is handled. Duration 297 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441966 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778441966 by bot id=7064840472
TypeError: basketAdd_() missing 1 required positional argument: 'call'
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 171, in handle_count
    await basketAdd_()
          ^^^^^^^^^^^^
TypeError: basketAdd_() missing 1 required positional argument: 'call'
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000018E1FFC87C0>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000018E1FFC87C0>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441967 is handled. Duration 281 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441968 is handled. Duration 531 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441969 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778441969 by bot id=7064840472
AttributeError: 'str' object has no attribute 'data'
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 171, in handle_count
    await basketAdd_(call=f'tovar-info_{data["amount"]}')
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 34, in basketAdd_
    print(call.data)
          ^^^^^^^^^
AttributeError: 'str' object has no attribute 'data'
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x00000154DDBE8A40>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x00000154DDBE8A40>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441970 is handled. Duration 280 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441971 is handled. Duration 282 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441972 is not handled. Duration 14 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778441972 by bot id=7064840472
TypeError: BaseModel.__init__() takes 1 positional argument but 2 were given
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 171, in handle_count
    await basketAdd_(call=types.CallbackQuery(f'tovar-info_{data["amount"]}'))
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: BaseModel.__init__() takes 1 positional argument but 2 were given
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000026CF3FE8400>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000026CF3FE8400>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441973 is handled. Duration 360 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441974 is handled. Duration 483 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441975 is not handled. Duration 16 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778441975 by bot id=7064840472
ValidationError: 3 validation errors for CallbackQuery
id
  Field required [type=missing, input_value={'data': 'tovar-info_60',...None, user_shared=None)}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.8/v/missing
from
  Field required [type=missing, input_value={'data': 'tovar-info_60',...None, user_shared=None)}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.8/v/missing
chat_instance
  Field required [type=missing, input_value={'data': 'tovar-info_60',...None, user_shared=None)}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.8/v/missing
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 158, in handle_count
    call = types.CallbackQuery(data=f'tovar-info_{data["amount"]}', message=message)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\pydantic\main.py", line 193, in __init__
    self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 3 validation errors for CallbackQuery
id
  Field required [type=missing, input_value={'data': 'tovar-info_60',...None, user_shared=None)}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.8/v/missing
from
  Field required [type=missing, input_value={'data': 'tovar-info_60',...None, user_shared=None)}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.8/v/missing
chat_instance
  Field required [type=missing, input_value={'data': 'tovar-info_60',...None, user_shared=None)}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.8/v/missing
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x00000200FFB582C0>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x00000200FFB582C0>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441976 is handled. Duration 266 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441977 is handled. Duration 327 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441978 is handled. Duration 108 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441979 is handled. Duration 282 ms by bot id=7064840472
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001CF8DB382C0>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001CF8DB382C0>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441980 is handled. Duration 343 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441981 is handled. Duration 593 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441982 is handled. Duration 172 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441983 is handled. Duration 405 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441984 is handled. Duration 250 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441985 is not handled. Duration 0 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441986 is handled. Duration 296 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441987 is handled. Duration 328 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441988 is handled. Duration 93 ms by bot id=7064840472
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001E99EAE42C0>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001E99EAE42C0>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441989 is handled. Duration 297 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441990 is handled. Duration 547 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441991 is handled. Duration 156 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441992 is handled. Duration 297 ms by bot id=7064840472
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000002A17D70C2C0>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000002A17D70C2C0>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441993 is handled. Duration 327 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441994 is handled. Duration 313 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441995 is handled. Duration 93 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441996 is handled. Duration 343 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441997 is handled. Duration 234 ms by bot id=7064840472
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000002D328654A40>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000002D328654A40>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778441998 is handled. Duration 407 ms by bot id=7064840472
INFO:aiogram.event:Update id=778441999 is handled. Duration 343 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442000 is handled. Duration 157 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442001 is handled. Duration 282 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442002 is handled. Duration 264 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442003 is handled. Duration 265 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442004 is handled. Duration 141 ms by bot id=7064840472
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000023383BC4900>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000023383BC4900>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442005 is handled. Duration 281 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442006 is handled. Duration 125 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442007 is handled. Duration 438 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442008 is handled. Duration 250 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442009 is handled. Duration 217 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442010 is handled. Duration 92 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442011 is handled. Duration 266 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442012 is handled. Duration 140 ms by bot id=7064840472
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000028C9DCC8400>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000028C9DCC8400>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442013 is handled. Duration 312 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442014 is not handled. Duration 15 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442015 is handled. Duration 125 ms by bot id=7064840472
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001A698138680>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001A698138680>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442016 is handled. Duration 312 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442017 is handled. Duration 311 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442018 is handled. Duration 108 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442019 is handled. Duration 250 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442020 is handled. Duration 217 ms by bot id=7064840472
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001EA1EF88A40>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001EA1EF88A40>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x00000208DC7C8400>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x00000208DC7C8400>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x00000208DC7CDE80>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-13' coro=<Event.wait() running at C:\Python312\Lib\asyncio\locks.py:212> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_wait.<locals>._on_completion() at C:\Python312\Lib\asyncio\tasks.py:534]>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-12' coro=<Dispatcher._polling() running at C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py:345> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_wait.<locals>._on_completion() at C:\Python312\Lib\asyncio\tasks.py:534]>
INFO:aiogram.dispatcher:Polling stopped for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.dispatcher:Polling stopped
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442021 is handled. Duration 343 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442022 is handled. Duration 125 ms by bot id=7064840472
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001A582F287C0>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001A582F287C0>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442023 is handled. Duration 391 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442024 is handled. Duration 297 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442025 is handled. Duration 218 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442026 is handled. Duration 250 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442027 is handled. Duration 219 ms by bot id=7064840472
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000024D99EA8180>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000024D99EA8180>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442028 is not handled. Duration 0 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442029 is handled. Duration 281 ms by bot id=7064840472
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000013DEB8C8680>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000013DEB8C8680>
RuntimeError: aclose(): asynchronous generator is already running
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000022217948540>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000022217948540>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:12> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000002221794E960>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-14' coro=<Event.wait() running at C:\Python312\Lib\asyncio\locks.py:212> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_wait.<locals>._on_completion() at C:\Python312\Lib\asyncio\tasks.py:534]>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-13' coro=<Dispatcher._polling() running at C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py:345> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_wait.<locals>._on_completion() at C:\Python312\Lib\asyncio\tasks.py:534]>
INFO:aiogram.dispatcher:Polling stopped for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.dispatcher:Polling stopped
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:root:Checking for expired items at 2024-08-01 19:40:28.372392. Expiration time: 2024-08-01 19:39:28.372392
INFO:root:Expired items: [<Record product_id=5>, <Record product_id=2>, <Record product_id=4>, <Record product_id=1>, <Record product_id=7>, <Record product_id=9>]
INFO:root:Cleared expired items at 2024-08-01 19:40:28.389083
INFO:root:Checking for expired items at 2024-08-01 19:41:28.405696. Expiration time: 2024-08-01 19:40:28.405696
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x00000247C32F82C0>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x00000247C32F82C0>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x00000247C2D93110>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-14' coro=<Event.wait() running at C:\Python312\Lib\asyncio\locks.py:212> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_wait.<locals>._on_completion() at C:\Python312\Lib\asyncio\tasks.py:534]>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-13' coro=<Dispatcher._polling() running at C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py:345> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_wait.<locals>._on_completion() at C:\Python312\Lib\asyncio\tasks.py:534]>
INFO:aiogram.dispatcher:Polling stopped for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.dispatcher:Polling stopped
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442030 is handled. Duration 546 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442031 is handled. Duration 186 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442032 is handled. Duration 312 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442033 is not handled. Duration 141 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442033 by bot id=7064840472
ValidationError: 2 validation errors for InlineKeyboardMarkup
inline_keyboard.0.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=[InlineKeyboardButton(tex...ck_game=None, pay=None)], input_type=list]
    For further information visit https://errors.pydantic.dev/2.8/v/model_type
inline_keyboard.0.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=[InlineKeyboardButton(tex...ck_game=None, pay=None)], input_type=list]
    For further information visit https://errors.pydantic.dev/2.8/v/model_type
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 30, in basket_menu
    await send_basket(chat_id=call.message.chat.id, user_id=call.from_user.id)
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 81, in send_basket
    markup = await inline_kb_menu.basket_markup(basket=basket)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\keyboards\inline\inline_kb_menu.py", line 66, in basket_markup
    return InlineKeyboardMarkup(inline_keyboard=btns)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\pydantic\main.py", line 193, in __init__
    self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 2 validation errors for InlineKeyboardMarkup
inline_keyboard.0.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=[InlineKeyboardButton(tex...ck_game=None, pay=None)], input_type=list]
    For further information visit https://errors.pydantic.dev/2.8/v/model_type
inline_keyboard.0.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=[InlineKeyboardButton(tex...ck_game=None, pay=None)], input_type=list]
    For further information visit https://errors.pydantic.dev/2.8/v/model_type
INFO:root:Checking for expired items at 2024-08-01 23:07:24.461733. Expiration time: 2024-08-01 23:06:24.461733
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001F7F5A84040>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001F7F5A84040>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442034 is not handled. Duration 16 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442034 by bot id=7064840472
ValidationError: 2 validation errors for InlineKeyboardMarkup
inline_keyboard.0.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=[InlineKeyboardButton(tex...ck_game=None, pay=None)], input_type=list]
    For further information visit https://errors.pydantic.dev/2.8/v/model_type
inline_keyboard.0.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=[InlineKeyboardButton(tex...ck_game=None, pay=None)], input_type=list]
    For further information visit https://errors.pydantic.dev/2.8/v/model_type
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\keyboard_menu.py", line 17, in show_basket
    await send_basket(chat_id=message.chat.id, user_id=message.chat.id)
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 81, in send_basket
    markup = await inline_kb_menu.basket_markup(basket=basket)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\keyboards\inline\inline_kb_menu.py", line 66, in basket_markup
    return InlineKeyboardMarkup(inline_keyboard=btns)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\pydantic\main.py", line 193, in __init__
    self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 2 validation errors for InlineKeyboardMarkup
inline_keyboard.0.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=[InlineKeyboardButton(tex...ck_game=None, pay=None)], input_type=list]
    For further information visit https://errors.pydantic.dev/2.8/v/model_type
inline_keyboard.0.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=[InlineKeyboardButton(tex...ck_game=None, pay=None)], input_type=list]
    For further information visit https://errors.pydantic.dev/2.8/v/model_type
INFO:root:Checking for expired items at 2024-08-01 23:08:54.459129. Expiration time: 2024-08-01 23:07:54.459129
INFO:root:Expired items: [<Record product_id=5>, <Record product_id=2>, <Record product_id=4>]
INFO:root:Cleared expired items at 2024-08-01 23:08:54.463210
INFO:root:Checking for expired items at 2024-08-01 23:09:54.454106. Expiration time: 2024-08-01 23:08:54.454106
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-01 23:10:54.460325. Expiration time: 2024-08-01 23:09:54.460325
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-01 23:11:54.461384. Expiration time: 2024-08-01 23:10:54.461384
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-01 23:12:54.433584. Expiration time: 2024-08-01 23:11:54.433584
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-01 23:13:54.450041. Expiration time: 2024-08-01 23:12:54.450041
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-01 23:14:54.462863. Expiration time: 2024-08-01 23:13:54.462863
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000017B6E780040>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000017B6E780040>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442035 is handled. Duration 281 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442036 is handled. Duration 343 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442037 is handled. Duration 109 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442038 is handled. Duration 311 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442039 is handled. Duration 219 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442040 is not handled. Duration 16 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442041 is not handled. Duration 0 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442042 is not handled. Duration 0 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442043 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442043 by bot id=7064840472
ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={'row_width': 2}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.8/v/missing
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 173, in process_payment
    markup = InlineKeyboardMarkup(row_width=2)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\pydantic\main.py", line 193, in __init__
    self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={'row_width': 2}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.8/v/missing
INFO:root:Checking for expired items at 2024-08-01 23:19:31.989468. Expiration time: 2024-08-01 23:18:31.989468
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001183B910040>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001183B910040>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442044 is not handled. Duration 0 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442045 is handled. Duration 297 ms by bot id=7064840472
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000019808F14540>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000019808F14540>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442046 is handled. Duration 358 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442047 is not handled. Duration 15 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442047 by bot id=7064840472
TypeError: Message.answer() missing 1 required positional argument: 'text'
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\keyboard_menu.py", line 21, in show_balance
    await message.answer()
          ^^^^^^^^^^^^^^^^
TypeError: Message.answer() missing 1 required positional argument: 'text'
INFO:root:Checking for expired items at 2024-08-01 23:22:53.354967. Expiration time: 2024-08-01 23:21:53.354967
INFO:root:Expired items: [<Record product_id=5>, <Record product_id=2>, <Record product_id=4>]
INFO:root:Cleared expired items at 2024-08-01 23:22:53.354967
INFO:root:Checking for expired items at 2024-08-01 23:23:53.362402. Expiration time: 2024-08-01 23:22:53.362402
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-01 23:24:53.369580. Expiration time: 2024-08-01 23:23:53.369580
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-01 23:25:53.376201. Expiration time: 2024-08-01 23:24:53.376201
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-01 23:26:53.360003. Expiration time: 2024-08-01 23:25:53.360003
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x00000206AEC4C900>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x00000206AEC4C900>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442048 is not handled. Duration 16 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442048 by bot id=7064840472
TypeError: unsupported format string passed to list.__format__
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\keyboard_menu.py", line 22, in show_balance
    await message.answer(f"{message.from_user.username},   : \n\n {balance:.3f}\U0001f4b2",
                                                                                ^^^^^^^^^^^^^
TypeError: unsupported format string passed to list.__format__
INFO:root:Checking for expired items at 2024-08-01 23:34:00.361238. Expiration time: 2024-08-01 23:33:00.361238
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000027802EBC7C0>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000027802EBC7C0>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442049 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442049 by bot id=7064840472
TypeError: unsupported format string passed to list.__format__
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\keyboard_menu.py", line 22, in show_balance
    await message.answer(f"{message.from_user.username},   : \n \n {balance:.3f}\U0001f4b2",
                                                                                 ^^^^^^^^^^^^^
TypeError: unsupported format string passed to list.__format__
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000002A7DE558180>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000002A7DE558180>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442050 is not handled. Duration 15 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442050 by bot id=7064840472
TypeError: unsupported format string passed to list.__format__
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\keyboard_menu.py", line 22, in show_balance
    await message.answer(f"{message.from_user.username},   : \n{balance:.3f}\U0001f4b2",
                                                                             ^^^^^^^^^^^^^
TypeError: unsupported format string passed to list.__format__
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x00000210932DC900>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x00000210932DC900>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442051 is not handled. Duration 16 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442051 by bot id=7064840472
TypeError: BaseModel.__init__() takes 1 positional argument but 2 were given
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\keyboard_menu.py", line 23, in show_balance
    reply_markup=types.InlineKeyboardMarkup([types.InlineKeyboardButton(text=' ',
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: BaseModel.__init__() takes 1 positional argument but 2 were given
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001A269B08A40>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001A269B08A40>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442052 is not handled. Duration 16 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442052 by bot id=7064840472
TypeError: BaseModel.__init__() takes 1 positional argument but 2 were given
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\keyboard_menu.py", line 23, in show_balance
    reply_markup=[types.InlineKeyboardMarkup(types.InlineKeyboardButton(text=' ',
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: BaseModel.__init__() takes 1 positional argument but 2 were given
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001F9B680C7C0>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001F9B680C7C0>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442053 is not handled. Duration 16 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442053 by bot id=7064840472
TypeError: BaseModel.__init__() takes 1 positional argument but 2 were given
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\keyboard_menu.py", line 23, in show_balance
    reply_markup=types.InlineKeyboardMarkup(types.InlineKeyboardButton(text=' ',
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: BaseModel.__init__() takes 1 positional argument but 2 were given
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001D2737B4900>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001D2737B4900>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442054 is not handled. Duration 16 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442054 by bot id=7064840472
ValidationError: 4 validation errors for SendMessage
reply_markup.InlineKeyboardMarkup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=InlineKeyboardButton(text...ack_game=None, pay=None), input_type=InlineKeyboardButton]
    For further information visit https://errors.pydantic.dev/2.8/v/model_type
reply_markup.ReplyKeyboardMarkup
  Input should be a valid dictionary or instance of ReplyKeyboardMarkup [type=model_type, input_value=InlineKeyboardButton(text...ack_game=None, pay=None), input_type=InlineKeyboardButton]
    For further information visit https://errors.pydantic.dev/2.8/v/model_type
reply_markup.ReplyKeyboardRemove
  Input should be a valid dictionary or instance of ReplyKeyboardRemove [type=model_type, input_value=InlineKeyboardButton(text...ack_game=None, pay=None), input_type=InlineKeyboardButton]
    For further information visit https://errors.pydantic.dev/2.8/v/model_type
reply_markup.ForceReply
  Input should be a valid dictionary or instance of ForceReply [type=model_type, input_value=InlineKeyboardButton(text...ack_game=None, pay=None), input_type=InlineKeyboardButton]
    For further information visit https://errors.pydantic.dev/2.8/v/model_type
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\keyboard_menu.py", line 22, in show_balance
    await message.answer(f"{message.from_user.username},   : \n{balance:.3f}\U0001f4b2",
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\types\message.py", line 2044, in answer
    return SendMessage(
           ^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\pydantic\main.py", line 193, in __init__
    self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 4 validation errors for SendMessage
reply_markup.InlineKeyboardMarkup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=InlineKeyboardButton(text...ack_game=None, pay=None), input_type=InlineKeyboardButton]
    For further information visit https://errors.pydantic.dev/2.8/v/model_type
reply_markup.ReplyKeyboardMarkup
  Input should be a valid dictionary or instance of ReplyKeyboardMarkup [type=model_type, input_value=InlineKeyboardButton(text...ack_game=None, pay=None), input_type=InlineKeyboardButton]
    For further information visit https://errors.pydantic.dev/2.8/v/model_type
reply_markup.ReplyKeyboardRemove
  Input should be a valid dictionary or instance of ReplyKeyboardRemove [type=model_type, input_value=InlineKeyboardButton(text...ack_game=None, pay=None), input_type=InlineKeyboardButton]
    For further information visit https://errors.pydantic.dev/2.8/v/model_type
reply_markup.ForceReply
  Input should be a valid dictionary or instance of ForceReply [type=model_type, input_value=InlineKeyboardButton(text...ack_game=None, pay=None), input_type=InlineKeyboardButton]
    For further information visit https://errors.pydantic.dev/2.8/v/model_type
INFO:root:Checking for expired items at 2024-08-01 23:38:51.119627. Expiration time: 2024-08-01 23:37:51.119627
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001F68C6D8A40>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001F68C6D8A40>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442055 is handled. Duration 295 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442056 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442056 by bot id=7064840472
ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.8/v/missing
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\keyboard_menu.py", line 24, in show_balance
    markup = types.InlineKeyboardMarkup()
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\pydantic\main.py", line 193, in __init__
    self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.8/v/missing
INFO:root:Checking for expired items at 2024-08-01 23:40:36.999830. Expiration time: 2024-08-01 23:39:36.999830
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001D7E1EDC180>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001D7E1EDC180>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442057 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442057 by bot id=7064840472
ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={'row_width': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.8/v/missing
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\keyboard_menu.py", line 24, in show_balance
    markup = types.InlineKeyboardMarkup(row_width=1)  #   row_width      
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\pydantic\main.py", line 193, in __init__
    self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={'row_width': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.8/v/missing
INFO:root:Checking for expired items at 2024-08-01 23:42:17.296809. Expiration time: 2024-08-01 23:41:17.296809
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-01 23:43:17.312365. Expiration time: 2024-08-01 23:42:17.312365
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000002304817C900>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000002304817C900>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442058 is not handled. Duration 16 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442058 by bot id=7064840472
ValidationError: 10 validation errors for InlineKeyboardMarkup
inline_keyboard.0.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', ' '), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.8/v/model_type
inline_keyboard.0.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.8/v/model_type
inline_keyboard.0.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'categories'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.8/v/model_type
inline_keyboard.0.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.8/v/model_type
inline_keyboard.0.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.8/v/model_type
inline_keyboard.0.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.8/v/model_type
inline_keyboard.0.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.8/v/model_type
inline_keyboard.0.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.8/v/model_type
inline_keyboard.0.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.8/v/model_type
inline_keyboard.0.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.8/v/model_type
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\keyboard_menu.py", line 25, in show_balance
    markup = types.InlineKeyboardMarkup(inline_keyboard=btn)  #   row_width      
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\pydantic\main.py", line 193, in __init__
    self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 10 validation errors for InlineKeyboardMarkup
inline_keyboard.0.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', ' '), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.8/v/model_type
inline_keyboard.0.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.8/v/model_type
inline_keyboard.0.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'categories'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.8/v/model_type
inline_keyboard.0.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.8/v/model_type
inline_keyboard.0.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.8/v/model_type
inline_keyboard.0.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.8/v/model_type
inline_keyboard.0.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.8/v/model_type
inline_keyboard.0.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.8/v/model_type
inline_keyboard.0.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.8/v/model_type
inline_keyboard.0.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.8/v/model_type
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001E8DD68C900>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001E8DD68C900>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442059 is handled. Duration 390 ms by bot id=7064840472
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001A0F335C7C0>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001A0F335C7C0>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442060 is handled. Duration 327 ms by bot id=7064840472
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001BDF61C87C0>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001BDF61C87C0>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442061 is handled. Duration 313 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442062 is not handled. Duration 16 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442062 by bot id=7064840472
ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.8/v/missing
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 173, in process_payment
    markup = InlineKeyboardMarkup()
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\pydantic\main.py", line 193, in __init__
    self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.8/v/missing
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001EC1ACF8A40>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001EC1ACF8A40>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442063 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442063 by bot id=7064840472
ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.8/v/missing
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 173, in process_payment
    markup = InlineKeyboardMarkup()
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\pydantic\main.py", line 193, in __init__
    self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.8/v/missing
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001CFB2A34A40>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001CFB2A34A40>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442064 is handled. Duration 405 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-01 23:49:42.615756. Expiration time: 2024-08-01 23:48:42.615756
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-01 23:50:42.641823. Expiration time: 2024-08-01 23:49:42.641823
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-01 23:51:42.651326. Expiration time: 2024-08-01 23:50:42.651326
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-01 23:52:42.656409. Expiration time: 2024-08-01 23:51:42.656409
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-01 23:53:42.672603. Expiration time: 2024-08-01 23:52:42.672603
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-01 23:54:42.691405. Expiration time: 2024-08-01 23:53:42.691405
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-01 23:55:42.689407. Expiration time: 2024-08-01 23:54:42.689407
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-01 23:56:42.694077. Expiration time: 2024-08-01 23:55:42.694077
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x00000182C96C4A40>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x00000182C96C4A40>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442065 is not handled. Duration 0 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-02 00:52:56.478447. Expiration time: 2024-08-02 00:51:56.478447
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x00000273F9798540>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x00000273F9798540>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442066 is not handled. Duration 16 ms by bot id=7064840472
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x00000221A28D8A40>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x00000221A28D8A40>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442067 is not handled. Duration 0 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442068 is handled. Duration 452 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442069 is handled. Duration 609 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442070 is handled. Duration 282 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442071 is not handled. Duration 16 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-02 00:55:07.169586. Expiration time: 2024-08-02 00:54:07.169586
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-02 00:56:07.179310. Expiration time: 2024-08-02 00:55:07.179310
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-02 00:57:07.214098. Expiration time: 2024-08-02 00:56:07.214098
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-02 00:58:07.234052. Expiration time: 2024-08-02 00:57:07.234052
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-02 00:59:07.238312. Expiration time: 2024-08-02 00:58:07.238312
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-02 01:00:07.239673. Expiration time: 2024-08-02 00:59:07.239673
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-02 01:01:07.279078. Expiration time: 2024-08-02 01:00:07.279078
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-02 01:02:07.288108. Expiration time: 2024-08-02 01:01:07.288108
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-02 01:03:07.317279. Expiration time: 2024-08-02 01:02:07.317279
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-02 01:04:07.321798. Expiration time: 2024-08-02 01:03:07.321798
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-02 01:05:07.328735. Expiration time: 2024-08-02 01:04:07.328735
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-02 01:06:07.341867. Expiration time: 2024-08-02 01:05:07.341867
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-02 01:07:07.358971. Expiration time: 2024-08-02 01:06:07.358971
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-02 01:08:07.371150. Expiration time: 2024-08-02 01:07:07.371150
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-02 01:09:07.389069. Expiration time: 2024-08-02 01:08:07.389069
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001741E8787C0>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001741E8787C0>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442072 is handled. Duration 265 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442073 is handled. Duration 202 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442074 is handled. Duration 313 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442075 is handled. Duration 203 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442076 is handled. Duration 593 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442077 is handled. Duration 704 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442078 is handled. Duration 218 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-02 01:12:49.861146. Expiration time: 2024-08-02 01:11:49.861146
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-02 01:13:49.892228. Expiration time: 2024-08-02 01:12:49.892228
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000016416EC8540>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000016416EC8540>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442079 is not handled. Duration 0 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442080 is handled. Duration 359 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442081 is handled. Duration 483 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442082 is handled. Duration 217 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442083 is handled. Duration 204 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442084 is handled. Duration 313 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442085 is not handled. Duration 16 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442085 by bot id=7064840472
DataError: invalid input for query argument $2: 'trans_id' ('str' object cannot be interpreted as an integer)
Traceback (most recent call last):
  File "asyncpg\protocol\prepared_stmt.pyx", line 175, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
  File "asyncpg\protocol\codecs/base.pyx", line 227, in asyncpg.protocol.protocol.Codec.encode
  File "asyncpg\protocol\codecs/base.pyx", line 129, in asyncpg.protocol.protocol.Codec.encode_scalar
  File "asyncpg\pgproto\./codecs/int.pyx", line 54, in asyncpg.pgproto.pgproto.int4_encode
TypeError: 'str' object cannot be interpreted as an integer

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\admin.py", line 70, in accept_transaction_admin
    await accept_transaction(data["user_id"], data["operation_id"])
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\utils\db_api\db_asyncpg.py", line 34, in accept_transaction
    await connection.execute('''
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 353, in execute
    _, status, _ = await self._execute(
                   ^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1794, in _execute
    result, _ = await self.__execute(
                ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1892, in __execute
    result, stmt = await self._do_execute(
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1945, in _do_execute
    result = await executor(stmt, None)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\protocol\protocol.pyx", line 186, in bind_execute
  File "asyncpg\protocol\prepared_stmt.pyx", line 204, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
asyncpg.exceptions.DataError: invalid input for query argument $2: 'trans_id' ('str' object cannot be interpreted as an integer)
INFO:root:Checking for expired items at 2024-08-02 01:15:38.944632. Expiration time: 2024-08-02 01:14:38.944632
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000021B9C634680>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000021B9C634680>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442086 is handled. Duration 343 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442087 is handled. Duration 407 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442088 is handled. Duration 202 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442089 is handled. Duration 94 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442090 is handled. Duration 311 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442091 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442091 by bot id=7064840472
DataError: invalid input for query argument $2: 'id' ('str' object cannot be interpreted as an integer)
Traceback (most recent call last):
  File "asyncpg\protocol\prepared_stmt.pyx", line 175, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
  File "asyncpg\protocol\codecs/base.pyx", line 227, in asyncpg.protocol.protocol.Codec.encode
  File "asyncpg\protocol\codecs/base.pyx", line 129, in asyncpg.protocol.protocol.Codec.encode_scalar
  File "asyncpg\pgproto\./codecs/int.pyx", line 54, in asyncpg.pgproto.pgproto.int4_encode
TypeError: 'str' object cannot be interpreted as an integer

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\admin.py", line 70, in accept_transaction_admin
    await accept_transaction(data["user_id"], data["operation_id"])
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\utils\db_api\db_asyncpg.py", line 34, in accept_transaction
    await connection.execute('''
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 353, in execute
    _, status, _ = await self._execute(
                   ^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1794, in _execute
    result, _ = await self.__execute(
                ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1892, in __execute
    result, stmt = await self._do_execute(
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1945, in _do_execute
    result = await executor(stmt, None)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\protocol\protocol.pyx", line 186, in bind_execute
  File "asyncpg\protocol\prepared_stmt.pyx", line 204, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
asyncpg.exceptions.DataError: invalid input for query argument $2: 'id' ('str' object cannot be interpreted as an integer)
INFO:root:Checking for expired items at 2024-08-02 01:17:29.664903. Expiration time: 2024-08-02 01:16:29.664903
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x00000249831242C0>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x00000249831242C0>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442092 is handled. Duration 342 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442093 is handled. Duration 266 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442094 is handled. Duration 203 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442095 is handled. Duration 203 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442096 is handled. Duration 609 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442097 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442097 by bot id=7064840472
DataError: invalid input for query argument $2: 'alal' ('str' object cannot be interpreted as an integer)
Traceback (most recent call last):
  File "asyncpg\protocol\prepared_stmt.pyx", line 175, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
  File "asyncpg\protocol\codecs/base.pyx", line 227, in asyncpg.protocol.protocol.Codec.encode
  File "asyncpg\protocol\codecs/base.pyx", line 129, in asyncpg.protocol.protocol.Codec.encode_scalar
  File "asyncpg\pgproto\./codecs/int.pyx", line 54, in asyncpg.pgproto.pgproto.int4_encode
TypeError: 'str' object cannot be interpreted as an integer

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\admin.py", line 70, in accept_transaction_admin
    await accept_transaction(data["user_id"], data["operation_id"])
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\utils\db_api\db_asyncpg.py", line 34, in accept_transaction
    await connection.execute('''
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 353, in execute
    _, status, _ = await self._execute(
                   ^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1794, in _execute
    result, _ = await self.__execute(
                ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1892, in __execute
    result, stmt = await self._do_execute(
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1945, in _do_execute
    result = await executor(stmt, None)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\protocol\protocol.pyx", line 186, in bind_execute
  File "asyncpg\protocol\prepared_stmt.pyx", line 204, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
asyncpg.exceptions.DataError: invalid input for query argument $2: 'alal' ('str' object cannot be interpreted as an integer)
INFO:root:Checking for expired items at 2024-08-02 01:19:17.630440. Expiration time: 2024-08-02 01:18:17.630440
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x00000275255D8900>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x00000275255D8900>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442098 is handled. Duration 625 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442099 is handled. Duration 313 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442100 is handled. Duration 233 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442101 is handled. Duration 110 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442102 is handled. Duration 592 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442103 is not handled. Duration 32 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442103 by bot id=7064840472
UndefinedColumnError:  "asdasd"  
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\admin.py", line 70, in accept_transaction_admin
    await accept_transaction(data["user_id"], data["operation_id"])
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\utils\db_api\db_asyncpg.py", line 34, in accept_transaction
    await connection.execute(f'''
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.UndefinedColumnError:  "asdasd"  
INFO:root:Checking for expired items at 2024-08-02 01:21:19.301041. Expiration time: 2024-08-02 01:20:19.301041
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-02 01:22:19.295126. Expiration time: 2024-08-02 01:21:19.295126
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-02 01:23:19.309935. Expiration time: 2024-08-02 01:22:19.309935
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-02 01:24:19.334823. Expiration time: 2024-08-02 01:23:19.334823
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-02 01:25:19.342835. Expiration time: 2024-08-02 01:24:19.342835
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-02 01:26:19.351824. Expiration time: 2024-08-02 01:25:19.351824
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x00000218D0E3C180>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x00000218D0E3C180>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442104 is handled. Duration 452 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442105 is handled. Duration 311 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442106 is handled. Duration 202 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442107 is handled. Duration 94 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442108 is handled. Duration 297 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442109 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442109 by bot id=7064840472
PostgresSyntaxError:      ( : "750_")
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\admin.py", line 70, in accept_transaction_admin
    await accept_transaction(data["user_id"], data["operation_id"])
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\utils\db_api\db_asyncpg.py", line 34, in accept_transaction
    await connection.execute(f'''
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.PostgresSyntaxError:      ( : "750_")
INFO:root:Checking for expired items at 2024-08-02 01:28:09.931234. Expiration time: 2024-08-02 01:27:09.931234
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-02 01:29:09.936459. Expiration time: 2024-08-02 01:28:09.936459
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-02 01:30:09.934152. Expiration time: 2024-08-02 01:29:09.934152
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x00000206CE7A4A40>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x00000206CE7A4A40>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442110 is not handled. Duration 0 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442111 is handled. Duration 327 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442112 is handled. Duration 2515 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442113 is handled. Duration 391 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442114 is handled. Duration 109 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442115 is handled. Duration 436 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442116 is not handled. Duration 30 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442116 by bot id=7064840472
UndefinedColumnError:  "id400"  
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\admin.py", line 70, in accept_transaction_admin
    await accept_transaction(data["user_id"], data["operation_id"])
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\utils\db_api\db_asyncpg.py", line 34, in accept_transaction
    await connection.execute(f'''
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.UndefinedColumnError:  "id400"  
INFO:root:Checking for expired items at 2024-08-02 01:38:43.993089. Expiration time: 2024-08-02 01:37:43.993089
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x00000161090F82C0>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x00000161090F82C0>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442117 is handled. Duration 422 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442118 is handled. Duration 311 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442119 is handled. Duration 203 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442120 is handled. Duration 203 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442121 is handled. Duration 375 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442122 is not handled. Duration 16 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442122 by bot id=7064840472
UndefinedColumnError:  "id"  
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\admin.py", line 70, in accept_transaction_admin
    await accept_transaction(data["user_id"], data["operation_id"])
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\utils\db_api\db_asyncpg.py", line 41, in accept_transaction
    await connection.execute('''
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 353, in execute
    _, status, _ = await self._execute(
                   ^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1794, in _execute
    result, _ = await self.__execute(
                ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1892, in __execute
    result, stmt = await self._do_execute(
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1925, in _do_execute
    stmt = await self._get_statement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 433, in _get_statement
    statement = await self._protocol.prepare(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\protocol\protocol.pyx", line 166, in prepare
asyncpg.exceptions.UndefinedColumnError:  "id"  
INFO:root:Checking for expired items at 2024-08-02 01:40:08.746189. Expiration time: 2024-08-02 01:39:08.746189
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000024420E4CA40>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000024420E4CA40>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442123 is handled. Duration 358 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442124 is handled. Duration 311 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442125 is handled. Duration 420 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442126 is handled. Duration 203 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442127 is handled. Duration 531 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442128 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442128 by bot id=7064840472
InterfaceError: the server expects 1 argument for this query, 2 were passed
HINT:  Check the query against the passed list of arguments.
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\admin.py", line 70, in accept_transaction_admin
    await accept_transaction(data["user_id"], data["operation_id"])
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\utils\db_api\db_asyncpg.py", line 41, in accept_transaction
    await connection.execute('''
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 353, in execute
    _, status, _ = await self._execute(
                   ^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1794, in _execute
    result, _ = await self.__execute(
                ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1892, in __execute
    result, stmt = await self._do_execute(
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1945, in _do_execute
    result = await executor(stmt, None)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\protocol\protocol.pyx", line 186, in bind_execute
  File "asyncpg\protocol\prepared_stmt.pyx", line 149, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
asyncpg.exceptions._base.InterfaceError: the server expects 1 argument for this query, 2 were passed
HINT:  Check the query against the passed list of arguments.
INFO:root:Checking for expired items at 2024-08-02 01:41:37.326135. Expiration time: 2024-08-02 01:40:37.326135
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x00000180B4E88900>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x00000180B4E88900>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442129 is handled. Duration 266 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442130 is handled. Duration 297 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442131 is handled. Duration 203 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442132 is handled. Duration 93 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442133 is handled. Duration 218 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442134 is not handled. Duration 46 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442134 by bot id=7064840472
UndefinedParameterError:  $1  
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\admin.py", line 70, in accept_transaction_admin
    await accept_transaction(data["user_id"], data["operation_id"])
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\utils\db_api\db_asyncpg.py", line 41, in accept_transaction
    await connection.execute(f'''
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.UndefinedParameterError:  $1  
INFO:root:Checking for expired items at 2024-08-02 01:43:40.992725. Expiration time: 2024-08-02 01:42:40.992725
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000026FD842C400>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000026FD842C400>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442135 is handled. Duration 296 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442136 is handled. Duration 217 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442137 is handled. Duration 204 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442138 is handled. Duration 92 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442139 is handled. Duration 405 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442140 is handled. Duration 204 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-02 01:45:10.613272. Expiration time: 2024-08-02 01:44:10.613272
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000018089138680>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000018089138680>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442141 is handled. Duration 688 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442142 is handled. Duration 406 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442143 is handled. Duration 405 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442144 is handled. Duration 297 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442145 is handled. Duration 108 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442146 is handled. Duration 406 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442147 is handled. Duration 295 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442148 is handled. Duration 125 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-02 12:34:32.939302. Expiration time: 2024-08-02 12:33:32.939302
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-02 12:35:32.989955. Expiration time: 2024-08-02 12:34:32.989955
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x00000233CB474540>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x00000233CB474540>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442149 is not handled. Duration 45 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442149 by bot id=7064840472
AttributeError: 'float' object has no attribute 'quantize'
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\keyboard_menu.py", line 21, in show_balance
    balance = await get_user_balance(message.from_user.id)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\utils\db_api\db_asyncpg.py", line 29, in get_user_balance
    return value.quantize(Decimal('0.01'), rounding=ROUND_DOWN)
           ^^^^^^^^^^^^^^
AttributeError: 'float' object has no attribute 'quantize'
INFO:root:Checking for expired items at 2024-08-02 15:21:20.851791. Expiration time: 2024-08-02 15:20:20.851791
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001E3B4CB82C0>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001E3B4CB82C0>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x00000292CDAA8540>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x00000292CDAA8540>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x00000292CDAA5820>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-14' coro=<Event.wait() running at C:\Python312\Lib\asyncio\locks.py:212> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_wait.<locals>._on_completion() at C:\Python312\Lib\asyncio\tasks.py:534]>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-13' coro=<Dispatcher._polling() running at C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py:345> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_wait.<locals>._on_completion() at C:\Python312\Lib\asyncio\tasks.py:534]>
INFO:aiogram.dispatcher:Polling stopped for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.dispatcher:Polling stopped
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442150 is handled. Duration 358 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442151 is handled. Duration 250 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442152 is handled. Duration 359 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442153 is handled. Duration 218 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-02 15:23:52.328025. Expiration time: 2024-08-02 15:22:52.328025
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-02 15:24:52.337681. Expiration time: 2024-08-02 15:23:52.337681
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-02 15:25:52.340218. Expiration time: 2024-08-02 15:24:52.340218
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-02 15:26:52.351077. Expiration time: 2024-08-02 15:25:52.351077
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442154 is handled. Duration 547 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-02 15:27:52.365613. Expiration time: 2024-08-02 15:26:52.365613
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-02 15:28:52.380210. Expiration time: 2024-08-02 15:27:52.380210
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-02 15:29:52.378572. Expiration time: 2024-08-02 15:28:52.378572
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000002A946988540>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000002A946988540>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442155 is handled. Duration 405 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442156 is not handled. Duration 16 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442156 by bot id=7064840472
TypeError: tovar_info_markup() got an unexpected keyword argument 'amount'
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 133, in tovar_info_menu
    markup = await inline_kb_menu.tovar_info_markup(amount=amount, price=price, count=count)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: tovar_info_markup() got an unexpected keyword argument 'amount'
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x00000295FF590040>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x00000295FF590040>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442157 is handled. Duration 436 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442158 is handled. Duration 156 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442159 is handled. Duration 421 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442160 is handled. Duration 358 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442161 is handled. Duration 172 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-02 15:36:51.066502. Expiration time: 2024-08-02 15:35:51.066502
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442162 is handled. Duration 422 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442163 is handled. Duration 204 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-02 15:37:51.078627. Expiration time: 2024-08-02 15:36:51.078627
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-02 15:38:51.095888. Expiration time: 2024-08-02 15:37:51.095888
INFO:root:Expired items: [<Record product_id=5>, <Record product_id=2>]
INFO:root:Cleared expired items at 2024-08-02 15:38:51.097135
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x00000191062D4680>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x00000191062D4680>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442164 is handled. Duration 484 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442165 is not handled. Duration 16 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442165 by bot id=7064840472
PostgresSyntaxError: INSERT   ,   
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\commands.py", line 19, in start_menu
    await add_user(user_id=message.from_user.id,
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\utils\db_api\db_asyncpg.py", line 136, in add_user
    await connection.execute('INSERT INTO "users" ("user_id", "fio", "isadmin", "dt", "balance") '
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 353, in execute
    _, status, _ = await self._execute(
                   ^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1794, in _execute
    result, _ = await self.__execute(
                ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1892, in __execute
    result, stmt = await self._do_execute(
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1925, in _do_execute
    stmt = await self._get_statement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 433, in _get_statement
    statement = await self._protocol.prepare(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\protocol\protocol.pyx", line 166, in prepare
asyncpg.exceptions.PostgresSyntaxError: INSERT   ,   
INFO:aiogram.event:Update id=778442166 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442166 by bot id=7064840472
PostgresSyntaxError: INSERT   ,   
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\commands.py", line 19, in start_menu
    await add_user(user_id=message.from_user.id,
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\utils\db_api\db_asyncpg.py", line 136, in add_user
    await connection.execute('INSERT INTO "users" ("user_id", "fio", "isadmin", "dt", "balance") '
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 353, in execute
    _, status, _ = await self._execute(
                   ^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1794, in _execute
    result, _ = await self.__execute(
                ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1892, in __execute
    result, stmt = await self._do_execute(
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1925, in _do_execute
    stmt = await self._get_statement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 433, in _get_statement
    statement = await self._protocol.prepare(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\protocol\protocol.pyx", line 166, in prepare
asyncpg.exceptions.PostgresSyntaxError: INSERT   ,   
INFO:root:Checking for expired items at 2024-08-02 15:40:46.847862. Expiration time: 2024-08-02 15:39:46.847862
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-02 15:41:46.855310. Expiration time: 2024-08-02 15:40:46.855310
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-02 15:42:46.874429. Expiration time: 2024-08-02 15:41:46.874429
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-02 15:43:46.876028. Expiration time: 2024-08-02 15:42:46.876028
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-02 15:44:46.867974. Expiration time: 2024-08-02 15:43:46.866981
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-02 15:45:46.857631. Expiration time: 2024-08-02 15:44:46.857631
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-02 15:46:46.866638. Expiration time: 2024-08-02 15:45:46.866638
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-02 15:47:46.873046. Expiration time: 2024-08-02 15:46:46.873046
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-02 15:48:46.883690. Expiration time: 2024-08-02 15:47:46.883690
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-02 15:49:46.912717. Expiration time: 2024-08-02 15:48:46.912717
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001795BA84040>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001795BA84040>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442167 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442167 by bot id=7064840472
PostgresSyntaxError: INSERT   ,   
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\commands.py", line 19, in start_menu
    await add_user(user_id=message.from_user.id,
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\utils\db_api\db_asyncpg.py", line 136, in add_user
    await connection.execute('INSERT INTO "users" ("user_id", "fio", "isadmin", "dt", "balance") '
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 353, in execute
    _, status, _ = await self._execute(
                   ^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1794, in _execute
    result, _ = await self.__execute(
                ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1892, in __execute
    result, stmt = await self._do_execute(
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1925, in _do_execute
    stmt = await self._get_statement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 433, in _get_statement
    statement = await self._protocol.prepare(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\protocol\protocol.pyx", line 166, in prepare
asyncpg.exceptions.PostgresSyntaxError: INSERT   ,   
INFO:aiogram.event:Update id=778442168 is not handled. Duration 16 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442168 by bot id=7064840472
PostgresSyntaxError: INSERT   ,   
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\commands.py", line 19, in start_menu
    await add_user(user_id=message.from_user.id,
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\utils\db_api\db_asyncpg.py", line 136, in add_user
    await connection.execute('INSERT INTO "users" ("user_id", "fio", "isadmin", "dt", "balance") '
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 353, in execute
    _, status, _ = await self._execute(
                   ^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1794, in _execute
    result, _ = await self.__execute(
                ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1892, in __execute
    result, stmt = await self._do_execute(
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1925, in _do_execute
    stmt = await self._get_statement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 433, in _get_statement
    statement = await self._protocol.prepare(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\protocol\protocol.pyx", line 166, in prepare
asyncpg.exceptions.PostgresSyntaxError: INSERT   ,   
INFO:root:Checking for expired items at 2024-08-02 15:51:03.498359. Expiration time: 2024-08-02 15:50:03.498359
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442169 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442169 by bot id=7064840472
PostgresSyntaxError: INSERT   ,   
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\commands.py", line 19, in start_menu
    await add_user(user_id=message.from_user.id,
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\utils\db_api\db_asyncpg.py", line 136, in add_user
    await connection.execute('INSERT INTO "users" ("user_id", "fio", "isadmin", "dt", "balance") '
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 353, in execute
    _, status, _ = await self._execute(
                   ^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1794, in _execute
    result, _ = await self.__execute(
                ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1892, in __execute
    result, stmt = await self._do_execute(
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1925, in _do_execute
    stmt = await self._get_statement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 433, in _get_statement
    statement = await self._protocol.prepare(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\protocol\protocol.pyx", line 166, in prepare
asyncpg.exceptions.PostgresSyntaxError: INSERT   ,   
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001F09E034040>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001F09E034040>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000002B22FE94040>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000002B22FE94040>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000002B234B4F770>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-14' coro=<Event.wait() running at C:\Python312\Lib\asyncio\locks.py:212> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_wait.<locals>._on_completion() at C:\Python312\Lib\asyncio\tasks.py:534]>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-13' coro=<Dispatcher._polling() running at C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py:345> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_wait.<locals>._on_completion() at C:\Python312\Lib\asyncio\tasks.py:534]>
INFO:aiogram.dispatcher:Polling stopped for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.dispatcher:Polling stopped
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442170 is handled. Duration 547 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442171 is handled. Duration 140 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442172 is not handled. Duration 296 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442172 by bot id=7064840472
DataError: invalid input for query argument $5: [PhotoSize(file_id='AgACAgIAAxkBAAIDRWau... (a bytes-like object is required, not 'list')
Traceback (most recent call last):
  File "asyncpg\protocol\prepared_stmt.pyx", line 175, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
  File "asyncpg\protocol\codecs/base.pyx", line 227, in asyncpg.protocol.protocol.Codec.encode
  File "asyncpg\protocol\codecs/base.pyx", line 129, in asyncpg.protocol.protocol.Codec.encode_scalar
  File "asyncpg\pgproto\./codecs/bytea.pyx", line 19, in asyncpg.pgproto.pgproto.bytea_encode
TypeError: a bytes-like object is required, not 'list'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 226, in transaction_amount
    await add_transaction(message.from_user.id, data['amount'], data['operation_id'])
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\utils\db_api\db_asyncpg.py", line 60, in add_transaction
    await connection.execute(query, user_id, amount, "OnCheck", date, operation_id)
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 353, in execute
    _, status, _ = await self._execute(
                   ^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1794, in _execute
    result, _ = await self.__execute(
                ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1892, in __execute
    result, stmt = await self._do_execute(
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1945, in _do_execute
    result = await executor(stmt, None)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\protocol\protocol.pyx", line 186, in bind_execute
  File "asyncpg\protocol\prepared_stmt.pyx", line 204, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
asyncpg.exceptions.DataError: invalid input for query argument $5: [PhotoSize(file_id='AgACAgIAAxkBAAIDRWau... (a bytes-like object is required, not 'list')
INFO:root:Checking for expired items at 2024-08-03 17:23:56.358136. Expiration time: 2024-08-03 17:22:56.358136
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x00000139C335CA40>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x00000139C335CA40>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442173 is handled. Duration 296 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442174 is handled. Duration 422 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442175 is handled. Duration 172 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442176 is handled. Duration 172 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442177 is not handled. Duration 125 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442177 by bot id=7064840472
DataError: invalid input for query argument $5: [PhotoSize(file_id='AgACAgIAAxkBAAIDS2au... (a bytes-like object is required, not 'list')
Traceback (most recent call last):
  File "asyncpg\protocol\prepared_stmt.pyx", line 175, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
  File "asyncpg\protocol\codecs/base.pyx", line 227, in asyncpg.protocol.protocol.Codec.encode
  File "asyncpg\protocol\codecs/base.pyx", line 129, in asyncpg.protocol.protocol.Codec.encode_scalar
  File "asyncpg\pgproto\./codecs/bytea.pyx", line 19, in asyncpg.pgproto.pgproto.bytea_encode
TypeError: a bytes-like object is required, not 'list'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 227, in transaction_amount
    await add_transaction(message.from_user.id, data['amount'], data['operation_id'])
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\utils\db_api\db_asyncpg.py", line 60, in add_transaction
    await connection.execute(query, user_id, amount, "OnCheck", date, operation_id)
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 353, in execute
    _, status, _ = await self._execute(
                   ^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1794, in _execute
    result, _ = await self.__execute(
                ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1892, in __execute
    result, stmt = await self._do_execute(
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1945, in _do_execute
    result = await executor(stmt, None)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\protocol\protocol.pyx", line 186, in bind_execute
  File "asyncpg\protocol\prepared_stmt.pyx", line 204, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
asyncpg.exceptions.DataError: invalid input for query argument $5: [PhotoSize(file_id='AgACAgIAAxkBAAIDS2au... (a bytes-like object is required, not 'list')
INFO:root:Checking for expired items at 2024-08-03 17:25:44.589935. Expiration time: 2024-08-03 17:24:44.589935
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-03 17:26:44.601904. Expiration time: 2024-08-03 17:25:44.601904
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-03 17:27:44.607449. Expiration time: 2024-08-03 17:26:44.607449
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-03 17:28:44.617917. Expiration time: 2024-08-03 17:27:44.617917
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-03 17:29:44.634892. Expiration time: 2024-08-03 17:28:44.634892
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-03 17:30:44.649131. Expiration time: 2024-08-03 17:29:44.649131
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000020640128540>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000020640128540>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442178 is handled. Duration 500 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442179 is handled. Duration 188 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442180 is handled. Duration 186 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442181 is handled. Duration 94 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442182 is not handled. Duration 765 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442182 by bot id=7064840472
UndefinedColumnError:  "screenshot"   "transactions"  
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 227, in transaction_amount
    await add_transaction(message.from_user.id, data['amount'], data['operation_id'])
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\utils\db_api\db_asyncpg.py", line 60, in add_transaction
    await connection.execute(query, user_id, amount, "OnCheck", date, operation_id)
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 353, in execute
    _, status, _ = await self._execute(
                   ^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1794, in _execute
    result, _ = await self.__execute(
                ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1892, in __execute
    result, stmt = await self._do_execute(
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1925, in _do_execute
    stmt = await self._get_statement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 433, in _get_statement
    statement = await self._protocol.prepare(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\protocol\protocol.pyx", line 166, in prepare
asyncpg.exceptions.UndefinedColumnError:  "screenshot"   "transactions"  
INFO:root:Checking for expired items at 2024-08-03 18:04:55.397384. Expiration time: 2024-08-03 18:03:55.397384
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000023CDE618040>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000023CDE618040>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442183 is handled. Duration 952 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442184 is handled. Duration 515 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442185 is handled. Duration 577 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442186 is handled. Duration 218 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442187 is handled. Duration 342 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442188 is not handled. Duration 32 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-03 18:06:11.849518. Expiration time: 2024-08-03 18:05:11.849518
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000002283F368040>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000002283F368040>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001ECE40C8A40>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001ECE40C8A40>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001ECE40C3D10>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-14' coro=<Event.wait() running at C:\Python312\Lib\asyncio\locks.py:212> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_wait.<locals>._on_completion() at C:\Python312\Lib\asyncio\tasks.py:534]>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-13' coro=<Dispatcher._polling() running at C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py:345> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_wait.<locals>._on_completion() at C:\Python312\Lib\asyncio\tasks.py:534]>
INFO:aiogram.dispatcher:Polling stopped for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.dispatcher:Polling stopped
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442189 is handled. Duration 327 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442190 is handled. Duration 280 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442191 is handled. Duration 282 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442192 is handled. Duration 125 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442193 is handled. Duration 218 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442194 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442194 by bot id=7064840472
TypeError: list indices must be integers or slices, not str
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\admin.py", line 71, in show_next_transaction
    f": @{transaction['username']}\n"
                      ~~~~~~~~~~~^^^^^^^^^^^^
TypeError: list indices must be integers or slices, not str
INFO:root:Checking for expired items at 2024-08-03 18:08:58.072700. Expiration time: 2024-08-03 18:07:58.072700
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001D4F9958A40>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001D4F9958A40>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442195 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442195 by bot id=7064840472
TypeError: Bot.get_chat_member() missing 1 required positional argument: 'user_id'
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\admin.py", line 69, in show_next_transaction
    user = await bot.get_chat_member(transaction[0])
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Bot.get_chat_member() missing 1 required positional argument: 'user_id'
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x00000277CBF64040>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x00000277CBF64040>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442196 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442196 by bot id=7064840472
TypeError: Bot.get_chat_member() missing 1 required positional argument: 'chat_id'
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\admin.py", line 69, in show_next_transaction
    user = await bot.get_chat_member(user_id=transaction[0])
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Bot.get_chat_member() missing 1 required positional argument: 'chat_id'
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x00000209E8BB4040>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x00000209E8BB4040>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442197 is not handled. Duration 16 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442197 by bot id=7064840472
ValidationError: 3 validation errors for GetChatMember
chat_id.int
  Input should be a valid integer [type=int_type, input_value=<Record user_id=105418471...9278) file_id='some_id'>, input_type=Record]
    For further information visit https://errors.pydantic.dev/2.8/v/int_type
chat_id.str
  Input should be a valid string [type=string_type, input_value=<Record user_id=105418471...9278) file_id='some_id'>, input_type=Record]
    For further information visit https://errors.pydantic.dev/2.8/v/string_type
user_id
  Input should be a valid integer [type=int_type, input_value=<Record user_id=105418471...9278) file_id='some_id'>, input_type=Record]
    For further information visit https://errors.pydantic.dev/2.8/v/int_type
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\admin.py", line 69, in show_next_transaction
    user = await bot.get_chat_member(user_id=transaction[0], chat_id=transaction[0])
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\client\bot.py", line 1696, in get_chat_member
    call = GetChatMember(
           ^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\pydantic\main.py", line 193, in __init__
    self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 3 validation errors for GetChatMember
chat_id.int
  Input should be a valid integer [type=int_type, input_value=<Record user_id=105418471...9278) file_id='some_id'>, input_type=Record]
    For further information visit https://errors.pydantic.dev/2.8/v/int_type
chat_id.str
  Input should be a valid string [type=string_type, input_value=<Record user_id=105418471...9278) file_id='some_id'>, input_type=Record]
    For further information visit https://errors.pydantic.dev/2.8/v/string_type
user_id
  Input should be a valid integer [type=int_type, input_value=<Record user_id=105418471...9278) file_id='some_id'>, input_type=Record]
    For further information visit https://errors.pydantic.dev/2.8/v/int_type
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000002642F8A8040>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000002642F8A8040>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442198 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442198 by bot id=7064840472
ValidationError: 3 validation errors for GetChatMember
chat_id.int
  Input should be a valid integer [type=int_type, input_value=<Record user_id=105418471...9278) file_id='some_id'>, input_type=Record]
    For further information visit https://errors.pydantic.dev/2.8/v/int_type
chat_id.str
  Input should be a valid string [type=string_type, input_value=<Record user_id=105418471...9278) file_id='some_id'>, input_type=Record]
    For further information visit https://errors.pydantic.dev/2.8/v/string_type
user_id
  Input should be a valid integer [type=int_type, input_value=<Record user_id=105418471...9278) file_id='some_id'>, input_type=Record]
    For further information visit https://errors.pydantic.dev/2.8/v/int_type
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\admin.py", line 70, in show_next_transaction
    user = await bot.get_chat_member(user_id=transaction[0], chat_id=transaction[0])
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\client\bot.py", line 1696, in get_chat_member
    call = GetChatMember(
           ^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\pydantic\main.py", line 193, in __init__
    self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 3 validation errors for GetChatMember
chat_id.int
  Input should be a valid integer [type=int_type, input_value=<Record user_id=105418471...9278) file_id='some_id'>, input_type=Record]
    For further information visit https://errors.pydantic.dev/2.8/v/int_type
chat_id.str
  Input should be a valid string [type=string_type, input_value=<Record user_id=105418471...9278) file_id='some_id'>, input_type=Record]
    For further information visit https://errors.pydantic.dev/2.8/v/string_type
user_id
  Input should be a valid integer [type=int_type, input_value=<Record user_id=105418471...9278) file_id='some_id'>, input_type=Record]
    For further information visit https://errors.pydantic.dev/2.8/v/int_type
INFO:root:Checking for expired items at 2024-08-03 18:19:25.802127. Expiration time: 2024-08-03 18:18:25.802127
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000002552D7B4040>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000002552D7B4040>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442199 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442199 by bot id=7064840472
TypeError: 'coroutine' object is not subscriptable
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\admin.py", line 68, in show_next_transaction
    transaction = await get_next_pending_transaction()[0]
                        ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^
TypeError: 'coroutine' object is not subscriptable
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000015644B54040>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000015644B54040>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442200 is not handled. Duration 233 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442200 by bot id=7064840472
ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.8/v/missing
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\admin.py", line 79, in show_next_transaction
    markup = types.InlineKeyboardMarkup()
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\pydantic\main.py", line 193, in __init__
    self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.8/v/missing
INFO:root:Checking for expired items at 2024-08-03 18:22:05.463761. Expiration time: 2024-08-03 18:21:05.463761
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000022909948040>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000022909948040>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442201 is not handled. Duration 234 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442201 by bot id=7064840472
TypeError: BaseModel.__init__() takes 1 positional argument but 2 were given
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\admin.py", line 80, in show_next_transaction
    [types.InlineKeyboardButton(" ", callback_data='show_next')],
     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: BaseModel.__init__() takes 1 positional argument but 2 were given
INFO:root:Checking for expired items at 2024-08-03 18:23:59.178646. Expiration time: 2024-08-03 18:22:59.178646
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001940B668040>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001940B668040>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442202 is handled. Duration 437 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-03 18:25:40.413255. Expiration time: 2024-08-03 18:24:40.412030
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000002031EED8040>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000002031EED8040>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442203 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442203 by bot id=7064840472
AttributeError: 'CallbackQuery' object has no attribute 'text'
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\admin.py", line 97, in accept_transaction_admin
    await state.update_data({ "accept": message.text })
                                        ^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\pydantic\main.py", line 828, in __getattr__
    raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
AttributeError: 'CallbackQuery' object has no attribute 'text'
INFO:root:Checking for expired items at 2024-08-03 18:27:11.062789. Expiration time: 2024-08-03 18:26:11.062789
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x00000260FFF44040>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x00000260FFF44040>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442204 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442204 by bot id=7064840472
KeyError: 'user_id'
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\admin.py", line 99, in accept_transaction_admin
    await accept_transaction(data["user_id"], data["operation_id"])
                             ~~~~^^^^^^^^^^^
KeyError: 'user_id'
INFO:root:Checking for expired items at 2024-08-03 18:28:19.091294. Expiration time: 2024-08-03 18:27:19.091294
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-03 18:29:19.109598. Expiration time: 2024-08-03 18:28:19.109598
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x00000126C0024040>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x00000126C0024040>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442205 is not handled. Duration 0 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-03 18:30:53.718293. Expiration time: 2024-08-03 18:29:53.718293
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-03 18:31:53.722761. Expiration time: 2024-08-03 18:30:53.722761
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-03 18:32:53.732843. Expiration time: 2024-08-03 18:31:53.732843
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000022DA2354040>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000022DA2354040>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442206 is not handled. Duration 0 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-03 18:34:01.880462. Expiration time: 2024-08-03 18:33:01.880462
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001ED3F4E8040>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001ED3F4E8040>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442207 is not handled. Duration 30 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442208 is handled. Duration 375 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442209 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442209 by bot id=7064840472
KeyError: 'user_id'
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\admin.py", line 102, in accept_transaction_admin
    await accept_transaction(data["user_id"], data["operation_id"])
                             ~~~~^^^^^^^^^^^
KeyError: 'user_id'
INFO:root:Checking for expired items at 2024-08-03 18:35:36.611347. Expiration time: 2024-08-03 18:34:36.611347
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-03 18:36:36.626959. Expiration time: 2024-08-03 18:35:36.626959
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-03 18:37:36.623404. Expiration time: 2024-08-03 18:36:36.623404
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x00000205A5604040>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x00000205A5604040>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442210 is not handled. Duration 0 ms by bot id=7064840472
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000020E9BEA8040>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000020E9BEA8040>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442211 is handled. Duration 405 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442212 is handled. Duration 188 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442213 is handled. Duration 359 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442214 is handled. Duration 172 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442215 is handled. Duration 452 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-03 18:40:23.843985. Expiration time: 2024-08-03 18:39:23.843985
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000023325E04040>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000023325E04040>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442216 is not handled. Duration 15 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442217 is handled. Duration 484 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442218 is handled. Duration 312 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442219 is handled. Duration 342 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442220 is handled. Duration 515 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-03 18:43:55.507654. Expiration time: 2024-08-03 18:42:55.507654
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-03 18:44:55.530971. Expiration time: 2024-08-03 18:43:55.530971
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-03 18:45:55.546753. Expiration time: 2024-08-03 18:44:55.546753
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000002351C554040>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000002351C554040>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442221 is handled. Duration 437 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442222 is not handled. Duration 0 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-03 23:44:48.020267. Expiration time: 2024-08-03 23:43:48.020267
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-03 23:45:48.039303. Expiration time: 2024-08-03 23:44:48.039303
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-03 23:46:48.045709. Expiration time: 2024-08-03 23:45:48.045709
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000002281D618040>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000002281D618040>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442223 is handled. Duration 375 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442224 is handled. Duration 188 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442225 is handled. Duration 297 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442226 is handled. Duration 125 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442227 is handled. Duration 297 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442228 is handled. Duration 391 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442229 is handled. Duration 469 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-03 23:48:43.340226. Expiration time: 2024-08-03 23:47:43.340226
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001D003F34040>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001D003F34040>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442230 is handled. Duration 500 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442231 is handled. Duration 452 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-03 23:49:56.989474. Expiration time: 2024-08-03 23:48:56.989474
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-03 23:50:57.021600. Expiration time: 2024-08-03 23:49:57.021600
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-03 23:51:57.032869. Expiration time: 2024-08-03 23:50:57.032869
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001B282D68040>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001B282D68040>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442232 is handled. Duration 640 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442233 is handled. Duration 812 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442234 is handled. Duration 859 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-03 23:53:35.799175. Expiration time: 2024-08-03 23:52:35.799175
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442235 is handled. Duration 1452 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-03 23:54:35.799739. Expiration time: 2024-08-03 23:53:35.799739
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442236 is handled. Duration 905 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-03 23:55:35.814099. Expiration time: 2024-08-03 23:54:35.814099
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-03 23:56:35.818658. Expiration time: 2024-08-03 23:55:35.818658
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-03 23:57:35.834010. Expiration time: 2024-08-03 23:56:35.834010
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-03 23:58:35.840338. Expiration time: 2024-08-03 23:57:35.840338
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-03 23:59:35.859786. Expiration time: 2024-08-03 23:58:35.859786
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 00:00:35.869580. Expiration time: 2024-08-03 23:59:35.869580
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 00:01:35.886673. Expiration time: 2024-08-04 00:00:35.886673
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 00:02:35.916354. Expiration time: 2024-08-04 00:01:35.916354
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 00:03:35.932960. Expiration time: 2024-08-04 00:02:35.932960
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000020256004040>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000020256004040>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442237 is not handled. Duration 15 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442238 is handled. Duration 625 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442239 is handled. Duration 390 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442240 is handled. Duration 3640 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-04 00:05:16.984608. Expiration time: 2024-08-04 00:04:16.984608
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442241 is handled. Duration 4265 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442242 is handled. Duration 3594 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442243 is handled. Duration 3577 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-04 00:06:16.994800. Expiration time: 2024-08-04 00:05:16.994800
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 00:07:17.008875. Expiration time: 2024-08-04 00:06:17.008875
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 00:08:17.021962. Expiration time: 2024-08-04 00:07:17.021962
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 00:09:17.027771. Expiration time: 2024-08-04 00:08:17.027771
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 00:10:17.039269. Expiration time: 2024-08-04 00:09:17.039269
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 00:11:17.036183. Expiration time: 2024-08-04 00:10:17.036183
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 00:12:17.042475. Expiration time: 2024-08-04 00:11:17.042475
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 00:13:17.045133. Expiration time: 2024-08-04 00:12:17.045133
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 00:14:17.054172. Expiration time: 2024-08-04 00:13:17.054172
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 00:15:17.067992. Expiration time: 2024-08-04 00:14:17.067992
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 00:16:17.079534. Expiration time: 2024-08-04 00:15:17.079534
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 00:17:17.091313. Expiration time: 2024-08-04 00:16:17.091313
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 00:18:17.101136. Expiration time: 2024-08-04 00:17:17.101136
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442244 is handled. Duration 250 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442245 is handled. Duration 327 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442246 is handled. Duration 109 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442247 is handled. Duration 172 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-04 00:19:17.102499. Expiration time: 2024-08-04 00:18:17.102499
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 00:20:17.105747. Expiration time: 2024-08-04 00:19:17.105747
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442248 is handled. Duration 3702 ms by bot id=7064840472
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x00000266D2744040>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x00000266D2744040>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442251 is not handled. Duration 16 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442251 by bot id=7064840472
UnboundLocalError: cannot access local variable 'product_ids' where it is not associated with a value
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\keyboard_menu.py", line 17, in show_basket
    await send_basket(chat_id=message.chat.id, user_id=message.chat.id)
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 81, in send_basket
    markup = await inline_kb_menu.basket_markup(basket=basket)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\keyboards\inline\inline_kb_menu.py", line 64, in basket_markup
    btns.append([InlineKeyboardButton(text=' ', callback_data=f'confirm_order{"_".join(map(str, product_ids))}')])
                                                                                                             ^^^^^^^^^^^
UnboundLocalError: cannot access local variable 'product_ids' where it is not associated with a value
INFO:aiogram.event:Update id=778442250 is handled. Duration 329 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442249 is handled. Duration 344 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442252 is handled. Duration 125 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-04 00:28:03.086412. Expiration time: 2024-08-04 00:27:03.086412
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 00:29:03.095550. Expiration time: 2024-08-04 00:28:03.095550
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 00:30:03.098517. Expiration time: 2024-08-04 00:29:03.098517
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 00:31:03.100104. Expiration time: 2024-08-04 00:30:03.100104
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 00:32:03.097587. Expiration time: 2024-08-04 00:31:03.097587
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 00:33:03.094616. Expiration time: 2024-08-04 00:32:03.094616
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 00:34:03.106362. Expiration time: 2024-08-04 00:33:03.106362
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 00:35:03.113879. Expiration time: 2024-08-04 00:34:03.113879
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 00:36:03.114406. Expiration time: 2024-08-04 00:35:03.114406
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 00:37:03.122182. Expiration time: 2024-08-04 00:36:03.122182
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 00:38:03.136788. Expiration time: 2024-08-04 00:37:03.136788
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 00:39:03.152147. Expiration time: 2024-08-04 00:38:03.152147
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000025A32CF8040>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000025A32CF8040>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442253 is handled. Duration 265 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442254 is handled. Duration 500 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442255 is handled. Duration 188 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442256 is handled. Duration 109 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442257 is handled. Duration 280 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442258 is handled. Duration 890 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442259 is not handled. Duration 0 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-04 21:46:15.932345. Expiration time: 2024-08-04 21:45:15.932345
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 21:47:15.948848. Expiration time: 2024-08-04 21:46:15.948848
INFO:root:Expired items: [<Record product_id=1>]
INFO:root:Cleared expired items at 2024-08-04 21:47:15.953583
INFO:root:Checking for expired items at 2024-08-04 21:48:15.962797. Expiration time: 2024-08-04 21:47:15.962063
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 21:49:15.973977. Expiration time: 2024-08-04 21:48:15.973977
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 21:50:15.965006. Expiration time: 2024-08-04 21:49:15.965006
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 21:51:15.972069. Expiration time: 2024-08-04 21:50:15.972069
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 21:52:15.968302. Expiration time: 2024-08-04 21:51:15.968302
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000017D0F9EB100>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000017D0F9EB100>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442260 is not handled. Duration 0 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442261 is handled. Duration 359 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442262 is handled. Duration 344 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442263 is handled. Duration 172 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442264 is handled. Duration 125 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442265 is handled. Duration 280 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442266 is handled. Duration 172 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-04 21:55:41.524204. Expiration time: 2024-08-04 21:25:41.524204
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 21:56:41.529741. Expiration time: 2024-08-04 21:26:41.529741
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 21:57:41.545808. Expiration time: 2024-08-04 21:27:41.545808
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 21:58:41.553123. Expiration time: 2024-08-04 21:28:41.553123
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 21:59:41.557398. Expiration time: 2024-08-04 21:29:41.557398
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 22:00:41.573941. Expiration time: 2024-08-04 21:30:41.573941
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 22:01:41.587856. Expiration time: 2024-08-04 21:31:41.587856
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 22:02:41.603694. Expiration time: 2024-08-04 21:32:41.603694
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 22:03:41.619015. Expiration time: 2024-08-04 21:33:41.619015
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 22:04:41.644975. Expiration time: 2024-08-04 21:34:41.644975
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 22:05:41.639428. Expiration time: 2024-08-04 21:35:41.639428
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 22:06:41.664888. Expiration time: 2024-08-04 21:36:41.664888
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 22:07:41.666164. Expiration time: 2024-08-04 21:37:41.666164
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 22:08:41.673654. Expiration time: 2024-08-04 21:38:41.673654
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x00000225744C2E80>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x00000225744C2E80>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:root:Checking for expired items at 2024-08-04 22:10:10.222226. Expiration time: 2024-08-04 21:40:10.222226
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442267 is not handled. Duration 15 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442267 by bot id=7064840472
UndefinedTableError:  "cart"  
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 256, in handle_confirm_order
    cart_items = await get_cart_items(user_id)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\utils\db_api\db_asyncpg.py", line 17, in get_cart_items
    result = await connection.fetch('''
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 691, in fetch
    return await self._execute(
           ^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1794, in _execute
    result, _ = await self.__execute(
                ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1892, in __execute
    result, stmt = await self._do_execute(
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1925, in _do_execute
    stmt = await self._get_statement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 433, in _get_statement
    statement = await self._protocol.prepare(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\protocol\protocol.pyx", line 166, in prepare
asyncpg.exceptions.UndefinedTableError:  "cart"  
INFO:root:Checking for expired items at 2024-08-04 22:11:10.237849. Expiration time: 2024-08-04 21:41:10.237849
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000025FC061B600>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000025FC061B600>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442268 is not handled. Duration 16 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442268 by bot id=7064840472
TypeError: unsupported operand type(s) for -: 'decimal.Decimal' and 'float'
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 271, in handle_confirm_order
    await update_user_balance(user_id, user_balance - total_price)
                                       ~~~~~~~~~~~~~^~~~~~~~~~~~~
TypeError: unsupported operand type(s) for -: 'decimal.Decimal' and 'float'
INFO:root:Checking for expired items at 2024-08-04 22:12:27.422531. Expiration time: 2024-08-04 21:42:27.422531
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x00000271E3F5F4C0>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x00000271E3F5F4C0>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442269 is not handled. Duration 30 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442269 by bot id=7064840472
UndefinedColumnError:  "id"  
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 271, in handle_confirm_order
    await update_user_balance(user_id, float(user_balance) - total_price)
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\utils\db_api\db_asyncpg.py", line 13, in update_user_balance
    await connection.execute('UPDATE users SET balance = $1 WHERE id = $2', new_balance, user_id)
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 353, in execute
    _, status, _ = await self._execute(
                   ^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1794, in _execute
    result, _ = await self.__execute(
                ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1892, in __execute
    result, stmt = await self._do_execute(
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1925, in _do_execute
    stmt = await self._get_statement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 433, in _get_statement
    statement = await self._protocol.prepare(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\protocol\protocol.pyx", line 166, in prepare
asyncpg.exceptions.UndefinedColumnError:  "id"  
INFO:root:Checking for expired items at 2024-08-04 22:13:52.264376. Expiration time: 2024-08-04 21:43:52.264376
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001D2B0DE6E80>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001D2B0DE6E80>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442270 is not handled. Duration 16 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442270 by bot id=7064840472
UndefinedTableError:  "promo_codes"  
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 274, in handle_confirm_order
    promo_codes = await get_promo_codes(cart_items)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\utils\db_api\db_asyncpg.py", line 33, in get_promo_codes
    codes = await connection.fetch('''
            ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 691, in fetch
    return await self._execute(
           ^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1794, in _execute
    result, _ = await self.__execute(
                ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1892, in __execute
    result, stmt = await self._do_execute(
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1925, in _do_execute
    stmt = await self._get_statement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 433, in _get_statement
    statement = await self._protocol.prepare(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\protocol\protocol.pyx", line 166, in prepare
asyncpg.exceptions.UndefinedTableError:  "promo_codes"  
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000022BAFE8F100>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000022BAFE8F100>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442271 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442271 by bot id=7064840472
UndefinedTableError:  "tovar"  
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 274, in handle_confirm_order
    promo_codes = await get_promo_codes(cart_items)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\utils\db_api\db_asyncpg.py", line 33, in get_promo_codes
    codes = await connection.fetch('''
            ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 691, in fetch
    return await self._execute(
           ^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1794, in _execute
    result, _ = await self.__execute(
                ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1892, in __execute
    result, stmt = await self._do_execute(
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1925, in _do_execute
    stmt = await self._get_statement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 433, in _get_statement
    statement = await self._protocol.prepare(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\protocol\protocol.pyx", line 166, in prepare
asyncpg.exceptions.UndefinedTableError:  "tovar"  
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000018FFE09B880>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000018FFE09B880>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442272 is not handled. Duration 15 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442272 by bot id=7064840472
UndefinedColumnError:  "product_id"  
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 274, in handle_confirm_order
    promo_codes = await get_promo_codes(cart_items)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\utils\db_api\db_asyncpg.py", line 33, in get_promo_codes
    codes = await connection.fetch('''
            ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 691, in fetch
    return await self._execute(
           ^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1794, in _execute
    result, _ = await self.__execute(
                ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1892, in __execute
    result, stmt = await self._do_execute(
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1925, in _do_execute
    stmt = await self._get_statement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 433, in _get_statement
    statement = await self._protocol.prepare(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\protocol\protocol.pyx", line 166, in prepare
asyncpg.exceptions.UndefinedColumnError:  "product_id"  
INFO:root:Checking for expired items at 2024-08-04 22:16:23.743742. Expiration time: 2024-08-04 21:46:23.743742
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000024545F6B100>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000024545F6B100>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442273 is not handled. Duration 15 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442273 by bot id=7064840472
KeyError: 'code'
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 274, in handle_confirm_order
    promo_codes = await get_promo_codes(cart_items)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\utils\db_api\db_asyncpg.py", line 38, in get_promo_codes
    'codes': [row['code'] for row in codes]
              ~~~^^^^^^^^
KeyError: 'code'
INFO:root:Checking for expired items at 2024-08-04 22:18:10.298305. Expiration time: 2024-08-04 21:48:10.298305
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x00000194F839F380>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x00000194F839F380>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442274 is not handled. Duration 15 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442274 by bot id=7064840472
KeyError: 'code'
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 274, in handle_confirm_order
    promo_codes = await get_promo_codes(cart_items)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\utils\db_api\db_asyncpg.py", line 38, in get_promo_codes
    'codes': [row['code'] for row in codes]
              ~~~^^^^^^^^
KeyError: 'code'
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000002C53805B380>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000002C53805B380>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442275 is not handled. Duration 390 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442275 by bot id=7064840472
UndefinedTableError:  "cart"  
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 294, in handle_confirm_order
    await clear_cart(user_id)
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\utils\db_api\db_asyncpg.py", line 27, in clear_cart
    await connection.execute('DELETE FROM cart WHERE user_id = $1', user_id)
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 353, in execute
    _, status, _ = await self._execute(
                   ^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1794, in _execute
    result, _ = await self.__execute(
                ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1892, in __execute
    result, stmt = await self._do_execute(
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1925, in _do_execute
    stmt = await self._get_statement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 433, in _get_statement
    statement = await self._protocol.prepare(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\protocol\protocol.pyx", line 166, in prepare
asyncpg.exceptions.UndefinedTableError:  "cart"  
INFO:aiogram.event:Update id=778442276 is handled. Duration 250 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-04 22:19:48.287038. Expiration time: 2024-08-04 21:49:48.287038
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 22:20:48.284413. Expiration time: 2024-08-04 21:50:48.284413
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000002529462F4C0>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000002529462F4C0>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442277 is not handled. Duration 15 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442277 by bot id=7064840472
TypeError: try_delete_msg() missing 1 required positional argument: 'msgId'
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 89, in categories_menu
    try_delete_msg(call.message)
TypeError: try_delete_msg() missing 1 required positional argument: 'msgId'
INFO:root:Checking for expired items at 2024-08-04 22:22:05.387018. Expiration time: 2024-08-04 21:52:05.387018
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 22:23:05.402626. Expiration time: 2024-08-04 21:53:05.402626
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 22:24:05.415706. Expiration time: 2024-08-04 21:54:05.415706
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001B39C707380>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001B39C707380>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442278 is handled. Duration 297 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442279 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442279 by bot id=7064840472
ValidationError: 4 validation errors for SendMessage
reply_markup.InlineKeyboardMarkup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=<coroutine object tovar_l...p at 0x000002A6D26A15A0>, input_type=coroutine]
    For further information visit https://errors.pydantic.dev/2.8/v/model_type
reply_markup.ReplyKeyboardMarkup
  Input should be a valid dictionary or instance of ReplyKeyboardMarkup [type=model_type, input_value=<coroutine object tovar_l...p at 0x000002A6D26A15A0>, input_type=coroutine]
    For further information visit https://errors.pydantic.dev/2.8/v/model_type
reply_markup.ReplyKeyboardRemove
  Input should be a valid dictionary or instance of ReplyKeyboardRemove [type=model_type, input_value=<coroutine object tovar_l...p at 0x000002A6D26A15A0>, input_type=coroutine]
    For further information visit https://errors.pydantic.dev/2.8/v/model_type
reply_markup.ForceReply
  Input should be a valid dictionary or instance of ForceReply [type=model_type, input_value=<coroutine object tovar_l...p at 0x000002A6D26A15A0>, input_type=coroutine]
    For further information visit https://errors.pydantic.dev/2.8/v/model_type
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\admin.py", line 73, in adminPacks
    await call.message.answer(text='   : ', reply_markup=inline_kb_menu.tovar_list_markup())
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\types\message.py", line 2044, in answer
    return SendMessage(
           ^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\pydantic\main.py", line 193, in __init__
    self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 4 validation errors for SendMessage
reply_markup.InlineKeyboardMarkup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=<coroutine object tovar_l...p at 0x000002A6D26A15A0>, input_type=coroutine]
    For further information visit https://errors.pydantic.dev/2.8/v/model_type
reply_markup.ReplyKeyboardMarkup
  Input should be a valid dictionary or instance of ReplyKeyboardMarkup [type=model_type, input_value=<coroutine object tovar_l...p at 0x000002A6D26A15A0>, input_type=coroutine]
    For further information visit https://errors.pydantic.dev/2.8/v/model_type
reply_markup.ReplyKeyboardRemove
  Input should be a valid dictionary or instance of ReplyKeyboardRemove [type=model_type, input_value=<coroutine object tovar_l...p at 0x000002A6D26A15A0>, input_type=coroutine]
    For further information visit https://errors.pydantic.dev/2.8/v/model_type
reply_markup.ForceReply
  Input should be a valid dictionary or instance of ForceReply [type=model_type, input_value=<coroutine object tovar_l...p at 0x000002A6D26A15A0>, input_type=coroutine]
    For further information visit https://errors.pydantic.dev/2.8/v/model_type
INFO:root:Checking for expired items at 2024-08-04 22:32:59.631008. Expiration time: 2024-08-04 22:02:59.631008
INFO:root:Expired items: [<Record product_id=4>, <Record product_id=5>]
INFO:root:Cleared expired items at 2024-08-04 22:32:59.642551
INFO:root:Checking for expired items at 2024-08-04 22:33:59.649654. Expiration time: 2024-08-04 22:03:59.649654
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000002A6D2267600>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000002A6D2267600>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442280 is handled. Duration 484 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-04 22:35:14.530435. Expiration time: 2024-08-04 22:05:14.530435
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 22:36:14.542847. Expiration time: 2024-08-04 22:06:14.542847
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 22:37:14.571050. Expiration time: 2024-08-04 22:07:14.571050
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 22:38:14.575027. Expiration time: 2024-08-04 22:08:14.575027
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 22:39:14.599513. Expiration time: 2024-08-04 22:09:14.599513
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 22:40:14.603221. Expiration time: 2024-08-04 22:10:14.603221
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442281 is handled. Duration 422 ms by bot id=7064840472
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000002504B4EAE80>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000002504B4EAE80>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:root:Checking for expired items at 2024-08-04 22:41:47.612537. Expiration time: 2024-08-04 22:11:47.612537
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000002069654B100>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000002069654B100>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000020696388140>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-14' coro=<Event.wait() running at C:\Python312\Lib\asyncio\locks.py:212> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_wait.<locals>._on_completion() at C:\Python312\Lib\asyncio\tasks.py:534]>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-13' coro=<Dispatcher._polling() running at C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py:345> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_wait.<locals>._on_completion() at C:\Python312\Lib\asyncio\tasks.py:534]>
INFO:aiogram.dispatcher:Polling stopped for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.dispatcher:Polling stopped
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442282 is handled. Duration 266 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-04 22:43:07.093595. Expiration time: 2024-08-04 22:13:07.093595
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442283 is not handled. Duration 15 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442283 by bot id=7064840472
KeyError: 'tovar'
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\admin.py", line 73, in adminPacks
    await try_edit_call(call, text='   : ', markup=await inline_kb_menu.admin_tovar_list_markup())
                                                                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\keyboards\inline\inline_kb_menu.py", line 113, in admin_tovar_list_markup
    btns.append([InlineKeyboardButton(text=f'{tovar["tovar"]}', callback_data=f'admin-tovar-info_{page}_{tovar["id"]}_{1}')])
                                              ~~~~~^^^^^^^^^
KeyError: 'tovar'
INFO:root:Checking for expired items at 2024-08-04 22:44:07.107466. Expiration time: 2024-08-04 22:14:07.107466
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 22:45:07.122848. Expiration time: 2024-08-04 22:15:07.122848
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000026ADED0B240>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000026ADED0B240>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442284 is handled. Duration 405 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442285 is handled. Duration 140 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-04 22:46:34.871846. Expiration time: 2024-08-04 22:16:34.871846
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 22:47:34.889611. Expiration time: 2024-08-04 22:17:34.889611
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000023AB9ABB240>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000023AB9ABB240>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442286 is not handled. Duration 0 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442287 is handled. Duration 265 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442288 is handled. Duration 140 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442289 is handled. Duration 109 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442290 is handled. Duration 155 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442291 is handled. Duration 140 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442292 is handled. Duration 108 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-04 22:49:39.313613. Expiration time: 2024-08-04 22:19:39.313613
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442293 is handled. Duration 172 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-04 22:50:39.332424. Expiration time: 2024-08-04 22:20:39.332424
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 22:51:39.344765. Expiration time: 2024-08-04 22:21:39.344765
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 22:52:39.356527. Expiration time: 2024-08-04 22:22:39.356527
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 22:53:39.360010. Expiration time: 2024-08-04 22:23:39.360010
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 22:54:39.357877. Expiration time: 2024-08-04 22:24:39.357877
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 22:55:39.375155. Expiration time: 2024-08-04 22:25:39.375155
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 22:56:39.384939. Expiration time: 2024-08-04 22:26:39.384939
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 22:57:39.392342. Expiration time: 2024-08-04 22:27:39.392342
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 22:58:39.391060. Expiration time: 2024-08-04 22:28:39.391060
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 22:59:39.404485. Expiration time: 2024-08-04 22:29:39.404485
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 23:00:39.418690. Expiration time: 2024-08-04 22:30:39.418690
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442294 is handled. Duration 266 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442295 is handled. Duration 234 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442296 is handled. Duration 329 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442297 is handled. Duration 295 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442298 is handled. Duration 202 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442299 is handled. Duration 329 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442300 is handled. Duration 312 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442301 is not handled. Duration 155 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442301 by bot id=7064840472
UndefinedTableError:  "cart"  
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 294, in handle_confirm_order
    await clear_cart(user_id)
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\utils\db_api\db_asyncpg.py", line 27, in clear_cart
    await connection.execute('DELETE FROM cart WHERE user_id = $1', user_id)
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 353, in execute
    _, status, _ = await self._execute(
                   ^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1794, in _execute
    result, _ = await self.__execute(
                ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1892, in __execute
    result, stmt = await self._do_execute(
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1925, in _do_execute
    stmt = await self._get_statement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 433, in _get_statement
    statement = await self._protocol.prepare(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\protocol\protocol.pyx", line 166, in prepare
asyncpg.exceptions.UndefinedTableError:  "cart"  
INFO:root:Checking for expired items at 2024-08-04 23:01:39.440428. Expiration time: 2024-08-04 22:31:39.440428
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 23:02:39.446774. Expiration time: 2024-08-04 22:32:39.446774
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 23:03:39.461946. Expiration time: 2024-08-04 22:33:39.461946
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 23:04:39.474315. Expiration time: 2024-08-04 22:34:39.474315
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 23:05:39.473248. Expiration time: 2024-08-04 22:35:39.473248
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 23:06:39.487071. Expiration time: 2024-08-04 22:36:39.487071
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 23:07:39.486590. Expiration time: 2024-08-04 22:37:39.486590
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 23:08:39.484708. Expiration time: 2024-08-04 22:38:39.484708
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 23:09:39.482770. Expiration time: 2024-08-04 22:39:39.482770
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 23:10:39.493604. Expiration time: 2024-08-04 22:40:39.493604
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 23:11:39.512371. Expiration time: 2024-08-04 22:41:39.512371
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 23:12:39.526319. Expiration time: 2024-08-04 22:42:39.526319
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 23:13:39.539190. Expiration time: 2024-08-04 22:43:39.539190
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 23:14:39.554113. Expiration time: 2024-08-04 22:44:39.554113
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 23:15:39.553249. Expiration time: 2024-08-04 22:45:39.553249
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 23:16:39.554015. Expiration time: 2024-08-04 22:46:39.554015
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 23:17:39.567878. Expiration time: 2024-08-04 22:47:39.567878
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 23:18:39.571818. Expiration time: 2024-08-04 22:48:39.571818
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 23:19:39.560582. Expiration time: 2024-08-04 22:49:39.560582
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 23:20:39.571652. Expiration time: 2024-08-04 22:50:39.571652
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 23:21:39.592463. Expiration time: 2024-08-04 22:51:39.592463
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 23:22:39.609264. Expiration time: 2024-08-04 22:52:39.609264
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 23:23:39.607088. Expiration time: 2024-08-04 22:53:39.607088
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 23:24:39.621888. Expiration time: 2024-08-04 22:54:39.621888
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 23:25:39.636811. Expiration time: 2024-08-04 22:55:39.636811
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 23:26:39.652033. Expiration time: 2024-08-04 22:56:39.652033
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 23:27:39.666779. Expiration time: 2024-08-04 22:57:39.666779
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 23:28:39.679745. Expiration time: 2024-08-04 22:58:39.679745
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 23:29:39.695380. Expiration time: 2024-08-04 22:59:39.695380
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 23:30:39.722603. Expiration time: 2024-08-04 23:00:39.722603
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 23:31:39.723955. Expiration time: 2024-08-04 23:01:39.723955
INFO:root:Expired items: [<Record product_id=7>]
INFO:root:Cleared expired items at 2024-08-04 23:31:39.729056
INFO:root:Checking for expired items at 2024-08-04 23:32:39.739252. Expiration time: 2024-08-04 23:02:39.739252
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 23:33:39.736954. Expiration time: 2024-08-04 23:03:39.736954
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 23:34:39.737430. Expiration time: 2024-08-04 23:04:39.737430
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 23:35:39.750513. Expiration time: 2024-08-04 23:05:39.750513
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 23:36:39.750741. Expiration time: 2024-08-04 23:06:39.750741
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 23:37:39.764844. Expiration time: 2024-08-04 23:07:39.764844
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 23:38:39.780176. Expiration time: 2024-08-04 23:08:39.780176
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 23:39:39.793216. Expiration time: 2024-08-04 23:09:39.793216
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 23:40:39.808435. Expiration time: 2024-08-04 23:10:39.808435
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 23:41:39.824279. Expiration time: 2024-08-04 23:11:39.824279
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 23:42:39.838638. Expiration time: 2024-08-04 23:12:39.838638
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 23:43:39.854409. Expiration time: 2024-08-04 23:13:39.854409
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 23:44:39.867340. Expiration time: 2024-08-04 23:14:39.867340
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 23:45:39.891391. Expiration time: 2024-08-04 23:15:39.891391
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 23:46:39.900337. Expiration time: 2024-08-04 23:16:39.900337
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 23:47:39.929958. Expiration time: 2024-08-04 23:17:39.929958
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 23:48:39.944192. Expiration time: 2024-08-04 23:18:39.944192
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 23:49:39.943662. Expiration time: 2024-08-04 23:19:39.943662
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 23:50:39.938726. Expiration time: 2024-08-04 23:20:39.938726
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 23:51:39.954835. Expiration time: 2024-08-04 23:21:39.954835
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 23:52:39.967697. Expiration time: 2024-08-04 23:22:39.967697
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 23:53:39.976082. Expiration time: 2024-08-04 23:23:39.976082
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 23:54:39.968150. Expiration time: 2024-08-04 23:24:39.968150
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 23:55:39.982556. Expiration time: 2024-08-04 23:25:39.982556
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 23:56:39.997679. Expiration time: 2024-08-04 23:26:39.997679
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 23:57:40.008924. Expiration time: 2024-08-04 23:27:40.008924
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 23:58:40.022989. Expiration time: 2024-08-04 23:28:40.022989
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-04 23:59:40.025282. Expiration time: 2024-08-04 23:29:40.025282
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 00:00:40.043001. Expiration time: 2024-08-04 23:30:40.043001
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 00:01:40.069173. Expiration time: 2024-08-04 23:31:40.069173
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 00:02:40.068532. Expiration time: 2024-08-04 23:32:40.068532
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 00:03:40.079359. Expiration time: 2024-08-04 23:33:40.079359
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 00:04:40.090012. Expiration time: 2024-08-04 23:34:40.090012
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 00:05:40.100716. Expiration time: 2024-08-04 23:35:40.100716
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 00:06:40.094532. Expiration time: 2024-08-04 23:36:40.094532
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 00:07:40.108935. Expiration time: 2024-08-04 23:37:40.108935
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 00:08:40.119328. Expiration time: 2024-08-04 23:38:40.119328
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 00:09:40.142889. Expiration time: 2024-08-04 23:39:40.142889
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 00:10:40.153744. Expiration time: 2024-08-04 23:40:40.153744
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 00:11:40.169780. Expiration time: 2024-08-04 23:41:40.169780
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 00:12:40.184270. Expiration time: 2024-08-04 23:42:40.184270
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 00:13:40.199452. Expiration time: 2024-08-04 23:43:40.199452
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 00:14:40.214646. Expiration time: 2024-08-04 23:44:40.214646
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 00:15:40.226935. Expiration time: 2024-08-04 23:45:40.226935
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 00:16:40.232871. Expiration time: 2024-08-04 23:46:40.232871
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 00:17:40.241627. Expiration time: 2024-08-04 23:47:40.241627
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 00:18:40.240414. Expiration time: 2024-08-04 23:48:40.240414
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 00:19:40.239025. Expiration time: 2024-08-04 23:49:40.239025
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 00:20:40.252233. Expiration time: 2024-08-04 23:50:40.252233
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 00:21:40.266713. Expiration time: 2024-08-04 23:51:40.266713
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 00:22:40.268599. Expiration time: 2024-08-04 23:52:40.268599
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 00:23:40.278348. Expiration time: 2024-08-04 23:53:40.278348
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000020A2984B600>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000020A2984B600>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442302 is handled. Duration 250 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 00:36:55.574804. Expiration time: 2024-08-05 00:06:55.574804
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442303 is handled. Duration 640 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442304 is not handled. Duration 0 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 00:37:55.589408. Expiration time: 2024-08-05 00:07:55.589408
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442305 is not handled. Duration 0 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 00:38:55.603892. Expiration time: 2024-08-05 00:08:55.603892
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442306 is not handled. Duration 0 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 00:39:55.613179. Expiration time: 2024-08-05 00:09:55.613179
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442307 is not handled. Duration 15 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442307 by bot id=7064840472
InvalidOperation: [<class 'decimal.ConversionSyntax'>]
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 132, in tovar_info_menu
    price = await get_price(amount)
            ^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\utils\db_api\db_asyncpg.py", line 148, in get_price
    decimal_val = Decimal(str(value))
                  ^^^^^^^^^^^^^^^^^^^
decimal.InvalidOperation: [<class 'decimal.ConversionSyntax'>]
INFO:aiogram.event:Update id=778442308 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442308 by bot id=7064840472
InvalidOperation: [<class 'decimal.ConversionSyntax'>]
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 132, in tovar_info_menu
    price = await get_price(amount)
            ^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\utils\db_api\db_asyncpg.py", line 148, in get_price
    decimal_val = Decimal(str(value))
                  ^^^^^^^^^^^^^^^^^^^
decimal.InvalidOperation: [<class 'decimal.ConversionSyntax'>]
INFO:root:Checking for expired items at 2024-08-05 00:40:55.605919. Expiration time: 2024-08-05 00:10:55.604890
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001565BF57240>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001565BF57240>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442309 is handled. Duration 282 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442310 is handled. Duration 234 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442311 is handled. Duration 125 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442312 is handled. Duration 219 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442313 is handled. Duration 94 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442314 is handled. Duration 187 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442315 is handled. Duration 78 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442316 is handled. Duration 172 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442317 is handled. Duration 92 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442318 is handled. Duration 422 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442319 is handled. Duration 890 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442320 is handled. Duration 187 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442321 is handled. Duration 94 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442322 is handled. Duration 186 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442323 is handled. Duration 77 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442324 is handled. Duration 170 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442325 is handled. Duration 93 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442326 is handled. Duration 202 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442327 is handled. Duration 92 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442328 is handled. Duration 265 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442329 is handled. Duration 265 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 00:43:48.175174. Expiration time: 2024-08-05 00:13:48.175174
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442330 is handled. Duration 250 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442331 is handled. Duration 172 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442332 is not handled. Duration 0 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 00:44:48.173929. Expiration time: 2024-08-05 00:14:48.173929
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 00:45:48.175346. Expiration time: 2024-08-05 00:15:48.175346
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 00:46:48.191100. Expiration time: 2024-08-05 00:16:48.191100
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 00:47:48.185731. Expiration time: 2024-08-05 00:17:48.185731
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 00:48:48.186931. Expiration time: 2024-08-05 00:18:48.186931
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 00:49:48.200924. Expiration time: 2024-08-05 00:19:48.200924
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 00:50:48.214575. Expiration time: 2024-08-05 00:20:48.214575
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 00:51:48.230664. Expiration time: 2024-08-05 00:21:48.230664
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000017F79B4B380>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000017F79B4B380>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442333 is handled. Duration 250 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442334 is not handled. Duration 15 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442334 by bot id=7064840472
ValidationError: 4 validation errors for SendMessage
reply_markup.InlineKeyboardMarkup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=<coroutine object admin_a...s at 0x00000203A38C1930>, input_type=coroutine]
    For further information visit https://errors.pydantic.dev/2.8/v/model_type
reply_markup.ReplyKeyboardMarkup
  Input should be a valid dictionary or instance of ReplyKeyboardMarkup [type=model_type, input_value=<coroutine object admin_a...s at 0x00000203A38C1930>, input_type=coroutine]
    For further information visit https://errors.pydantic.dev/2.8/v/model_type
reply_markup.ReplyKeyboardRemove
  Input should be a valid dictionary or instance of ReplyKeyboardRemove [type=model_type, input_value=<coroutine object admin_a...s at 0x00000203A38C1930>, input_type=coroutine]
    For further information visit https://errors.pydantic.dev/2.8/v/model_type
reply_markup.ForceReply
  Input should be a valid dictionary or instance of ForceReply [type=model_type, input_value=<coroutine object admin_a...s at 0x00000203A38C1930>, input_type=coroutine]
    For further information visit https://errors.pydantic.dev/2.8/v/model_type
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\admin.py", line 85, in hanndle_adding_list
    await call.message.answer('   :', reply_markup=inline_kb_menu.admin_adding_promos())
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\types\message.py", line 2044, in answer
    return SendMessage(
           ^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\pydantic\main.py", line 193, in __init__
    self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 4 validation errors for SendMessage
reply_markup.InlineKeyboardMarkup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=<coroutine object admin_a...s at 0x00000203A38C1930>, input_type=coroutine]
    For further information visit https://errors.pydantic.dev/2.8/v/model_type
reply_markup.ReplyKeyboardMarkup
  Input should be a valid dictionary or instance of ReplyKeyboardMarkup [type=model_type, input_value=<coroutine object admin_a...s at 0x00000203A38C1930>, input_type=coroutine]
    For further information visit https://errors.pydantic.dev/2.8/v/model_type
reply_markup.ReplyKeyboardRemove
  Input should be a valid dictionary or instance of ReplyKeyboardRemove [type=model_type, input_value=<coroutine object admin_a...s at 0x00000203A38C1930>, input_type=coroutine]
    For further information visit https://errors.pydantic.dev/2.8/v/model_type
reply_markup.ForceReply
  Input should be a valid dictionary or instance of ForceReply [type=model_type, input_value=<coroutine object admin_a...s at 0x00000203A38C1930>, input_type=coroutine]
    For further information visit https://errors.pydantic.dev/2.8/v/model_type
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x00000203A34A3600>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x00000203A34A3600>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442335 is handled. Duration 421 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442336 is handled. Duration 109 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442337 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442337 by bot id=7064840472
TypeError: 'coroutine' object is not subscriptable
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\admin.py", line 233, in handle_promocodes
    await add_promo(int(data['amount']), promo)
                        ~~~~^^^^^^^^^^
TypeError: 'coroutine' object is not subscriptable
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x00000164470EB4C0>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x00000164470EB4C0>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442338 is handled. Duration 562 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442339 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442339 by bot id=7064840472
TypeError: 'coroutine' object is not subscriptable
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\admin.py", line 233, in handle_promocodes
    await add_promo(int(data['amount']), promo)
                        ~~~~^^^^^^^^^^
TypeError: 'coroutine' object is not subscriptable
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x00000197EDBB3240>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x00000197EDBB3240>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442340 is handled. Duration 343 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442341 is handled. Duration 125 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442342 is not handled. Duration 94 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442342 by bot id=7064840472
AttributeError: 'FSMContext' object has no attribute 'finish'
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\admin.py", line 228, in handle_promocodes
    await state.finish()
          ^^^^^^^^^^^^
AttributeError: 'FSMContext' object has no attribute 'finish'
INFO:aiogram.event:Update id=778442343 is handled. Duration 250 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 00:56:09.484282. Expiration time: 2024-08-05 00:26:09.484282
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 00:57:09.487400. Expiration time: 2024-08-05 00:27:09.487318
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 00:58:09.496143. Expiration time: 2024-08-05 00:28:09.496143
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 00:59:09.512260. Expiration time: 2024-08-05 00:29:09.512260
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 01:00:09.513168. Expiration time: 2024-08-05 00:30:09.513168
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 01:01:09.529006. Expiration time: 2024-08-05 00:31:09.529006
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 01:02:09.547691. Expiration time: 2024-08-05 00:32:09.547691
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 01:03:09.557718. Expiration time: 2024-08-05 00:33:09.557718
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 01:04:09.573967. Expiration time: 2024-08-05 00:34:09.573967
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 01:05:09.582589. Expiration time: 2024-08-05 00:35:09.582589
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000027ECD723380>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000027ECD723380>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442344 is handled. Duration 250 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442345 is handled. Duration 203 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442346 is handled. Duration 186 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442347 is handled. Duration 125 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442348 is handled. Duration 453 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442349 is handled. Duration 93 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442350 is handled. Duration 125 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 01:07:28.900402. Expiration time: 2024-08-05 00:37:28.900402
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 01:08:28.902997. Expiration time: 2024-08-05 00:38:28.902997
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 01:09:28.921461. Expiration time: 2024-08-05 00:39:28.921461
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 01:10:28.930361. Expiration time: 2024-08-05 00:40:28.930361
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 01:11:28.963241. Expiration time: 2024-08-05 00:41:28.963241
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442351 is handled. Duration 422 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442352 is not handled. Duration 16 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442352 by bot id=7064840472
InvalidOperation: [<class 'decimal.ConversionSyntax'>]
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 132, in tovar_info_menu
    price = await get_price(amount)
            ^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\utils\db_api\db_asyncpg.py", line 148, in get_price
    decimal_val = Decimal(str(value))
                  ^^^^^^^^^^^^^^^^^^^
decimal.InvalidOperation: [<class 'decimal.ConversionSyntax'>]
INFO:root:Checking for expired items at 2024-08-05 01:12:28.986304. Expiration time: 2024-08-05 00:42:28.986304
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 01:13:28.988596. Expiration time: 2024-08-05 00:43:28.988596
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 01:14:29.006623. Expiration time: 2024-08-05 00:44:29.006623
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 01:15:29.021662. Expiration time: 2024-08-05 00:45:29.021662
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 01:16:29.025636. Expiration time: 2024-08-05 00:46:29.025636
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 01:17:29.035979. Expiration time: 2024-08-05 00:47:29.035979
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 01:18:29.043807. Expiration time: 2024-08-05 00:48:29.043807
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 01:19:29.058875. Expiration time: 2024-08-05 00:49:29.058875
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 01:20:29.072039. Expiration time: 2024-08-05 00:50:29.072039
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 01:21:29.086396. Expiration time: 2024-08-05 00:51:29.086396
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 01:22:29.097502. Expiration time: 2024-08-05 00:52:29.097502
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 01:23:29.098547. Expiration time: 2024-08-05 00:53:29.098547
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 01:24:29.113039. Expiration time: 2024-08-05 00:54:29.113039
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 01:25:29.130177. Expiration time: 2024-08-05 00:55:29.130177
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 01:26:29.144392. Expiration time: 2024-08-05 00:56:29.144392
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 01:27:29.157319. Expiration time: 2024-08-05 00:57:29.157319
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 01:28:29.157759. Expiration time: 2024-08-05 00:58:29.157759
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 01:29:29.158361. Expiration time: 2024-08-05 00:59:29.158361
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 01:30:29.169318. Expiration time: 2024-08-05 01:00:29.169236
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442353 is handled. Duration 250 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442354 is handled. Duration 329 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 01:31:29.183429. Expiration time: 2024-08-05 01:01:29.183429
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000025EC2DB34C0>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000025EC2DB34C0>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442355 is handled. Duration 297 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442356 is handled. Duration 280 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442357 is handled. Duration 77 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 01:32:46.422170. Expiration time: 2024-08-05 01:02:46.422170
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x00000279E84CB380>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x00000279E84CB380>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442358 is handled. Duration 0 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 01:34:44.022162. Expiration time: 2024-08-05 01:04:44.022162
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001881CF53600>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001881CF53600>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442359 is handled. Duration 266 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442360 is handled. Duration 329 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442361 is handled. Duration 15 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 01:35:58.858974. Expiration time: 2024-08-05 01:05:58.858974
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000002678D4CF600>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000002678D4CF600>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442362 is handled. Duration 15 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442363 is handled. Duration 297 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442364 is handled. Duration 280 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442365 is handled. Duration 0 ms by bot id=7064840472
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000002BD5E361D00>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000002BD5E361D00>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442366 is handled. Duration 15 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442367 is handled. Duration 234 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442368 is handled. Duration 297 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442369 is handled. Duration 15 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 01:38:50.922628. Expiration time: 2024-08-05 01:08:50.922628
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 01:39:50.926595. Expiration time: 2024-08-05 01:09:50.926595
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001FEAA413240>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001FEAA413240>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:root:Checking for expired items at 2024-08-05 01:41:14.310931. Expiration time: 2024-08-05 01:11:14.310931
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x00000287EE5934C0>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x00000287EE5934C0>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x00000287EE3BB650>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-14' coro=<Event.wait() running at C:\Python312\Lib\asyncio\locks.py:212> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_wait.<locals>._on_completion() at C:\Python312\Lib\asyncio\tasks.py:534]>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-13' coro=<Dispatcher._polling() running at C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py:345> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_wait.<locals>._on_completion() at C:\Python312\Lib\asyncio\tasks.py:534]>
INFO:aiogram.dispatcher:Polling stopped for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.dispatcher:Polling stopped
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442370 is handled. Duration 250 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442371 is not handled. Duration 109 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442371 by bot id=7064840472
ValidationError: 1 validation error for SendMessage
text
  Input should be a valid string [type=string_type, input_value=1054184718, input_type=int]
    For further information visit https://errors.pydantic.dev/2.8/v/string_type
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\admin.py", line 117, in show_next_transaction
    await call.message.answer(call.from_user.id, "   .", reply_markup=types.InlineKeyboardMarkup(
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\types\message.py", line 2044, in answer
    return SendMessage(
           ^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\pydantic\main.py", line 193, in __init__
    self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for SendMessage
text
  Input should be a valid string [type=string_type, input_value=1054184718, input_type=int]
    For further information visit https://errors.pydantic.dev/2.8/v/string_type
INFO:root:Checking for expired items at 2024-08-05 01:43:19.946285. Expiration time: 2024-08-05 01:13:19.946285
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000024C426E3600>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000024C426E3600>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442372 is handled. Duration 265 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442373 is handled. Duration 265 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442374 is handled. Duration 327 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 01:44:35.847551. Expiration time: 2024-08-05 01:14:35.847551
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001A161063600>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001A161063600>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442375 is handled. Duration 531 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442376 is handled. Duration 187 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 01:46:42.608070. Expiration time: 2024-08-05 01:16:42.608070
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442377 is handled. Duration 250 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442378 is handled. Duration 187 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442379 is handled. Duration 172 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442380 is handled. Duration 234 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442381 is handled. Duration 125 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 01:47:42.595298. Expiration time: 2024-08-05 01:17:42.595298
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442382 is handled. Duration 234 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442383 is handled. Duration 265 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442384 is handled. Duration 92 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442385 is handled. Duration 250 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442386 is handled. Duration 202 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442387 is not handled. Duration 0 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 01:48:42.606932. Expiration time: 2024-08-05 01:18:42.606932
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442388 is handled. Duration 280 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442389 is handled. Duration 234 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442390 is handled. Duration 188 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442391 is handled. Duration 157 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442392 is handled. Duration 327 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442393 is handled. Duration 188 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 01:49:42.631792. Expiration time: 2024-08-05 01:19:42.631792
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442394 is not handled. Duration 140 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442394 by bot id=7064840472
UndefinedTableError:  "cart"  
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 294, in handle_confirm_order
    await clear_cart(user_id)
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\utils\db_api\db_asyncpg.py", line 39, in clear_cart
    await connection.execute('DELETE FROM cart WHERE user_id = $1', user_id)
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 353, in execute
    _, status, _ = await self._execute(
                   ^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1794, in _execute
    result, _ = await self.__execute(
                ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1892, in __execute
    result, stmt = await self._do_execute(
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1925, in _do_execute
    stmt = await self._get_statement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 433, in _get_statement
    statement = await self._protocol.prepare(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\protocol\protocol.pyx", line 166, in prepare
asyncpg.exceptions.UndefinedTableError:  "cart"  
INFO:root:Checking for expired items at 2024-08-05 01:50:42.630968. Expiration time: 2024-08-05 01:20:42.630968
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001A1CF813380>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001A1CF813380>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442395 is handled. Duration 265 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442396 is handled. Duration 202 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442397 is handled. Duration 187 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442398 is handled. Duration 172 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442399 is handled. Duration 329 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442400 is handled. Duration 108 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 01:52:15.733940. Expiration time: 2024-08-05 01:22:15.733940
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 01:53:15.738591. Expiration time: 2024-08-05 01:23:15.738591
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001C83723A0C0>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001C83723A0C0>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442401 is not handled. Duration 15 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442401 by bot id=7064840472
UnboundLocalError: cannot access local variable 'product_ids' where it is not associated with a value
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 37, in clearBasket
    await send_basket(chat_id=call.message.chat.id, user_id=call.from_user.id)
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 89, in send_basket
    markup = await inline_kb_menu.basket_markup(basket=basket)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\keyboards\inline\inline_kb_menu.py", line 65, in basket_markup
    btns.append([InlineKeyboardButton(text='', callback_data=f'confirm_order{"_".join(map(str, product_ids))}')])
                                                                                                       ^^^^^^^^^^^
UnboundLocalError: cannot access local variable 'product_ids' where it is not associated with a value
INFO:aiogram.event:Update id=778442402 is not handled. Duration 15 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442402 by bot id=7064840472
UnboundLocalError: cannot access local variable 'product_ids' where it is not associated with a value
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 37, in clearBasket
    await send_basket(chat_id=call.message.chat.id, user_id=call.from_user.id)
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 89, in send_basket
    markup = await inline_kb_menu.basket_markup(basket=basket)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\keyboards\inline\inline_kb_menu.py", line 65, in basket_markup
    btns.append([InlineKeyboardButton(text='', callback_data=f'confirm_order{"_".join(map(str, product_ids))}')])
                                                                                                       ^^^^^^^^^^^
UnboundLocalError: cannot access local variable 'product_ids' where it is not associated with a value
INFO:root:Checking for expired items at 2024-08-05 01:54:34.678565. Expiration time: 2024-08-05 01:24:34.678565
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 01:55:34.675254. Expiration time: 2024-08-05 01:25:34.675254
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 01:56:34.682558. Expiration time: 2024-08-05 01:26:34.682558
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442403 is not handled. Duration 15 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442403 by bot id=7064840472
UnboundLocalError: cannot access local variable 'product_ids' where it is not associated with a value
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 37, in clearBasket
    await send_basket(chat_id=call.message.chat.id, user_id=call.from_user.id)
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 89, in send_basket
    markup = await inline_kb_menu.basket_markup(basket=basket)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\keyboards\inline\inline_kb_menu.py", line 65, in basket_markup
    btns.append([InlineKeyboardButton(text='', callback_data=f'confirm_order{"_".join(map(str, product_ids))}')])
                                                                                                       ^^^^^^^^^^^
UnboundLocalError: cannot access local variable 'product_ids' where it is not associated with a value
INFO:root:Checking for expired items at 2024-08-05 01:57:34.706103. Expiration time: 2024-08-05 01:27:34.706103
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 01:58:34.695342. Expiration time: 2024-08-05 01:28:34.695342
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 01:59:34.685800. Expiration time: 2024-08-05 01:29:34.685800
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 02:00:34.684676. Expiration time: 2024-08-05 01:30:34.684676
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442404 is not handled. Duration 15 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442405 is not handled. Duration 0 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442406 is not handled. Duration 15 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442407 is not handled. Duration 16 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442407 by bot id=7064840472
UnboundLocalError: cannot access local variable 'product_ids' where it is not associated with a value
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 37, in clearBasket
    await send_basket(chat_id=call.message.chat.id, user_id=call.from_user.id)
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 89, in send_basket
    markup = await inline_kb_menu.basket_markup(basket=basket)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\keyboards\inline\inline_kb_menu.py", line 65, in basket_markup
    btns.append([InlineKeyboardButton(text='', callback_data=f'confirm_order{"_".join(map(str, product_ids))}')])
                                                                                                       ^^^^^^^^^^^
UnboundLocalError: cannot access local variable 'product_ids' where it is not associated with a value
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x00000240951A7240>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x00000240951A7240>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442408 is not handled. Duration 16 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442408 by bot id=7064840472
UnboundLocalError: cannot access local variable 'product_ids' where it is not associated with a value
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\keyboard_menu.py", line 17, in show_basket
    await send_basket(chat_id=message.chat.id, user_id=message.chat.id)
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 91, in send_basket
    markup = await inline_kb_menu.basket_markup(basket=basket)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\keyboards\inline\inline_kb_menu.py", line 65, in basket_markup
    btns.append([InlineKeyboardButton(text='', callback_data=f'confirm_order{"_".join(map(str, product_ids))}')])
                                                                                                       ^^^^^^^^^^^
UnboundLocalError: cannot access local variable 'product_ids' where it is not associated with a value
INFO:root:Checking for expired items at 2024-08-05 02:03:17.450276. Expiration time: 2024-08-05 01:33:17.450276
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001D6623B74C0>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001D6623B74C0>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442409 is not handled. Duration 15 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442409 by bot id=7064840472
UnboundLocalError: cannot access local variable 'product_ids' where it is not associated with a value
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\keyboard_menu.py", line 17, in show_basket
    await send_basket(chat_id=message.chat.id, user_id=message.chat.id)
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 91, in send_basket
    markup = await inline_kb_menu.basket_markup(basket=basket)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\keyboards\inline\inline_kb_menu.py", line 65, in basket_markup
    if product_ids:
       ^^^^^^^^^^^
UnboundLocalError: cannot access local variable 'product_ids' where it is not associated with a value
INFO:root:Checking for expired items at 2024-08-05 02:05:12.702187. Expiration time: 2024-08-05 01:35:12.702187
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 02:06:12.717898. Expiration time: 2024-08-05 01:36:12.717898
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x00000222053E3600>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x00000222053E3600>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442410 is handled. Duration 390 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442411 is handled. Duration 125 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442412 is handled. Duration 233 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442413 is handled. Duration 125 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442414 is handled. Duration 250 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442415 is handled. Duration 172 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442416 is handled. Duration 109 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442417 is handled. Duration 281 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442418 is handled. Duration 186 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442419 is handled. Duration 281 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442420 is handled. Duration 94 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 02:07:29.235373. Expiration time: 2024-08-05 01:37:29.235373
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000002104A1A3600>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000002104A1A3600>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:root:Checking for expired items at 2024-08-05 10:41:48.550593. Expiration time: 2024-08-05 10:11:48.550593
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 10:42:48.571325. Expiration time: 2024-08-05 10:12:48.571325
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 10:43:48.586014. Expiration time: 2024-08-05 10:13:48.586014
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000002561A482E80>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000002561A482E80>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000002561A2BA900>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-14' coro=<Event.wait() running at C:\Python312\Lib\asyncio\locks.py:212> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_wait.<locals>._on_completion() at C:\Python312\Lib\asyncio\tasks.py:534]>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-13' coro=<Dispatcher._polling() running at C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py:345> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_wait.<locals>._on_completion() at C:\Python312\Lib\asyncio\tasks.py:534]>
INFO:aiogram.dispatcher:Polling stopped for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.dispatcher:Polling stopped
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442421 is handled. Duration 532 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442422 is handled. Duration 125 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442423 is handled. Duration 234 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442424 is handled. Duration 282 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 10:57:30.546957. Expiration time: 2024-08-05 10:27:30.546957
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442425 is handled. Duration 327 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442426 is handled. Duration 155 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442427 is handled. Duration 202 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442428 is handled. Duration 93 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 10:58:30.576038. Expiration time: 2024-08-05 10:28:30.576038
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442429 is handled. Duration 250 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442430 is handled. Duration 170 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 10:59:30.588589. Expiration time: 2024-08-05 10:29:30.588589
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442431 is handled. Duration 109 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442432 is handled. Duration 297 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442433 is handled. Duration 109 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442434 is handled. Duration 250 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 11:00:30.605660. Expiration time: 2024-08-05 10:30:30.605660
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 11:01:30.612560. Expiration time: 2024-08-05 10:31:30.612560
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 11:02:30.619970. Expiration time: 2024-08-05 10:32:30.619970
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 11:03:30.638042. Expiration time: 2024-08-05 10:33:30.638042
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 11:04:30.653283. Expiration time: 2024-08-05 10:34:30.653283
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 11:05:30.668042. Expiration time: 2024-08-05 10:35:30.668042
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 11:06:30.675551. Expiration time: 2024-08-05 10:36:30.675551
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001E56293F4C0>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001E56293F4C0>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442435 is handled. Duration 266 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442436 is handled. Duration 202 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442437 is handled. Duration 219 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442438 is handled. Duration 125 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442439 is handled. Duration 625 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442440 is handled. Duration 234 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442441 is handled. Duration 469 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 11:07:49.828423. Expiration time: 2024-08-05 10:37:49.828423
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 11:08:49.841530. Expiration time: 2024-08-05 10:38:49.841530
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442442 is handled. Duration 297 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442443 is handled. Duration 93 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442444 is handled. Duration 234 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442445 is handled. Duration 125 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442446 is handled. Duration 187 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442447 is handled. Duration 109 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442448 is handled. Duration 233 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442449 is handled. Duration 327 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442450 is handled. Duration 217 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442451 is handled. Duration 312 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442452 is handled. Duration 187 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442453 is not handled. Duration 0 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442454 is not handled. Duration 0 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 11:09:49.857980. Expiration time: 2024-08-05 10:39:49.857861
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 11:10:49.856201. Expiration time: 2024-08-05 10:40:49.856201
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442455 is handled. Duration 250 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442456 is handled. Duration 187 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442457 is handled. Duration 390 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442458 is handled. Duration 344 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442459 is handled. Duration 109 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 11:11:49.865635. Expiration time: 2024-08-05 10:41:49.865635
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 11:12:49.866054. Expiration time: 2024-08-05 10:42:49.866054
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 11:13:49.884519. Expiration time: 2024-08-05 10:43:49.884519
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 11:14:49.894665. Expiration time: 2024-08-05 10:44:49.894665
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 11:15:49.898226. Expiration time: 2024-08-05 10:45:49.898226
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 11:16:49.908045. Expiration time: 2024-08-05 10:46:49.908045
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 11:17:49.907412. Expiration time: 2024-08-05 10:47:49.907412
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 11:18:49.916297. Expiration time: 2024-08-05 10:48:49.916297
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 11:19:49.931518. Expiration time: 2024-08-05 10:49:49.931518
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000024B3FA63880>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000024B3FA63880>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442460 is handled. Duration 281 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442461 is handled. Duration 15 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 11:21:54.345135. Expiration time: 2024-08-05 10:51:54.345135
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000002639C66F380>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000002639C66F380>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442462 is handled. Duration 312 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442463 is handled. Duration 141 ms by bot id=7064840472
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001D00C9FF740>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001D00C9FF740>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442464 is handled. Duration 297 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442465 is not handled. Duration 0 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 11:24:44.933505. Expiration time: 2024-08-05 10:54:44.933505
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000013ED9DCF4C0>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000013ED9DCF4C0>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442466 is handled. Duration 343 ms by bot id=7064840472
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000020CE251F380>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000020CE251F380>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442467 is handled. Duration 313 ms by bot id=7064840472
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000026D53EBF600>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000026D53EBF600>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000020C0BECF740>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000020C0BECF740>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x0000020C0C30A3C0>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-14' coro=<Event.wait() running at C:\Python312\Lib\asyncio\locks.py:212> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_wait.<locals>._on_completion() at C:\Python312\Lib\asyncio\tasks.py:534]>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-13' coro=<Dispatcher._polling() running at C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py:345> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_wait.<locals>._on_completion() at C:\Python312\Lib\asyncio\tasks.py:534]>
INFO:aiogram.dispatcher:Polling stopped for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.dispatcher:Polling stopped
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442468 is handled. Duration 250 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442469 is handled. Duration 250 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 11:28:21.399219. Expiration time: 2024-08-05 10:58:21.399219
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442470 is handled. Duration 94 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442471 is handled. Duration 92 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 11:29:21.388782. Expiration time: 2024-08-05 10:59:21.388782
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000002385C49F740>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000002385C49F740>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442472 is handled. Duration 250 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 11:33:42.464329. Expiration time: 2024-08-05 11:03:42.464329
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442473 is handled. Duration 656 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442474 is handled. Duration 530 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442475 is handled. Duration 219 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442476 is handled. Duration 109 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442477 is handled. Duration 297 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442478 is handled. Duration 186 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442479 is handled. Duration 233 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442480 is handled. Duration 171 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 11:34:42.465619. Expiration time: 2024-08-05 11:04:42.465619
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442481 is handled. Duration 250 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442482 is handled. Duration 218 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442483 is handled. Duration 250 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442484 is handled. Duration 233 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442485 is handled. Duration 187 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442486 is handled. Duration 219 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 11:35:42.476355. Expiration time: 2024-08-05 11:05:42.476355
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442487 is handled. Duration 297 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442488 is handled. Duration 655 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 11:36:42.477163. Expiration time: 2024-08-05 11:06:42.477163
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442489 is handled. Duration 3875 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442490 is handled. Duration 327 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 11:37:42.471160. Expiration time: 2024-08-05 11:07:42.471160
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442491 is handled. Duration 16 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442492 is handled. Duration 359 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442493 is handled. Duration 0 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 11:38:42.466135. Expiration time: 2024-08-05 11:08:42.466135
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442494 is handled. Duration 312 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442495 is handled. Duration 156 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442496 is handled. Duration 390 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442497 is handled. Duration 155 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442498 is not handled. Duration 266 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442498 by bot id=7064840472
DataError: invalid input for query argument $1: 5253318522 (value out of int32 range)
Traceback (most recent call last):
  File "asyncpg\protocol\prepared_stmt.pyx", line 175, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
  File "asyncpg\protocol\codecs/base.pyx", line 227, in asyncpg.protocol.protocol.Codec.encode
  File "asyncpg\protocol\codecs/base.pyx", line 129, in asyncpg.protocol.protocol.Codec.encode_scalar
  File "asyncpg\pgproto\./codecs/int.pyx", line 60, in asyncpg.pgproto.pgproto.int4_encode
OverflowError: value out of int32 range

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 237, in transaction_amount
    awaited_transactions = await get_not_accepted_transactions()
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\utils\db_api\db_asyncpg.py", line 130, in add_transaction
    await connection.execute(query, user_id, amount, "OnCheck", date, operation_id)
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 353, in execute
    _, status, _ = await self._execute(
                   ^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1794, in _execute
    result, _ = await self.__execute(
                ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1892, in __execute
    result, stmt = await self._do_execute(
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1945, in _do_execute
    result = await executor(stmt, None)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\protocol\protocol.pyx", line 186, in bind_execute
  File "asyncpg\protocol\prepared_stmt.pyx", line 204, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
asyncpg.exceptions.DataError: invalid input for query argument $1: 5253318522 (value out of int32 range)
INFO:root:Checking for expired items at 2024-08-05 11:39:42.472006. Expiration time: 2024-08-05 11:09:42.472006
INFO:root:Expired items: [<Record product_id=8>]
INFO:root:Cleared expired items at 2024-08-05 11:39:42.477017
INFO:root:Checking for expired items at 2024-08-05 11:40:42.487055. Expiration time: 2024-08-05 11:10:42.487055
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 11:41:42.500589. Expiration time: 2024-08-05 11:11:42.500589
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442499 is handled. Duration 313 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442500 is handled. Duration 297 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442501 is handled. Duration 327 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442502 is handled. Duration 202 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442503 is not handled. Duration 16 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442503 by bot id=7064840472
TypeError: 'NoneType' object is not subscriptable
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 231, in transaction_amount
    print(message.photo[0].file_id)
          ~~~~~~~~~~~~~^^^
TypeError: 'NoneType' object is not subscriptable
INFO:aiogram.event:Update id=778442504 is handled. Duration 391 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 11:42:42.509453. Expiration time: 2024-08-05 11:12:42.509453
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 11:43:42.516733. Expiration time: 2024-08-05 11:13:42.516733
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442505 is handled. Duration 688 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442506 is handled. Duration 3500 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442507 is handled. Duration 157 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442508 is handled. Duration 156 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442509 is handled. Duration 187 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442510 is handled. Duration 202 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442511 is handled. Duration 125 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442512 is handled. Duration 297 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 11:44:42.521345. Expiration time: 2024-08-05 11:14:42.521345
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442513 is handled. Duration 202 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442514 is handled. Duration 234 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 11:45:42.526982. Expiration time: 2024-08-05 11:15:42.526982
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442515 is handled. Duration 218 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 11:46:42.537213. Expiration time: 2024-08-05 11:16:42.537213
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 11:47:42.528321. Expiration time: 2024-08-05 11:17:42.528321
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 11:48:42.534039. Expiration time: 2024-08-05 11:18:42.534039
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442516 is handled. Duration 344 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442517 is handled. Duration 109 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442518 is handled. Duration 202 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442519 is handled. Duration 109 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442520 is handled. Duration 186 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442521 is handled. Duration 109 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 11:49:42.538485. Expiration time: 2024-08-05 11:19:42.538485
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442522 is handled. Duration 280 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 11:50:42.551110. Expiration time: 2024-08-05 11:20:42.551110
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001FA313CB9C0>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001FA313CB9C0>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442523 is handled. Duration 250 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442524 is handled. Duration 188 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442525 is handled. Duration 108 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442526 is handled. Duration 156 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442527 is handled. Duration 109 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442528 is handled. Duration 94 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442529 is handled. Duration 93 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442530 is handled. Duration 156 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 11:52:03.365328. Expiration time: 2024-08-05 11:22:03.365328
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442531 is handled. Duration 234 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442532 is handled. Duration 672 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 11:53:03.390136. Expiration time: 2024-08-05 11:23:03.390136
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 11:54:03.410913. Expiration time: 2024-08-05 11:24:03.410913
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442533 is handled. Duration 422 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442534 is handled. Duration 202 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442535 is handled. Duration 437 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442536 is handled. Duration 406 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442537 is handled. Duration 155 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442538 is handled. Duration 203 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 11:55:03.411619. Expiration time: 2024-08-05 11:25:03.411619
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442539 is handled. Duration 234 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442540 is handled. Duration 234 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 11:56:03.413308. Expiration time: 2024-08-05 11:26:03.413308
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 11:57:03.404774. Expiration time: 2024-08-05 11:27:03.404774
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 11:58:03.413230. Expiration time: 2024-08-05 11:28:03.413230
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001FFF1457880>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001FFF1457880>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442541 is handled. Duration 265 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442542 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442542 by bot id=7064840472
TypeError: 'NoneType' object is not subscriptable
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\admin.py", line 67, in adminPanel
    if await user_is_admin(messsage.from_user.id):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\utils\db_api\db_asyncpg.py", line 202, in user_is_admin
    return result['isadmin']
           ~~~~~~^^^^^^^^^^^
TypeError: 'NoneType' object is not subscriptable
INFO:root:Checking for expired items at 2024-08-05 11:59:14.283638. Expiration time: 2024-08-05 11:29:14.283638
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442543 is handled. Duration 250 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442544 is handled. Duration 312 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442545 is handled. Duration 390 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442546 is handled. Duration 125 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442547 is handled. Duration 219 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442548 is handled. Duration 343 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442549 is handled. Duration 297 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442550 is handled. Duration 233 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442551 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442551 by bot id=7064840472
KeyError: 'amount'
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 166, in handle_count
    count = await get_count(int(data["amount"]))
                                ~~~~^^^^^^^^^^
KeyError: 'amount'
INFO:root:Checking for expired items at 2024-08-05 12:00:14.300012. Expiration time: 2024-08-05 11:30:14.299906
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442552 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442552 by bot id=7064840472
KeyError: 'amount'
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 166, in handle_count
    count = await get_count(int(data["amount"]))
                                ~~~~^^^^^^^^^^
KeyError: 'amount'
INFO:aiogram.event:Update id=778442553 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442553 by bot id=7064840472
KeyError: 'amount'
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 166, in handle_count
    count = await get_count(int(data["amount"]))
                                ~~~~^^^^^^^^^^
KeyError: 'amount'
INFO:root:Checking for expired items at 2024-08-05 12:01:14.303580. Expiration time: 2024-08-05 11:31:14.303580
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442554 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442554 by bot id=7064840472
KeyError: 'amount'
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 166, in handle_count
    count = await get_count(int(data["amount"]))
                                ~~~~^^^^^^^^^^
KeyError: 'amount'
INFO:root:Checking for expired items at 2024-08-05 12:02:14.315947. Expiration time: 2024-08-05 11:32:14.315947
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442555 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442555 by bot id=7064840472
KeyError: 'amount'
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 166, in handle_count
    count = await get_count(int(data["amount"]))
                                ~~~~^^^^^^^^^^
KeyError: 'amount'
INFO:root:Checking for expired items at 2024-08-05 12:03:14.336174. Expiration time: 2024-08-05 11:33:14.336174
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001874A84B880>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001874A84B880>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442556 is handled. Duration 250 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442557 is handled. Duration 233 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442558 is handled. Duration 327 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442559 is handled. Duration 108 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442560 is handled. Duration 468 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442561 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442561 by bot id=7064840472
KeyError: 'amount'
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 167, in handle_count
    count = await get_count(int(data["amount"]))
                                ~~~~^^^^^^^^^^
KeyError: 'amount'
INFO:root:Checking for expired items at 2024-08-05 12:04:50.924768. Expiration time: 2024-08-05 11:34:50.924768
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000025C58D5E0C0>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000025C58D5E0C0>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442562 is handled. Duration 281 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442563 is handled. Duration 234 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442564 is not handled. Duration 0 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442565 is handled. Duration 375 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442566 is handled. Duration 140 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442567 is handled. Duration 250 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442568 is handled. Duration 297 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 12:06:45.535977. Expiration time: 2024-08-05 11:36:45.535977
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442569 is handled. Duration 467 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442570 is handled. Duration 108 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442571 is handled. Duration 297 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442572 is handled. Duration 390 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442573 is handled. Duration 313 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442574 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442574 by bot id=7064840472
ValueError: invalid literal for int() with base 10: '\U0001f4b2 '
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 169, in handle_count
    if int(data["count"]) > count:
       ^^^^^^^^^^^^^^^^^^
ValueError: invalid literal for int() with base 10: '\U0001f4b2 '
INFO:root:Checking for expired items at 2024-08-05 12:07:45.541998. Expiration time: 2024-08-05 11:37:45.541998
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442575 is handled. Duration 405 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442576 is handled. Duration 203 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442577 is handled. Duration 93 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442578 is handled. Duration 187 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442579 is handled. Duration 202 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442580 is handled. Duration 344 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442581 is handled. Duration 109 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442582 is handled. Duration 297 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442583 is handled. Duration 170 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442584 is handled. Duration 93 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 12:08:45.559708. Expiration time: 2024-08-05 11:38:45.559708
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442585 is handled. Duration 234 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442586 is handled. Duration 500 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442587 is handled. Duration 3875 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442588 is handled. Duration 125 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442589 is handled. Duration 108 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442590 is handled. Duration 297 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442591 is handled. Duration 172 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442592 is handled. Duration 202 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442593 is handled. Duration 94 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442594 is handled. Duration 312 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442595 is handled. Duration 172 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442596 is handled. Duration 109 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442597 is handled. Duration 250 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442598 is handled. Duration 202 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442599 is handled. Duration 312 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442600 is handled. Duration 170 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 12:09:45.576818. Expiration time: 2024-08-05 11:39:45.576818
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442601 is handled. Duration 109 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442602 is handled. Duration 265 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442603 is handled. Duration 141 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442604 is handled. Duration 295 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442605 is handled. Duration 186 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442606 is handled. Duration 109 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442607 is handled. Duration 233 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442608 is handled. Duration 375 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442609 is handled. Duration 0 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 12:10:45.583923. Expiration time: 2024-08-05 11:40:45.583923
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 12:11:45.589335. Expiration time: 2024-08-05 11:41:45.589335
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x00000258F6A3B740>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x00000258F6A3B740>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442610 is handled. Duration 297 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 12:12:56.162387. Expiration time: 2024-08-05 11:42:56.162387
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 12:13:56.191776. Expiration time: 2024-08-05 11:43:56.191776
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 12:14:56.206210. Expiration time: 2024-08-05 11:44:56.206210
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442611 is handled. Duration 233 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442612 is handled. Duration 234 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442613 is handled. Duration 234 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442614 is handled. Duration 219 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442615 is handled. Duration 109 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442616 is handled. Duration 312 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442617 is handled. Duration 280 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442618 is handled. Duration 562 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 12:15:56.216537. Expiration time: 2024-08-05 11:45:56.216537
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 12:16:56.238534. Expiration time: 2024-08-05 11:46:56.238534
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442619 is handled. Duration 250 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442620 is handled. Duration 217 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442621 is handled. Duration 468 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442622 is handled. Duration 172 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442623 is handled. Duration 186 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442624 is handled. Duration 234 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442625 is handled. Duration 405 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442626 is handled. Duration 188 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442627 is handled. Duration 405 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442628 is handled. Duration 172 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442629 is handled. Duration 109 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442630 is handled. Duration 250 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442631 is handled. Duration 359 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442632 is handled. Duration 109 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442633 is handled. Duration 92 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442634 is handled. Duration 172 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442635 is not handled. Duration 0 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 12:17:56.255064. Expiration time: 2024-08-05 11:47:56.255064
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442636 is handled. Duration 188 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442637 is handled. Duration 186 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442638 is handled. Duration 186 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442639 is handled. Duration 219 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442640 is handled. Duration 109 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442641 is handled. Duration 250 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 12:18:56.255568. Expiration time: 2024-08-05 11:48:56.255568
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 12:19:56.275738. Expiration time: 2024-08-05 11:49:56.275738
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x00000280DFDB2E80>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x00000280DFDB2E80>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442642 is handled. Duration 327 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442643 is handled. Duration 109 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442644 is handled. Duration 109 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442645 is handled. Duration 204 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442646 is handled. Duration 218 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442647 is handled. Duration 125 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442648 is handled. Duration 327 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442649 is handled. Duration 250 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442650 is handled. Duration 311 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442651 is handled. Duration 109 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442652 is handled. Duration 202 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442653 is not handled. Duration 15 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442654 is handled. Duration 266 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442655 is handled. Duration 140 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442656 is handled. Duration 218 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442657 is handled. Duration 250 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 12:21:03.728809. Expiration time: 2024-08-05 11:51:03.728809
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442658 is not handled. Duration 15 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442658 by bot id=7064840472
InterfaceError: the server expects 1 argument for this query, 2 were passed
HINT:  Check the query against the passed list of arguments.
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 285, in handle_confirm_order
    promo_codes = await get_promo_codes(cart_items)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\utils\db_api\db_asyncpg.py", line 61, in get_promo_codes
    await connection.execute('''
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 353, in execute
    _, status, _ = await self._execute(
                   ^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1794, in _execute
    result, _ = await self.__execute(
                ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1892, in __execute
    result, stmt = await self._do_execute(
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1945, in _do_execute
    result = await executor(stmt, None)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\protocol\protocol.pyx", line 186, in bind_execute
  File "asyncpg\protocol\prepared_stmt.pyx", line 149, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
asyncpg.exceptions._base.InterfaceError: the server expects 1 argument for this query, 2 were passed
HINT:  Check the query against the passed list of arguments.
INFO:aiogram.event:Update id=778442659 is handled. Duration 109 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442660 is handled. Duration 140 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 12:22:03.749794. Expiration time: 2024-08-05 11:52:03.749794
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 12:23:03.766253. Expiration time: 2024-08-05 11:53:03.766253
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 12:24:03.775723. Expiration time: 2024-08-05 11:54:03.775723
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442661 is handled. Duration 375 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442662 is handled. Duration 359 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442663 is handled. Duration 92 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442664 is handled. Duration 217 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442665 is handled. Duration 342 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442666 is handled. Duration 250 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442667 is handled. Duration 468 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 12:25:03.796612. Expiration time: 2024-08-05 11:55:03.796612
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442668 is handled. Duration 202 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442669 is handled. Duration 3687 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442670 is handled. Duration 3984 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442671 is handled. Duration 202 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442672 is handled. Duration 250 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442673 is handled. Duration 187 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442674 is handled. Duration 109 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442675 is handled. Duration 202 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442676 is handled. Duration 204 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 12:26:03.809841. Expiration time: 2024-08-05 11:56:03.809841
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442677 is not handled. Duration 15 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442677 by bot id=7064840472
InterfaceError: the server expects 1 argument for this query, 2 were passed
HINT:  Check the query against the passed list of arguments.
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 285, in handle_confirm_order
    #  
          ^^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\utils\db_api\db_asyncpg.py", line 61, in get_promo_codes
    await connection.execute('''
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 353, in execute
    _, status, _ = await self._execute(
                   ^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1794, in _execute
    result, _ = await self.__execute(
                ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1892, in __execute
    result, stmt = await self._do_execute(
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1945, in _do_execute
    result = await executor(stmt, None)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\protocol\protocol.pyx", line 186, in bind_execute
  File "asyncpg\protocol\prepared_stmt.pyx", line 149, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
asyncpg.exceptions._base.InterfaceError: the server expects 1 argument for this query, 2 were passed
HINT:  Check the query against the passed list of arguments.
INFO:root:Checking for expired items at 2024-08-05 12:27:03.819009. Expiration time: 2024-08-05 11:57:03.819009
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 12:28:03.832426. Expiration time: 2024-08-05 11:58:03.832426
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001E5F9497600>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001E5F9497600>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442678 is handled. Duration 547 ms by bot id=7064840472
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001ED3C6C7740>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001ED3C6C7740>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442679 is handled. Duration 312 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442680 is handled. Duration 327 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442681 is handled. Duration 186 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442682 is handled. Duration 344 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442683 is handled. Duration 343 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442684 is handled. Duration 202 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442685 is handled. Duration 390 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 12:30:50.600977. Expiration time: 2024-08-05 12:00:50.600977
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 12:31:50.618276. Expiration time: 2024-08-05 12:01:50.618276
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000022DF1757740>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000022DF1757740>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442686 is handled. Duration 297 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442687 is handled. Duration 233 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442688 is handled. Duration 202 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442689 is handled. Duration 125 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442690 is handled. Duration 219 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442691 is handled. Duration 187 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442692 is handled. Duration 640 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 12:33:44.145149. Expiration time: 2024-08-05 12:03:44.145149
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 12:34:44.156001. Expiration time: 2024-08-05 12:04:44.156001
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 12:35:44.168990. Expiration time: 2024-08-05 12:05:44.168990
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000027D6CDEB4C0>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000027D6CDEB4C0>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442693 is handled. Duration 282 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442694 is handled. Duration 234 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442695 is handled. Duration 547 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442696 is handled. Duration 125 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442697 is handled. Duration 234 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442698 is handled. Duration 217 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442699 is handled. Duration 452 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 12:36:51.344856. Expiration time: 2024-08-05 12:06:51.344856
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 12:37:51.353300. Expiration time: 2024-08-05 12:07:51.353300
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x00000287BB757600>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x00000287BB757600>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442700 is handled. Duration 297 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442701 is handled. Duration 420 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442702 is handled. Duration 187 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442703 is handled. Duration 186 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442704 is handled. Duration 234 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442705 is handled. Duration 202 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442706 is handled. Duration 327 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 12:39:11.851965. Expiration time: 2024-08-05 12:09:11.851965
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442707 is handled. Duration 234 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442708 is handled. Duration 204 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442709 is handled. Duration 172 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442710 is handled. Duration 109 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442711 is handled. Duration 202 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442712 is handled. Duration 422 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442713 is handled. Duration 390 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 12:40:11.870865. Expiration time: 2024-08-05 12:10:11.870865
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 12:41:11.892176. Expiration time: 2024-08-05 12:11:11.892176
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 12:42:11.899443. Expiration time: 2024-08-05 12:12:11.899443
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 12:43:11.915123. Expiration time: 2024-08-05 12:13:11.915123
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 12:44:11.916417. Expiration time: 2024-08-05 12:14:11.916417
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 12:45:11.921557. Expiration time: 2024-08-05 12:15:11.921557
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 12:46:11.933744. Expiration time: 2024-08-05 12:16:11.933744
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 12:47:11.949974. Expiration time: 2024-08-05 12:17:11.949974
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x00000222C663B880>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x00000222C663B880>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442714 is handled. Duration 266 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442715 is handled. Duration 219 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442716 is handled. Duration 202 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442717 is handled. Duration 359 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442718 is handled. Duration 187 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442719 is handled. Duration 155 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442720 is handled. Duration 531 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442721 is handled. Duration 186 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442722 is handled. Duration 453 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 12:48:40.402220. Expiration time: 2024-08-05 12:18:40.402220
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 12:49:40.407073. Expiration time: 2024-08-05 12:19:40.407073
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442723 is handled. Duration 266 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442724 is handled. Duration 250 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 12:50:40.416841. Expiration time: 2024-08-05 12:20:40.416841
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 12:51:40.438768. Expiration time: 2024-08-05 12:21:40.438768
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 12:52:40.440096. Expiration time: 2024-08-05 12:22:40.440096
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 12:53:40.462056. Expiration time: 2024-08-05 12:23:40.462056
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000018C4C007600>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000018C4C007600>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442725 is handled. Duration 343 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442726 is not handled. Duration 16 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442726 by bot id=7064840472
KeyError: 'amount'
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 167, in handle_count
    count = await get_count(int(data["amount"]))
                                ~~~~^^^^^^^^^^
KeyError: 'amount'
INFO:aiogram.event:Update id=778442727 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442727 by bot id=7064840472
KeyError: 'amount'
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 167, in handle_count
    count = await get_count(int(data["amount"]))
                                ~~~~^^^^^^^^^^
KeyError: 'amount'
INFO:root:Checking for expired items at 2024-08-05 12:55:44.853748. Expiration time: 2024-08-05 12:25:44.853748
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 12:56:44.872103. Expiration time: 2024-08-05 12:26:44.872103
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442728 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442728 by bot id=7064840472
KeyError: 'amount'
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 167, in handle_count
    count = await get_count(int(data["amount"]))
                                ~~~~^^^^^^^^^^
KeyError: 'amount'
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x00000149EEEAB880>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x00000149EEEAB880>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442729 is handled. Duration 250 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442730 is handled. Duration 282 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442731 is handled. Duration 188 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442732 is handled. Duration 187 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442733 is handled. Duration 250 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442734 is handled. Duration 202 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442735 is not handled. Duration 16 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442735 by bot id=7064840472
KeyError: 'id'
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 286, in handle_confirm_order
    promo_codes = await get_promo_codes(cart_items)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\utils\db_api\db_asyncpg.py", line 70, in get_promo_codes
    product_ids = [record['id'] for record in cart_items]
                   ~~~~~~^^^^^^
KeyError: 'id'
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001E6BABC3380>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001E6BABC3380>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442736 is handled. Duration 296 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442737 is not handled. Duration 15 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442737 by bot id=7064840472
InterfaceError: cannot call Connection.execute(): connection has been released back to the pool
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 286, in handle_confirm_order
    promo_codes = await get_promo_codes(cart_items)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\utils\db_api\db_asyncpg.py", line 72, in get_promo_codes
    await connection.execute(f'''
          ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\pool.py", line 50, in call_con_method
    raise exceptions.InterfaceError(
asyncpg.exceptions._base.InterfaceError: cannot call Connection.execute(): connection has been released back to the pool
INFO:root:Checking for expired items at 2024-08-05 12:58:46.152313. Expiration time: 2024-08-05 12:28:46.152313
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001FE7FF1B240>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001FE7FF1B240>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442738 is handled. Duration 266 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442739 is handled. Duration 609 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 13:00:16.461512. Expiration time: 2024-08-05 12:30:16.461512
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 13:01:16.481839. Expiration time: 2024-08-05 12:31:16.481839
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001EE1821B9C0>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001EE1821B9C0>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442740 is handled. Duration 297 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442741 is handled. Duration 233 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442742 is handled. Duration 282 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442743 is handled. Duration 219 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442744 is handled. Duration 265 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442745 is handled. Duration 437 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442746 is handled. Duration 438 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 13:03:06.049031. Expiration time: 2024-08-05 12:33:06.049031
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442747 is handled. Duration 297 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442748 is handled. Duration 265 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 13:04:06.061825. Expiration time: 2024-08-05 12:34:06.061825
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442749 is handled. Duration 202 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442750 is handled. Duration 186 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442751 is handled. Duration 125 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442752 is handled. Duration 359 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442753 is handled. Duration 422 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442754 is handled. Duration 296 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442755 is handled. Duration 297 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442756 is handled. Duration 187 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 13:05:06.078110. Expiration time: 2024-08-05 12:35:06.078110
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 13:06:06.084713. Expiration time: 2024-08-05 12:36:06.084713
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 13:07:06.062318. Expiration time: 2024-08-05 12:37:06.062318
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000015D265FBB00>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000015D265FBB00>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442757 is handled. Duration 282 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442758 is handled. Duration 204 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442759 is handled. Duration 204 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442760 is handled. Duration 171 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442761 is handled. Duration 250 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442762 is handled. Duration 186 ms by bot id=7064840472
ERROR:root:     id 27: list indices must be integers or slices, not str
ERROR:root:     id 28: list indices must be integers or slices, not str
INFO:aiogram.event:Update id=778442763 is handled. Duration 452 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 13:08:13.407033. Expiration time: 2024-08-05 12:38:13.407033
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000018648C5B4C0>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000018648C5B4C0>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:root:Checking for expired items at 2024-08-05 13:09:45.210133. Expiration time: 2024-08-05 12:39:45.210133
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 13:10:45.235821. Expiration time: 2024-08-05 12:40:45.235821
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001BB3B0FB240>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001BB3B0FB240>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
ERROR:asyncio:Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001BB3AFB6660>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-14' coro=<Event.wait() running at C:\Python312\Lib\asyncio\locks.py:212> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_wait.<locals>._on_completion() at C:\Python312\Lib\asyncio\tasks.py:534]>
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-13' coro=<Dispatcher._polling() running at C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py:345> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[_wait.<locals>._on_completion() at C:\Python312\Lib\asyncio\tasks.py:534]>
INFO:aiogram.dispatcher:Polling stopped for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.dispatcher:Polling stopped
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442764 is handled. Duration 405 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442765 is handled. Duration 202 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442766 is handled. Duration 202 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442767 is handled. Duration 172 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442768 is handled. Duration 390 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442769 is handled. Duration 250 ms by bot id=7064840472
ERROR:root:     id 29: list indices must be integers or slices, not str
ERROR:root:     id 7: list indices must be integers or slices, not str
INFO:aiogram.event:Update id=778442770 is handled. Duration 327 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 13:12:14.128810. Expiration time: 2024-08-05 12:42:14.128810
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 13:13:14.151170. Expiration time: 2024-08-05 12:43:14.151170
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 13:14:14.175095. Expiration time: 2024-08-05 12:44:14.175095
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 13:15:14.181585. Expiration time: 2024-08-05 12:45:14.181585
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x00000222DF69B9C0>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x00000222DF69B9C0>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442771 is handled. Duration 265 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442772 is handled. Duration 280 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442773 is handled. Duration 250 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442774 is handled. Duration 141 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442775 is handled. Duration 250 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442776 is not handled. Duration 16 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442776 by bot id=7064840472
TypeError: try_edit_call() missing 2 required positional arguments: 'text' and 'markup'
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 31, in basket_menu
    await try_edit_call(call)
          ^^^^^^^^^^^^^^^^^^^
TypeError: try_edit_call() missing 2 required positional arguments: 'text' and 'markup'
INFO:root:Checking for expired items at 2024-08-05 13:16:41.188090. Expiration time: 2024-08-05 12:46:41.188090
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000013B89BCF740>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000013B89BCF740>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442777 is handled. Duration 281 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442778 is handled. Duration 202 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 13:18:01.462780. Expiration time: 2024-08-05 12:48:01.462780
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001748BBCF4C0>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001748BBCF4C0>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442779 is handled. Duration 390 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442780 is handled. Duration 125 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442781 is handled. Duration 125 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442782 is handled. Duration 109 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442783 is handled. Duration 140 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442784 is handled. Duration 281 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442785 is handled. Duration 250 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442786 is handled. Duration 156 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442787 is handled. Duration 217 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 13:19:59.490540. Expiration time: 2024-08-05 12:49:59.490540
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000026A5AA7F4C0>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000026A5AA7F4C0>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442788 is handled. Duration 375 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442789 is handled. Duration 266 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442790 is handled. Duration 170 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442791 is handled. Duration 187 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442792 is handled. Duration 172 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442793 is handled. Duration 250 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442794 is handled. Duration 390 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442795 is handled. Duration 141 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 13:21:55.268067. Expiration time: 2024-08-05 12:51:55.268067
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001FF8BACF380>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001FF8BACF380>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442796 is handled. Duration 295 ms by bot id=7064840472
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x00000150C64D3380>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x00000150C64D3380>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442797 is handled. Duration 390 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442798 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442798 by bot id=7064840472
KeyError: 'amount'
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 171, in handle_count
    count = await get_count(int(data["amount"]))
                                ~~~~^^^^^^^^^^
KeyError: 'amount'
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000024A3F956D40>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000024A3F956D40>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442799 is handled. Duration 407 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442800 is handled. Duration 93 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442801 is handled. Duration 125 ms by bot id=7064840472
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000025F6B332D40>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000025F6B332D40>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442802 is handled. Duration 297 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442803 is handled. Duration 109 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 13:24:30.800504. Expiration time: 2024-08-05 12:54:30.800504
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x00000242E1EA7380>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x00000242E1EA7380>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442804 is handled. Duration 280 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442805 is handled. Duration 172 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442806 is handled. Duration 187 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 13:26:15.669103. Expiration time: 2024-08-05 12:56:15.669103
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 13:27:15.691730. Expiration time: 2024-08-05 12:57:15.691730
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 13:28:15.708267. Expiration time: 2024-08-05 12:58:15.708267
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001847AA4B100>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001847AA4B100>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442807 is handled. Duration 359 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442808 is handled. Duration 109 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442809 is handled. Duration 140 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 13:29:37.692700. Expiration time: 2024-08-05 12:59:37.692700
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 13:30:37.686519. Expiration time: 2024-08-05 13:00:37.686519
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 13:31:37.696083. Expiration time: 2024-08-05 13:01:37.696083
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001DBD9F23100>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001DBD9F23100>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442810 is handled. Duration 265 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442811 is handled. Duration 202 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442812 is handled. Duration 202 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442813 is handled. Duration 187 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442814 is not handled. Duration 187 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442814 by bot id=7064840472
TypeError: 'coroutine' object is not iterable
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 245, in transaction_amount
    for admin in admins_id:
TypeError: 'coroutine' object is not iterable
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001EC067B7B00>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001EC067B7B00>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442815 is handled. Duration 297 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442816 is handled. Duration 297 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442817 is handled. Duration 375 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442818 is handled. Duration 172 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442819 is handled. Duration 452 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442820 is handled. Duration 327 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442821 is handled. Duration 3719 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442822 is handled. Duration 3594 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 13:34:38.978095. Expiration time: 2024-08-05 13:04:38.978095
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 13:35:39.003399. Expiration time: 2024-08-05 13:05:39.003399
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 13:36:39.002342. Expiration time: 2024-08-05 13:06:39.002342
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 13:37:39.011796. Expiration time: 2024-08-05 13:07:39.011796
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 13:38:39.026685. Expiration time: 2024-08-05 13:08:39.026685
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 13:39:39.042409. Expiration time: 2024-08-05 13:09:39.042409
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 13:40:39.059832. Expiration time: 2024-08-05 13:10:39.059832
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 13:41:39.084661. Expiration time: 2024-08-05 13:11:39.084661
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001B40F18B740>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001B40F18B740>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442906 is handled. Duration 484 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442905 is handled. Duration 484 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442907 is handled. Duration 827 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 16:01:31.928229. Expiration time: 2024-08-05 15:31:31.928229
INFO:root:Expired items: [<Record product_id=19>]
INFO:root:Cleared expired items at 2024-08-05 16:01:31.950626
INFO:root:Checking for expired items at 2024-08-05 16:02:31.964435. Expiration time: 2024-08-05 15:32:31.964435
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 16:03:31.990048. Expiration time: 2024-08-05 15:33:31.990048
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 16:04:31.996809. Expiration time: 2024-08-05 15:34:31.996809
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000022DF0853740>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000022DF0853740>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442908 is handled. Duration 905 ms by bot id=7064840472
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
WARNING:aiogram.dispatcher:Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7064840472)
INFO:aiogram.dispatcher:Connection established (tryings = 1, bot id = 7064840472)
INFO:aiogram.event:Update id=778442909 is not handled. Duration 15 ms by bot id=7064840472
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
WARNING:aiogram.dispatcher:Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7064840472)
INFO:aiogram.event:Update id=778442910 is not handled. Duration 15 ms by bot id=7064840472
INFO:aiogram.dispatcher:Connection established (tryings = 1, bot id = 7064840472)
INFO:aiogram.event:Update id=778442911 is not handled. Duration 0 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442912 is handled. Duration 390 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 16:05:45.588393. Expiration time: 2024-08-05 15:35:45.588393
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442913 is not handled. Duration 47 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442913 by bot id=7064840472
TypeError: 'NoneType' object is not subscriptable
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\admin.py", line 70, in adminPanel
    if await user_is_admin(messsage.from_user.id):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\utils\db_api\db_asyncpg.py", line 214, in user_is_admin
    return result['isadmin']
           ~~~~~~^^^^^^^^^^^
TypeError: 'NoneType' object is not subscriptable
INFO:root:Checking for expired items at 2024-08-05 16:06:45.597676. Expiration time: 2024-08-05 15:36:45.597676
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442914 is not handled. Duration 30 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442914 by bot id=7064840472
InvalidOperation: [<class 'decimal.ConversionSyntax'>]
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\keyboard_menu.py", line 21, in show_balance
    balance = await get_user_balance(message.from_user.id)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\utils\db_api\db_asyncpg.py", line 110, in get_user_balance
    decimal_val = Decimal(str(value))
                  ^^^^^^^^^^^^^^^^^^^
decimal.InvalidOperation: [<class 'decimal.ConversionSyntax'>]
INFO:aiogram.event:Update id=778442915 is handled. Duration 405 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442916 is handled. Duration 516 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442917 is not handled. Duration 0 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 16:07:45.613567. Expiration time: 2024-08-05 15:37:45.613567
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 16:08:45.624470. Expiration time: 2024-08-05 15:38:45.624470
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x00000194CEAD2FC0>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x00000194CEAD2FC0>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442918 is handled. Duration 625 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442919 is handled. Duration 327 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442920 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442920 by bot id=7064840472
TypeError: BaseModel.__init__() takes 1 positional argument but 2 were given
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 163, in handle_adding
    await try_edit_call(call, "   (      ):", types.ReplyKeyboardMarkup(''))
                                                                                                                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: BaseModel.__init__() takes 1 positional argument but 2 were given
INFO:aiogram.event:Update id=778442921 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442921 by bot id=7064840472
TypeError: BaseModel.__init__() takes 1 positional argument but 2 were given
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 163, in handle_adding
    await try_edit_call(call, "   (      ):", types.ReplyKeyboardMarkup(''))
                                                                                                                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: BaseModel.__init__() takes 1 positional argument but 2 were given
INFO:root:Checking for expired items at 2024-08-05 16:13:36.383650. Expiration time: 2024-08-05 15:43:36.383650
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000022133EC3380>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000022133EC3380>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442922 is not handled. Duration 15 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442922 by bot id=7064840472
TypeError: BaseModel.__init__() takes 1 positional argument but 2 were given
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 163, in handle_adding
    await try_edit_call(call, text="   (      ):", markup=types.ReplyKeyboardMarkup(''))
                                                                                                                                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: BaseModel.__init__() takes 1 positional argument but 2 were given
INFO:aiogram.event:Update id=778442923 is not handled. Duration 15 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442923 by bot id=7064840472
TypeError: BaseModel.__init__() takes 1 positional argument but 2 were given
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 163, in handle_adding
    await try_edit_call(call, text="   (      ):", markup=types.ReplyKeyboardMarkup(''))
                                                                                                                                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: BaseModel.__init__() takes 1 positional argument but 2 were given
INFO:root:Checking for expired items at 2024-08-05 16:14:59.664318. Expiration time: 2024-08-05 15:44:59.664318
INFO:root:No expired items found
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
WARNING:aiogram.dispatcher:Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7064840472)
INFO:aiogram.dispatcher:Connection established (tryings = 1, bot id = 7064840472)
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001FAD8E93240>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001FAD8E93240>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442924 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442924 by bot id=7064840472
TypeError: BaseModel.__init__() takes 1 positional argument but 2 were given
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 165, in handle_adding
    [types.KeyboardButton('')]
     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: BaseModel.__init__() takes 1 positional argument but 2 were given
INFO:aiogram.event:Update id=778442925 is handled. Duration 281 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442926 is handled. Duration 108 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442927 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442927 by bot id=7064840472
TypeError: BaseModel.__init__() takes 1 positional argument but 2 were given
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 165, in handle_adding
    [types.KeyboardButton('')]
     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: BaseModel.__init__() takes 1 positional argument but 2 were given
INFO:aiogram.event:Update id=778442928 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442928 by bot id=7064840472
TypeError: BaseModel.__init__() takes 1 positional argument but 2 were given
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 165, in handle_adding
    [types.KeyboardButton('')]
     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: BaseModel.__init__() takes 1 positional argument but 2 were given
INFO:root:Checking for expired items at 2024-08-05 16:16:37.934327. Expiration time: 2024-08-05 15:46:37.934327
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000026332A1F380>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000026332A1F380>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442929 is handled. Duration 594 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442930 is handled. Duration 422 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 16:18:04.383936. Expiration time: 2024-08-05 15:48:04.383936
INFO:root:No expired items found
ERROR:aiogram.dispatcher:Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
WARNING:aiogram.dispatcher:Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7064840472)
INFO:aiogram.dispatcher:Connection established (tryings = 1, bot id = 7064840472)
INFO:root:Checking for expired items at 2024-08-05 16:19:04.394134. Expiration time: 2024-08-05 15:49:04.394134
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 16:20:04.412672. Expiration time: 2024-08-05 15:50:04.412672
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 16:21:04.426653. Expiration time: 2024-08-05 15:51:04.426653
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 16:22:04.435721. Expiration time: 2024-08-05 15:52:04.435721
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 16:23:04.450493. Expiration time: 2024-08-05 15:53:04.450493
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 16:24:04.470827. Expiration time: 2024-08-05 15:54:04.470827
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 16:25:04.478439. Expiration time: 2024-08-05 15:55:04.478439
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 16:26:04.495328. Expiration time: 2024-08-05 15:56:04.495328
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 16:27:04.508473. Expiration time: 2024-08-05 15:57:04.508473
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 16:28:04.525728. Expiration time: 2024-08-05 15:58:04.525728
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001419987F880>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001419987F880>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442931 is handled. Duration 625 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442932 is handled. Duration 297 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442933 is handled. Duration 202 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442934 is handled. Duration 233 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442935 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442935 by bot id=7064840472
TypeError: try_edit_call() missing 1 required positional argument: 'markup'
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 163, in handle_adding
    await try_edit_call(call, text="   (     ):")
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: try_edit_call() missing 1 required positional argument: 'markup'
INFO:root:Checking for expired items at 2024-08-05 16:30:15.209556. Expiration time: 2024-08-05 16:00:15.209556
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000023E74AD3380>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000023E74AD3380>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442936 is handled. Duration 406 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442937 is handled. Duration 405 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442938 is handled. Duration 203 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442939 is not handled. Duration 0 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442939 by bot id=7064840472
ValueError: invalid literal for int() with base 10: ''
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\inline_menu.py", line 178, in handle_count
    if int(data["count"]) > count:
       ^^^^^^^^^^^^^^^^^^
ValueError: invalid literal for int() with base 10: ''
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001F618863240>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001F618863240>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442940 is handled. Duration 547 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442941 is handled. Duration 234 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442942 is handled. Duration 390 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442943 is handled. Duration 234 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442944 is handled. Duration 140 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442945 is handled. Duration 312 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442946 is handled. Duration 202 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 16:32:39.818144. Expiration time: 2024-08-05 16:02:39.818144
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 16:33:39.821207. Expiration time: 2024-08-05 16:03:39.821207
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 16:34:39.842606. Expiration time: 2024-08-05 16:04:39.842606
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 16:35:39.866605. Expiration time: 2024-08-05 16:05:39.866605
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 16:36:39.872086. Expiration time: 2024-08-05 16:06:39.872086
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 16:37:39.883429. Expiration time: 2024-08-05 16:07:39.883429
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 16:38:39.895456. Expiration time: 2024-08-05 16:08:39.895456
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 16:39:39.900062. Expiration time: 2024-08-05 16:09:39.900062
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 16:40:39.920446. Expiration time: 2024-08-05 16:10:39.920446
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 16:41:39.919704. Expiration time: 2024-08-05 16:11:39.919704
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 16:42:39.921673. Expiration time: 2024-08-05 16:12:39.921673
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 16:43:39.938322. Expiration time: 2024-08-05 16:13:39.938322
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 16:44:39.942679. Expiration time: 2024-08-05 16:14:39.942679
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 16:45:39.964315. Expiration time: 2024-08-05 16:15:39.964315
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000002141FCA74C0>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000002141FCA74C0>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442947 is not handled. Duration 15 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442947 by bot id=7064840472
UndefinedColumnError:  "sg_aaaaaaaaa"  
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\commands.py", line 12, in start_menu
    exists = await user_exists("@"+message.from_user.username)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\utils\db_api\db_asyncpg.py", line 200, in user_exists
    result = await connection.fetchrow(f'SELECT "username" FROM "users" WHERE "username"={user_id}')
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 749, in fetchrow
    data = await self._execute(
           ^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1794, in _execute
    result, _ = await self.__execute(
                ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1892, in __execute
    result, stmt = await self._do_execute(
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1925, in _do_execute
    stmt = await self._get_statement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 433, in _get_statement
    statement = await self._protocol.prepare(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\protocol\protocol.pyx", line 166, in prepare
asyncpg.exceptions.UndefinedColumnError:  "sg_aaaaaaaaa"  
INFO:root:Checking for expired items at 2024-08-05 17:19:09.494147. Expiration time: 2024-08-05 16:49:09.494147
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000013C1CCEEFC0>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000013C1CCEEFC0>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442948 is not handled. Duration 30 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442948 by bot id=7064840472
UndefinedColumnError:  "sg_aaaaaaaaa"  
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\commands.py", line 12, in start_menu
    exists = await user_exists("@" + message.from_user.username)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\utils\db_api\db_asyncpg.py", line 200, in user_exists
    result = await connection.fetchrow(f'SELECT "username" FROM "users" WHERE "username"={user_id}')
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 749, in fetchrow
    data = await self._execute(
           ^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1794, in _execute
    result, _ = await self.__execute(
                ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1892, in __execute
    result, stmt = await self._do_execute(
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 1925, in _do_execute
    stmt = await self._get_statement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\asyncpg\connection.py", line 433, in _get_statement
    statement = await self._protocol.prepare(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\protocol\protocol.pyx", line 166, in prepare
asyncpg.exceptions.UndefinedColumnError:  "sg_aaaaaaaaa"  
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001BD47E1F240>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001BD47E1F240>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442949 is handled. Duration 827 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 17:22:05.959999. Expiration time: 2024-08-05 16:52:05.959999
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 17:23:05.960594. Expiration time: 2024-08-05 16:53:05.960594
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 17:24:05.978960. Expiration time: 2024-08-05 16:54:05.978960
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 17:25:05.991377. Expiration time: 2024-08-05 16:55:05.991377
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000027C092D3880>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000027C092D3880>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442955 is not handled. Duration 45 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442955 by bot id=7064840472
TypeError: bad operand type for unary ~: 'str'
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\commands.py", line 16, in start_menu
    if ~exists["fio"]:
       ^^^^^^^^^^^^^^
TypeError: bad operand type for unary ~: 'str'
INFO:aiogram.event:Update id=778442954 is not handled. Duration 140 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442954 by bot id=7064840472
TypeError: bad operand type for unary ~: 'str'
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\commands.py", line 16, in start_menu
    if ~exists["fio"]:
       ^^^^^^^^^^^^^^
TypeError: bad operand type for unary ~: 'str'
INFO:aiogram.event:Update id=778442956 is not handled. Duration 140 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442956 by bot id=7064840472
TypeError: bad operand type for unary ~: 'str'
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\commands.py", line 16, in start_menu
    if ~exists["fio"]:
       ^^^^^^^^^^^^^^
TypeError: bad operand type for unary ~: 'str'
INFO:aiogram.event:Update id=778442953 is not handled. Duration 140 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442953 by bot id=7064840472
InvalidOperation: [<class 'decimal.ConversionSyntax'>]
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\keyboard_menu.py", line 23, in show_balance
    balance = await get_user_balance(message.from_user.id)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\utils\db_api\db_asyncpg.py", line 113, in get_user_balance
    decimal_val = Decimal(str(value))
                  ^^^^^^^^^^^^^^^^^^^
decimal.InvalidOperation: [<class 'decimal.ConversionSyntax'>]
INFO:aiogram.event:Update id=778442950 is not handled. Duration 140 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442950 by bot id=7064840472
TypeError: bad operand type for unary ~: 'str'
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\commands.py", line 16, in start_menu
    if ~exists["fio"]:
       ^^^^^^^^^^^^^^
TypeError: bad operand type for unary ~: 'str'
INFO:aiogram.event:Update id=778442951 is handled. Duration 420 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442952 is handled. Duration 437 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 18:43:04.463500. Expiration time: 2024-08-05 18:13:04.463500
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442957 is not handled. Duration 15 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442957 by bot id=7064840472
TypeError: 'NoneType' object is not subscriptable
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\admin.py", line 70, in adminPanel
    if await user_is_admin(messsage.from_user.id):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\utils\db_api\db_asyncpg.py", line 217, in user_is_admin
    return result['isadmin']
           ~~~~~~^^^^^^^^^^^
TypeError: 'NoneType' object is not subscriptable
INFO:root:Checking for expired items at 2024-08-05 18:44:04.478057. Expiration time: 2024-08-05 18:14:04.478057
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 18:45:04.501871. Expiration time: 2024-08-05 18:15:04.501871
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 18:46:04.523418. Expiration time: 2024-08-05 18:16:04.523418
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442958 is handled. Duration 359 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 18:47:04.527624. Expiration time: 2024-08-05 18:17:04.527624
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 18:48:04.540632. Expiration time: 2024-08-05 18:18:04.540632
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 18:49:04.557232. Expiration time: 2024-08-05 18:19:04.557232
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 18:50:04.570734. Expiration time: 2024-08-05 18:20:04.570734
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000002356FFCB600>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000002356FFCB600>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442985 is handled. Duration 359 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442986 is handled. Duration 375 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442987 is handled. Duration 109 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442988 is handled. Duration 406 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 19:20:08.501333. Expiration time: 2024-08-05 18:50:08.501333
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442989 is handled. Duration 280 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442990 is handled. Duration 436 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 19:21:08.530396. Expiration time: 2024-08-05 18:51:08.530396
INFO:root:No expired items found
INFO:aiogram.event:Update id=778442991 is handled. Duration 359 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442992 is handled. Duration 219 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442993 is handled. Duration 172 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442994 is handled. Duration 577 ms by bot id=7064840472
INFO:aiogram.event:Update id=778442995 is not handled. Duration 15 ms by bot id=7064840472
ERROR:aiogram.event:Cause exception while process update id=778442995 by bot id=7064840472
TypeError: add_user() takes 1 positional argument but 3 were given
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\commands.py", line 17, in start_menu
    add_user(message.from_user.id, message.from_user.full_name, "@" + message.from_user.username)
TypeError: add_user() takes 1 positional argument but 3 were given
INFO:root:Checking for expired items at 2024-08-05 19:22:08.542584. Expiration time: 2024-08-05 18:52:08.542584
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000020C3286F380>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000020C3286F380>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442996 is handled. Duration 407 ms by bot id=7064840472
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001CCC9D5B600>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001CCC9D5B600>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @aiogramexperiencebot id=7064840472 - 'aiogram_bot'
INFO:aiogram.event:Update id=778442997 is handled. Duration 359 ms by bot id=7064840472
INFO:root:Checking for expired items at 2024-08-05 19:24:53.292965. Expiration time: 2024-08-05 18:54:53.292965
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 19:25:53.307859. Expiration time: 2024-08-05 18:55:53.307859
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 19:26:53.323972. Expiration time: 2024-08-05 18:56:53.323972
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 19:27:53.342726. Expiration time: 2024-08-05 18:57:53.342726
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x000001B15A15F4C0>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x000001B15A15F4C0>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @jerksmessagesstatsbot id=7236458100 - 'statsbot'
INFO:aiogram.event:Update id=224057564 is handled. Duration 422 ms by bot id=7236458100
INFO:aiogram.event:Update id=224057565 is not handled. Duration 15 ms by bot id=7236458100
ERROR:aiogram.event:Cause exception while process update id=224057565 by bot id=7236458100
TypeError: 'NoneType' object is not subscriptable
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\handlers\users\admin.py", line 70, in adminPanel
    if await user_is_admin(messsage.from_user.id):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\alhim\Documents\bots\aiogram\final_result\utils\db_api\db_asyncpg.py", line 217, in user_is_admin
    return result['isadmin']
           ~~~~~~^^^^^^^^^^^
TypeError: 'NoneType' object is not subscriptable
INFO:root:Checking for expired items at 2024-08-05 20:05:35.475810. Expiration time: 2024-08-05 19:35:35.475810
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 20:06:35.479951. Expiration time: 2024-08-05 19:36:35.479951
INFO:root:No expired items found
INFO:root:Checking for expired items at 2024-08-05 20:07:35.481050. Expiration time: 2024-08-05 19:37:35.481050
INFO:root:No expired items found
ERROR:asyncio:an error occurred during closing of asynchronous generator <async_generator object Dispatcher._listen_updates at 0x0000022846B1F100>
asyncgen: <async_generator object Dispatcher._listen_updates at 0x0000022846B1F100>
RuntimeError: aclose(): asynchronous generator is already running
ERROR:asyncio:Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<clear_expired_basket_items() running at c:\Users\alhim\Documents\bots\aiogram\final_result\app.py:14> wait_for=<Future pending cb=[Task.task_wakeup()]>>
